

# Shopify Playbook: Analytics Implementation
 
 - Introduction
 - Data Collection // Web Analytics
 - Google Tag Manager (GTM) // Set Up
 - 3rd Party Implementation
 - DataLayer Design // Theme Snippets

Introduction
Shopify → GA4 Mapping Doc
Events → Brand
 - Hybrid Snippet + Custom Pixel IMPLEMENTATION

STEP BY STEP INSTRUCTIONS
SNIPPET - ES5

SNIPPET dataLayer

Checkout Custom Pixel - ES5

customPixel Checkout

GTM CONTAINER IMPORT START - JSON

GTM Starter Container
 - ‘Custom Pixel’ script IMPLEMENTATION _ DO NOT USE

Custom Pixel (w/ below Click Tracking Enabled) - ES5

Advanced Click Tracking () - DEPREICATED

Storefront Snippet

OneTrust dataLayer Tracking () - DEPRICATED

OneTrust dataLayer Tracking

OneTrust Preference Center ()

OneTrust Preference Center Link
 - OneTrust // Data Privacy
 - dataLayer Events detail and Solution Design ()
 - Testing

1) Seeing the dataLayer in console.

2) Seeing the dataLayer in browser extension.

3) Once GA4 events are configured in GTM - review network requests.
4) Google Analytics Debugger
 - Helpful Shopify Links
 
 

 | DACT/VF Team |
 | --- |
 | valter_violini@vfc.com |
 | justin_young@vfc.com |
 | joshua_barratt@vfc.com |
 | denis_zakharych@vfc.com |
 | nastasia_demarini@vfc.com |
 | sergiu_cetulean@vfc.com |
 | renzo_bignami@vfc.com |
 
 

## Introduction
 
Purpose: Standardize Shopify tracking implementation (GTM, GA4, dataLayer) across VF brands (Eastpak, Jansport, Napapijri, and more...)
 
Scope:
 
 - GTM setup & container management
 - dataLayer design & event tracking
 - GA4 configuration & e-commerce tracking
 - OneTrust intragration for GDPR/CCPA compliance
 - Third-party vendor tagging
 - Testing & validation procedures
 
 
Audience:
 
 - Developers
 - Data Analysts
 - Marketing Teams
 - QA Engineers
 
 

## Data Collection // Web Analytics
 
 1. Analytics platform: Google Analytics 4
 1. Shopify Sandbox Limitations:

Limited DOM Access & Manipulation 

The sandboxed setup limits direct access to the DOM, making DOM manipulation and scraping difficult. As a result, most standard GTM triggers like element visibility, scroll, history change, click, and JavaScript error won’t work.

Odd Page URLs

Custom pixels embedded within a child iFrame lack access to the parent frame’s page information, such as the page URL. This results in odd page URLs containing unwanted strings and identifiers.

Tracking Codes Inside Custom Pixels

Since GA4, within the pixel’s iFrame, can’t access or modify the parent page’s content, URL, or linking parameters, cross-domain tracking will not work. If our website/shop (and checkout) are on separate domains, GA4 sessions will not be tracked accurately.

GTM Preview Mode Does Not Work

The sandboxed environment prevents Google Tag Manager’s Preview Mode from functioning, which complicates testing and debugging. This requires alternative testing approaches.

User Engagement Isn't Tracked Properly

A limitation of custom scripts is that the user_engagement event isn’t being recorded correctly. Only a minimal number of these events are collected, and when they are, they lack any engagement time data. As a result, metrics such as Average Engagement Time display as 0s, and all related engagement metrics will be inaccurate and should not be relied upon.
 1. Important Notes
 
 
 - Upgrade to Checkout Extensibility

To utilize Customer Events and custom pixels, upgrade to Checkout Extensibility:

Go to Settings > Checkout and upgrade.
 - Avoiding Duplicate Data

After installing scripts and configuring your Google Tag Manager container:

Disable other tools or codes sending event data to Google Analytics to avoid duplicates.

Google & YouTube Sales Channel: Navigate to Sales channels > Google & YouTube > Settings > Conversion tracking and turn it off.

Additional Scripts: Navigate to Settings > Checkout, scroll to Order status page additional scripts, and remove any tracking scripts.
 - Possible Attribution Issues

Monitor attribution data closely as custom pixels may affect attribution accuracy, although this has not been confirmed in client setups.
 
 

## Google Tag Manager (GTM) // Set Up
 
 1. GTM Pixels by Brand ( FOR REFERENCE - PLEASE SEE CUSTOM PIXEL FOR INSTALLATION )

EASTPAK

GTM Eastpak

<!-- Google Tag Manager →
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KMSG3C7');</script>
<!-- End Google Tag Manager →

<!-- Google Tag Manager (noscript) →
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KMSG3C7"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

JANSPORT (SHOPIFY CONTAINER)

GTM Jansport

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NMN2FR7S');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMN2FR7S"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

NAPAPIJRI EMEA (SHOPIFY CONTAINER)

GTM Napapijri

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KQRX46MW');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQRX46MW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

KIPLING NORA (SHOPIFY CONTAINER)

GTM Kipling NORA

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NRZBTWKT');</script>
<!-- End Google Tag Manager -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NRZBTWKT"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

KIPLING EMEA (SHOPIFY CONTAINER)

GTM Kipling EMEA

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TCCQ6WVR');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TCCQ6WVR"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

ICEBREAKER NORA (SHOPIFY CONTAINER)

GTM Icebreaker NORA

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5WGT4VQN');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5WGT4VQN"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

ICEBREAKER EMEA (SHOPIFY CONTAINER)

GTM Icebreaker EMEA

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PXG6KHMK');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PXG6KHMK"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

ICEBREAKER APAC (SHOPIFY CONTAINER)

GTM Icebreaker APAC

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MZGK696R');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MZGK696R"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

EASTPAK EMEA (SHOPIFY CONTAINER)

GTM Eastpak EMEA

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WFRCVJ88');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WFRCVJ88"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

DICKIES NORA (SHOPIFY CONTAINER)

GTM Dickies NORA

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TFBMQCHG');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TFBMQCHG"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

DICKIES EMEA (SHOPIFY CONTAINER)

GTM Dickies EMEA

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KF6TLMLB');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KF6TLMLB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
 1. Tags, triggers, variables, and 3rd party vendors currently set up in GTM (JanSport/EastPak/Napapijri)

Jansport GTM Review - 120924

Eastpak GTM Review - 120924

Napapijri GTM Review - 030625

Kipling NORA GTM Review - 041725

Kipling EMEA GTM Review - 041725

Icebreaker APAC GTM Review - 071825

Icebreaker EMEA GTM Review - 071825

Icebreaker NORA GTM Review - 071825

Eastpak EMEA GTM Review - XXXXXX

Dickies NORA GTM Review - XXXXXX

Dickies EMEA GTM Review - XXXXXX
 
 

## 3rd Party Implementation
 

 | Vendor | EP STATUS / NOTES | JSP STATUS / NOTES | NAPA EMEA STATUS / NOTES | KIPLING NORA STATUS / NOTES | KIPLING EMEA STATUS / NOTES | ICEBREAKER NORA STATUS / NOTES | ICEBREAKER EMEA STATUS / NOTES | ICEBREAKER APAC STATUS / NOTES | EASTPAK EMEA STATUS / NOTES | DICKIES NORA STATUS / NOTES | DICKIES EMEA STATUS / NOTES |
 | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
 | GA4 | / GTM | / GTM | / GTM | / GTM | / GTM | | | | | | |
 | Bluecore | / 
GTM (From Klaviyo) | / MOVE TO FE | / MOVE TO FE | / MOVE TO FE | / MOVE TO FE | | | | | | |
 | Yotpo | / Shopify | | / GTM (Purchase) | / GTM (Purchase) | / GTM (Purchase) | | | | | | |
 | Zendesk | / Shopify | | | | | | | | | | |
 | Zopim | / Shopify | | | | | | | | | | |
 | figgpii | / Shopify | | | | | | | | | | |
 | Amazon | | / GTM | / GTM | / GTM | | | | | | | |
 | Bing | | / GTM | | / GTM | / GTM | | | | | | |
 | Bloomreach | | / CUT | / GTM | / GTM | / GTM | | | | | | |
 | Cashstar | | / GTM | | | | | | | | | |
 | Contentsquare | | / CUT (QM) | | / CUT (QM) | / CUT (QM) | | | | | | |
 | Criteo | | / GTM | | / GTM | / GTM | | | | | | |
 | Channel Advisor | | / GTM | | / HOLD | / HOLD | | | | | | |
 | Linkshare | | / GTM | | | | | | | | | |
 | Mediaforge | | / CUT | | | | | | | | | |
 | Pinterest | | / GTM | / GTM | / GTM | / GTM | | | | | | |
 | Cybersource | | / CUT | | | | | | | | | |
 | District M | | / CUT | | | | | | | | | |
 | DynamicMediaBanner | | / CUT | | | | | | | | | |
 | DoubleClick | | / CUT | | | | | | | | | |
 | Google Ads | | / GTM | | / GTM | / GTM | | | | | | |
 | Facebook | | / GTM | / GTM | / GTM | / GTM | | | | | | |
 | Human | | / CUT | / CUT | | | | | | | | |
 | Kenshoo | | / GTM | | / GTM - Need Script | | | | | | | |
 | Pebblepost | | / CUT | | | | | | | | | |
 | Power Reviews | | / SHOP | / CUT | | | | | | | | |
 | Quantum Metric | | / SHOP | / GTM & SHOP | / GTM & SHOP | / GTM & SHOP | | | | | | |
 | SFMC | | / SHOP | / na | | | | | | | | |
 | Snapchat | | / GTM | / GTM | | | | | | | | |
 | Tangiblee | | / CUT | | / GTM | / GTM | | | | | | |
 | TikTok | | / GTM | / GTM | / GTM | / GTM | | | | | | |
 | TTD | | / GTM | | | | | | | | | |
 | YouTube Listener | | / CUT | | | | | | | | | |
 | Dynatrace | / GTM | / GTM | / GTM | / GTM | | | | | | | |
 | Einstein | | | / CUT | | | | | | | | |
 | FitFinder | | | / GTM | | | | | | | | |
 | Floodlight | | | / GTM | | | | | | | | |
 | Google Merchant Code | | | / GTM | | | | | | | | |
 | LiveChat | | | / GTM | - GTM | / GTM | | | | | | |
 | Monetate | | | - Optimizely? TBD | / Optimizely? TBD | / Optimizely? TBD | | | | | | |
 | NMPi | | | / GTM | | | | | | | | |
 | Partnerize | | | / GTM | | | | | | | | |
 | PayPal | | | - SHOP // Ask Veera | | | | | | | | |
 | PHD_NAPA | | | / GTM | | | | | | | | |
 | Tead | | | / GTM | | | | | | | | |
 | BlueConic | | | | / GTM - Need Script | / GTM | | | | | | |
 | BorderFree | | | | / GTM - Need Script | | | | | | | |
 | ExactTarget | | | | DROP | | | | | | | |
 | Yahoo | | | | ?? | | | | | | | |
 | Linc | | | | Replace with SF Chat?? | | | | | | | |
 | Rakuten | | | | / GTM | | | | | | | |
 | Thrive | | | | / GTM | | | | | | | |
 | Webgains | | | | | / GTM | | | | | | |
 
 
KEY:
 
- COMPLETE
 
- CUT
 
- PLANNING
 
- n/a
 
- IN PROCESS
 

## DataLayer Design // Theme Snippets
 

### Introduction
 
This SDR for VF //Shopify aims to track the following events:
 
 - page_view
 - view_item_list
 - view_item
 - add_to_cart
 - view_cart
 - remove_from_cart
 - begin_checkout
 - add_shipping_info
 - add_payment_info
 - purchase
 - view_search_results
 - form_submit
 - clicks (in general)
 - OneTrust Events
 - logged_in
 
 
+
 
 - Brand Custom Events
 
 
Quality in data collection tasks targeting the dataLayer is achieved under these generic principles:
 
 - Values must be provided always in the English language.
 - Typos are avoided and Naming Conventions rules are applied (the smallest variation in a value, eg: changing a letter from Uppercase to Lowercase, will cause inaccuracies in reporting).
 
 

### Shopify → GA4 Mapping Doc
 

 | SHOPIFY EVENT | GA4 EVENT |
 | --- | --- |
 | cart_viewed | view_cart |
 | checkout_completed | purchase |
 | checkout_shipping_info_submitted | add_shipping_info |
 | checkout_started | begin_checkout |
 | collection_viewed | view_item_list |
 | page_viewed | page_view |
 | payment_info_submitted | add_payment_info |
 | product_added_to_cart | add_to_cart |
 | product_removed_from_cart | remove_from_cart |
 | product_viewed | view_item |
 | search_submitted | view_search_results |
 | clicked | click |
 | form_submitted | form_submit |
 
 

### Events → Brand
 

 | Event | Standard/Ecommerce | Eastpak - US | JanSport - US | NAPA EMEA | KIPLING NORA | KIPLING EMEA | ICEBREAKER NORA | ICEBREAKER EMEA | ICEBREAKER APAC | EASTPAK NORA | DICKIES NORA | DICKIES EMEA |
 | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
 | view_cart | Ecommerce | | | | | | | | | | | |
 | purchase | Ecommerce | | | | | | | | | | | |
 | add_shipping_info | Ecommerce | | | | | | | | | | | |
 | begin_checkout | Ecommerce | | | | | | | | | | | |
 | view_item_list | Ecommerce | | | | | | | | | | | |
 | page_view | Standard | | | | | | | | | | | |
 | add_payment_info | Ecommerce | | | | | | | | | | | |
 | add_to_cart | Ecommerce | | | | | | | | | | | |
 | remove_from_cart | Ecommerce | | | | | | | | | | | |
 | view_item | Ecommerce | | | | | | | | | | | |
 | view_search_results | Standard | | | | | | | | | | | |
 | click | Standard | | | | | | | | | | | |
 | form_submit | Standard | | | | | | | | | | | |
 | OneTrust Events | Advanced | | | | | | | | | | | |
 | logged_in | Advanced | | | | | | | | | | | |
 | Scroll Tracking | Advanced | | | | | | | | | | | |
 | Video Tracking | Advanced | | | | | | | | | | | |
 | add_to_wishlist | Advanced | | Excluded - Shopify | | | | | | | | | |
 | remove_from_wishlist | Advanced | | Excluded - Shopify | | | | | | | | | |
 | chat click tracking | Advanced | | | | | | | | | | | |
 | newsletter impression | Advanced | | No Modal - Shopify | | | | | | | | | |
 | newsletter submit/confirmed | Advanced | | *form element trigger GTM | | | | | | | | | |
 | newsletter close | Advanced | | No Modal - Shopify | | | | | | | | | |
 | notify me click | Advanced | | TBD | | | | | | | | | |
 | notify me request | Advanced | | *click element trigger GTM | | | | | | | | | |
 | swatch click PDP | Advanced | | *click element trigger GTM | | | | | | | | | |
 | swatch click PLP | Advanced | | *click element trigger GTM | | | | | | | | | |
 | swatch click Quickview | Advanced | | *click element trigger GTM | | | | | | | | | |
 | shopthelook | Advanced | | | | | | | | | | | |
 
 

## Hybrid Snippet + Custom Pixel IMPLEMENTATION
 

 | Brand | Region | GTM ID |
 | --- | --- | --- |
 | Eastpak | US | GTM-KMSG3C7 |
 | JanSport | US | GTM-NMN2FR7S |
 | Napapijri | EMEA | GTM-KQRX46MW |
 | Kipling | NORA | GTM-NRZBTWKT |
 | Kipling | EMEA | GTM-TCCQ6WVR |
 | Icebreaker | NORA | GTM-5WGT4VQN |
 | Icebreaker | EMEA | GTM-PXG6KHMK |
 | Icebreaker | APAC | GTM-MZGK696R |
 | Eastpak | EMEA | GTM-WFRCVJ88 |
 | Dickies | NORA | GTM-TFBMQCHG |
 | Dickies | EMEA | GTM-KF6TLMLB |
 
 

### STEP BY STEP INSTRUCTIONS
 
* Below - Please Update:  (UPDATE BRAND HERE) with the brand. ALSO Please Update: 'GTM-00000000' with the GTM Container ID Mentioned Above. *
 

### SNIPPET -  ES5
 

##### SNIPPET dataLayer
 
```
<script defer>
 (function() {
 // =========================================================
 // CONFIGURATION SECTION
 // =========================================================
 /**
 * Debug Configuration
 * Set to false for production
 */
 var CONFIG = {
 debug: false,
 formattedItemId: true,
 eventThrottleDelay: 0 // ms delay between duplicate events
 };

 /**
 * DOM Selectors Configuration - Update these selectors to match theme structure
 */
 var SELECTORS = {
 // Cart Interaction Elements
 cartQuantityButtons: 'button[name="plus"], ' +
 'button[name="minus"], ' +
 'button[data-quantity-decrement], ' +
 'button[data-quantity-increment], ' +
 'cart-remove-button, ' +
 'button[data-remove], ' +
 '.button--tertiary, ' +
 '.cart__remove-button, ' +
 '.cart__item-remove, ' +
 '.minicart__item-remove, ' +
 '.quantity-input__button, ' +
 '.cart-item__remove',

 cartItemContainer: 'quantity-input.quantity.cart-quantity, ' +
 '.quantity-selector, ' +
 '.cart-item, ' +
 '.line-item, ' +
 '.cart-drawer-item, ' +
 '.cart__item, ' +
 '.minicart__item, ' +
 '[data-cart-item], ' +
 'tr[data-key]',

 quantityInputField: 'input[name="updates[]"], ' +
 '[data-quantity-input] input, ' +
 '[data-quantity-input-field], ' +
 'input[data-quantity-field]',

 // Mini Cart Specific Selectors
 miniCartItem: '.minicart__item',
 miniCartQuantityInput: '.minicart__item input[type="number"]',
 miniCartRemove: '.minicart__item-remove',

 // Remove Button Identifiers
 removeButtonIdentifiers: '.icon-remove, .icon-trash, .icon-delete, .remove-icon, .icon-minus, .cart__item-remove, .minicart__item-remove',

 // Form Selectors
 addToCartForm: 'form[action*="/cart/add"], .product-sticky-bar form',
 checkoutSelectors: 'form[action="/checkout"], a[href="/checkout"], button[name="checkout"]',
 notifyMeForm: 'form[data-bluecore-notify-me-form]',

 // Collection & Search Result Selectors
 collectionProductItem: 'product-card',
 searchResultItem: 'product-card',

 // Color Swatch Selectors
 colorSwatchContainer: '[data-component="product-form-options"]',
 colorSwatchInputs: '[data-component="color-swatch"] input[type="radio"]',
 colorSwatchButtons: '[data-component="color-swatch"]',
 productFamilyOptions: 'input[data-product-family-option]',

 // Quick View Selectors
 quickViewContainer: 'quick-view[data-component="quick-view"], .quick-view, quick-view-holder[data-component="quick-view-holder"], .quick-view-holder',
 quickViewForm: 'quick-view[data-component="quick-view"] form[action*="/cart/add"], .quick-view form[action*="/cart/add"], quick-view-holder form[action*="/cart/add"], .quick-view-holder form[action*="/cart/add"], quick-view-holder product-form[data-main="true"], .quick-view-holder product-form[data-main="true"]',
 quickViewVariantSelector: 'quick-view-holder [name="id"], .quick-view-holder [name=id]',
 quickViewColorOptions: '.quick-view [data-component="color-swatch"] input[type="radio"]',

 // Sticky Bar Specific Selectors
 stickyBarContainer: '.product-sticky-bar',
 stickyBarButton: '.product-sticky-bar button[type="submit"]'
 };

 /**
 * Data Attribute Configuration
 * Define data attributes used to extract information
 */
 var DATA_ATTRIBUTES = {
 productId: ['data-product-id', 'data-id'],
 variantId: ['data-variant-id', 'data-id', 'data-line-item-variant-id'],
 lineItemKey: 'data-line-item-key'
 };

 // =========================================================
 // CORE DATA LAYER INITIALIZATION
 // =========================================================
 // Initialize core data structures
 window.dataLayer = window.dataLayer || [];
 window.user = window.user || {};
 window.page = window.page || {};

 // Page view event
 window.dataLayer.push({ event: 'page_view', window: 'storefront'});

 // --- USER DATA CONFIGURATION ---
 // Capture logged-in customer data or generate guest ID
 {% if customer %}
 window.user.loggedIn = true;
 window.user.customer_id = {{ customer.id | json }};
 window.user.totalSpent = {{ customer.total_spent | json }};
 window.user.orderCount = {{ customer.orders_count | json }};
 window.user.Email = {{ customer.email | json }};
 window.user.encodedEmail = "{{ customer.email | base64_encode }}";
 window.user.encodedEmailSha = "{{ customer.email | sha256 }}";
 window.user.Phone = {{ customer.phone | json}};
 window.user.encodedPhone = "{{ customer.phone | base64_encode }}";
 window.user.encodedPhoneSha = "{{ customer.phone | sha256 }}";
 window.user.vfEmployee = {% if customer.email contains '@vfc.com' %}true{% else %}false{% endif %};
 {% else %}
 window.user.loggedIn = false;
 window.user.customer_id = null;
 window.user.totalSpent = 0;
 window.user.orderCount = 0;
 window.user.Email = "";
 window.user.encodedEmail = "";
 window.user.encodedEmailSha = "";
 window.user.phone = "";
 window.user.encodedPhone = "";
 window.user.encodedPhoneSha = "";
 window.user.vfEmployee = false;

 // Create persistent guest ID if none exists
 (function() {
 var gid = localStorage.getItem('guestId');
 if (!gid) {
 gid = 'gid_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
 localStorage.setItem('guestId', gid);
 }
 window.user.guest_id = gid;
 })();
 {% endif %}

 // =========================================================
 // CORE UTILITIES
 // =========================================================
 /**
 * Extracts data attribute value from element using list of possible attribute names
 */
 function extractDataAttribute(element, attrList) {
 if (!element || !attrList) return null;
 for (var i = 0; i < attrList.length; i++) {
 if (element.hasAttribute(attrList[i])) return element.getAttribute(attrList[i]);
 }
 return null;
 }

 /**
 * Pushes e-commerce events to dataLayer with standard format
 */
 function pushEcomEvent(eventName, eventParams) {
 window.dataLayer.push({ ecommerce: null }); // Clear previous ecommerce object
 var payload = eventParams || {};
 payload.event = eventName;
 window.dataLayer.push(payload);
 if (CONFIG.debug) console.log("GA4 event:", eventName, payload);
 }

 /**
 * Formats e-commerce item data for consistent tracking
 * Handles price normalization, discount calculations, and attribute extraction
 *
 * @param {string|number} productId - The product ID
 * @param {string|number} variantId - The variant ID
 * @param {string} name - The product name
 * @param {number} price - The current price (after all discounts)
 * @param {number} quantity - The quantity
 * @param {string} sku - The product SKU
 * @param {string} brand - The product brand
 * @param {string} category - The product category
 * @param {string} variantName - The variant name
 * @param {Array} discounts - Array of discount objects containing code/title and amount
 * @param {number} originalPrice - The original price before any discounts
 * @param {number} inventory - The inventory quantity
 * @param {string} listName - The list name
 * @returns {Object} Formatted item object with standardized attributes
 */
 function formatItem(productId, variantId, name, price, quantity, sku, brand, category, variantName, discounts, originalPrice, inventory, listName) {
 var storeCountryCode = window.localStorage.getItem('shopCountryCode') || 'undefined';

 // Normalize price values - ensures we're working with proper numeric values
 var formattedPrice = typeof price === 'number' ? parseFloat(price.toFixed(2)) : 0;

 // Process originalPrice - ensure it's a valid number
 var formattedOriginalPrice = null;
 if (originalPrice != null) {
 // Convert string prices to numbers if needed (removing currency symbols)
 if (typeof originalPrice === 'string') {
 formattedOriginalPrice = parseFloat(originalPrice.replace(/[^0-9.-]/g, ''));
 } else {
 formattedOriginalPrice = originalPrice;
 }

 // Normalize Shopify prices that are in cents rather than dollars
 if (formattedOriginalPrice > 1000 && formattedPrice < 1000) {
 formattedOriginalPrice = formattedOriginalPrice / 100;
 }
 }

 // Build standardized item object with base properties
 var item = {
 sh_item_id: CONFIG.formattedItemId ? (storeCountryCode + '_' + productId + '_' + variantId) : String(productId),
 item_id: CONFIG.formattedItemId ? String(variantId || productId) : productId,
 item_name: name,
 price: formattedPrice,
 item_brand: brand || "{{ shop.name }}",
 item_category: category || "",
 item_variant: variantName || "",
 product_id: productId,
 variant_id: variantId,
 currency: window.page.currencyCode || 'USD'
 };

 // Add optional fields when available
 if (sku) {
 item.sku = sku;
 // Extract product codes from SKU
 var parts = sku.split(':');
 if (parts.length > 3) {
 item.sizeCode = parts[3] || "";
 item.colorCode = parts[2] || "";
 item.styleCode = parts[1] || "";
 item.item_id = parts[0] + parts[1] || "";
 }
 }

 if (quantity !== undefined) item.quantity = quantity;
 if (listName) item.list = listName;

 // DISCOUNT TRACKING SECTION
 // Set the correct original price (before any discounts)
 if (formattedOriginalPrice && formattedOriginalPrice > formattedPrice) {
 // If we have an original price and it's higher than the current price, use it
 item.originalPrice = formattedOriginalPrice;
 } else {
 // Otherwise, use the current price as the original price (no sale discount)
 item.originalPrice = formattedPrice;
 }

 // Calculate sale discount amount (difference between original price and current price)
 var saleDiscountPerItem = item.originalPrice - formattedPrice;
 item.saleDiscountAmount = saleDiscountPerItem > 0 ? parseFloat(saleDiscountPerItem.toFixed(2)) : 0;

 // Process coupon/promotion discounts if available
 item.couponDiscountAmount = 0;
 if (discounts && discounts.length) {
 // Join all discount codes/titles for the coupon field
 item.coupon = discounts.map(function(d) { return d.title || d.code; }).join(',');

 // Calculate total coupon discount amount (per item)
 var totalCouponDiscount = discounts.reduce(function(sum, d) {
 return sum + (parseFloat(d.amount) || 0);
 }, 0);

 // Store per-item coupon discount amount
 // If quantity is provided and valid, divide by quantity
 if (quantity && quantity > 0) {
 item.couponDiscountAmount = parseFloat((totalCouponDiscount / quantity).toFixed(2));
 } else {
 item.couponDiscountAmount = parseFloat(totalCouponDiscount.toFixed(2));
 }

 // Set coupon type flags
 var hasCode = discounts.some(function(d) { return d.code; });
 item.couponType = hasCode ? "Discount Code" : "Automatic Discount";
 item.discountType = hasCode ? "Discount Code" : "Automatic Discount";
 }

 // Calculate total discount (combining sale discount and coupon discount)
 // This represents the total per-item discount
 item.discount = parseFloat((item.saleDiscountAmount + item.couponDiscountAmount).toFixed(2));
 item.onSale = item.price < item.originalPrice;

 // Calculate itemTotal as price * quantity
 item.itemTotal = parseFloat((item.price * item.quantity).toFixed(2));

 // Extract color from variant name
 if (variantName && variantName !== "Default Title") {
 var splitName = variantName.split(' / ');
 item.colorDescription = splitName[0];
 }

 return item;
 }

 /**
 * Tracks cart item removals with standardized events
 */
 function trackCartRemovals(removedItems) {
 if (!removedItems || removedItems.length === 0) return;
 removedItems.forEach(function(remItem) {
 pushEcomEvent('remove_from_cart', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: parseFloat((remItem.price * (remItem.quantity || 1)).toFixed(2)),
 items: [ remItem ]
 }
 });
 if (CONFIG.debug) console.log('Removed from cart:', remItem);
 });
 }

 // =========================================================
 // QUICK VIEW TRACKING
 // =========================================================
 /**
 * Gets complete product data from QuickView element
 */
 function getQuickViewProductData(quickViewElement) {
 if (!quickViewElement) return null;

 // Get the product-form element with data-main="true"
 var form = quickViewElement.querySelector('product-form[data-main="true"]');
 if (!form) {
 // Fallback to original selector if main product form not found
 form = quickViewElement.querySelector(SELECTORS.quickViewForm);
 if (!form) return null;
 }

 // Try to get data from the data-product attribute first
 try {
 if (form.hasAttribute('data-product')) {
 var productData = JSON.parse(form.getAttribute('data-product'));

 // Get variant ID from selected option
 var variantInput = form.querySelector('[name="id"]');
 var variantId = variantInput ? parseInt(variantInput.value, 10) : null;

 // Find the selected variant in product data
 var selectedVariant = null;
 if (variantId && productData.variants) {
 selectedVariant = productData.variants.find(function(variant) {
 return variant.id === variantId;
 });
 }

 // Get price data with proper formatting
 var price = selectedVariant ? (selectedVariant.price / 100) : (productData.price / 100);
 var comparePrice = selectedVariant && selectedVariant.compare_at_price ?
 (selectedVariant.compare_at_price / 100) : null;

 // Get color option if available
 var colorOption = '';
 var colorInput = quickViewElement.querySelector(SELECTORS.quickViewColorOptions + ':checked');
 if (colorInput) {
 colorOption = colorInput.value;
 }

 return {
 productId: productData.id,
 variantId: variantId,
 productName: productData.title,
 price: price,
 sku: selectedVariant ? selectedVariant.sku : '',
 brand: productData.vendor || "{{ shop.name }}",
 category: productData.type || '',
 variantName: selectedVariant ? selectedVariant.title : '',
 comparePrice: comparePrice,
 colorOption: colorOption
 };
 }
 } catch (e) {
 if (CONFIG.debug) console.error('Error parsing quick view product data:', e);
 }

 // Fall back to original method if data-product approach fails
 // Original implementation as fallback
 var form = quickViewElement.querySelector(SELECTORS.quickViewForm);
 if (!form) return null;

 // Get variant ID
 var variantInput = form.querySelector(SELECTORS.quickViewVariantSelector);
 var variantId = variantInput ? parseInt(variantInput.value, 10) : extractDataAttribute(form, DATA_ATTRIBUTES.variantId);

 // Get product details from data attributes
 var productId = form.getAttribute('data-product-id') || '';
 var productName = form.getAttribute('data-product-name') || '';
 var productBrand = form.getAttribute('data-product-brand') || "{{ shop.name }}";
 var productCategory = form.getAttribute('data-product-category') || form.getAttribute('data-product-type') || '';
 var variantName = form.getAttribute('data-variant-name') || '';
 var sku = form.getAttribute('data-product-sku') || '';

 // Get pricing information
 var price = parseFloat(form.getAttribute('data-product-price') || '0');
 price = price > 1000 ? price / 100 : price;
 var comparePrice = parseFloat(form.getAttribute('data-product-compare-price') || '0');
 comparePrice = comparePrice > 0 ? (comparePrice > 1000 ? comparePrice / 100 : comparePrice) : null;

 // Get selected color if available
 var colorOption = '';
 var colorInput = quickViewElement.querySelector(SELECTORS.quickViewColorOptions + ':checked');
 if (colorInput) {
 colorOption = colorInput.value;
 if (!variantName) variantName = colorOption;
 }

 // Fallback to title element if name not in data attributes
 if (!productName) {
 var titleElem = quickViewElement.querySelector('.product-form__title, .quick-view__title, h1, h2');
 productName = titleElem ? titleElem.textContent.trim() : document.title;
 }

 return {
 productId: productId,
 variantId: variantId,
 productName: productName,
 price: price,
 sku: sku,
 brand: productBrand,
 category: productCategory,
 variantName: variantName,
 comparePrice: comparePrice,
 colorOption: colorOption
 };
 }

 /**
 * Pushes a view_item event when Quick View opens
 */
 function trackQuickViewViewItem(quickViewElement) {
 var productData = getQuickViewProductData(quickViewElement);
 if (!productData || !productData.variantId) return;

 var item = formatItem(
 productData.productId,
 productData.variantId,
 productData.productName,
 productData.price,
 1,
 productData.sku,
 productData.brand,
 productData.category,
 productData.variantName,
 [],
 productData.comparePrice,
 0,
 "Quick View"
 );

 pushEcomEvent('view_item', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: item.price,
 items: [item]
 },
 color_selected: productData.colorOption,
 variant_selected: productData.variantName
 });

 if (CONFIG.debug) console.log('Quick View view_item event fired:', item);
 }

 /**
 * Sets up event listeners for quick view interactions
 */
 function setupQuickViewEventListeners(quickViewElement) {
 if (!quickViewElement) return;

 // Track color option changes
 var colorOptions = quickViewElement.querySelectorAll(SELECTORS.quickViewColorOptions);
 colorOptions.forEach(function(option) {
 option.addEventListener('change', function() {
 trackQuickViewViewItem(quickViewElement);
 });
 });

 // Track add to cart from quick view
 var quickViewForm = quickViewElement.querySelector(SELECTORS.quickViewForm);
 if (quickViewForm) {
 quickViewForm.addEventListener('submit', function(e) {
 e.preventDefault();

 var productData = getQuickViewProductData(quickViewElement);
 if (!productData) {
 quickViewForm.submit();
 return;
 }

 // Get quantity
 var quantityInput = quickViewForm.querySelector('input[name="quantity"]');
 var quantity = quantityInput ? parseInt(quantityInput.value, 10) : 1;

 // Format the item data
 var addItem = formatItem(
 productData.productId,
 productData.variantId,
 productData.productName,
 productData.price,
 quantity,
 productData.sku,
 productData.brand,
 productData.category,
 productData.variantName,
 [],
 productData.comparePrice,
 0,
 "Quick View"
 );

 // Perform AJAX add-to-cart
 var formData = new FormData(quickViewForm);

 fetch('/cart/add.js', {
 method: 'POST',
 body: formData
 })
 .then(function(res) {
 if (!res.ok) throw new Error('Network response not ok');
 return res.json();
 })
 .then(function(item) {
 // Push add_to_cart event
 pushEcomEvent('add_to_cart', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: parseFloat((productData.price * quantity).toFixed(2)),
 items: [addItem]
 }
 });

 // Refresh cart state
 updateCartState();

 // Open mini-cart/drawer
 document.dispatchEvent(new CustomEvent('cart:open', { bubbles: true }));

 if (CONFIG.debug) console.log('Quick view add-to-cart success:', item);
 })
 .catch(function(err) {
 console.error('Quick view add-to-cart failed, falling back to normal submit:', err);
 quickViewForm.submit();
 });
 });
 }
 }

 /**
 * Initializes Quick View tracking
 */
 function initQuickViewTracking() {
 var quickViewObserver = new MutationObserver(function(mutations) {
 mutations.forEach(function(mutation) {
 if (mutation.addedNodes && mutation.addedNodes.length) {
 for (var i = 0; i < mutation.addedNodes.length; i++) {
 var node = mutation.addedNodes[i];
 if (node.nodeType === 1 && node.matches && node.matches(SELECTORS.quickViewContainer)) {
 setupQuickViewEventListeners(node);
 trackQuickViewViewItem(node);
 }
 }
 }
 });
 });
 quickViewObserver.observe(document.body, { childList: true, subtree: true });

 document.querySelectorAll(SELECTORS.quickViewContainer).forEach(function(el) {
 var attrObs = new MutationObserver(function(muts) {
 muts.forEach(function(mut) {
 if (mut.attributeName === 'class'
 && el.classList.contains('is-open')) {
 setupQuickViewEventListeners(el);
 trackQuickViewViewItem(el);
 }
 });
 });
 attrObs.observe(el, { attributes: true });
 });
 }

 // =========================================================
 // CART TRACKING FUNCTIONS
 // =========================================================
 /**
 * Initializes cart tracking on page load
 */
 function initCartTracking() {
 window.page.cartItems = [
 {%- for line_item in cart.items -%}
 formatItem(
 {{ line_item.product.id }},
 {{ line_item.variant.id }},
 {{ line_item.product.title | json }},
 {{ line_item.price | divided_by: 100 }},
 {{ line_item.quantity }},
 {{ line_item.sku | json }},
 {{ line_item.vendor | default: shop.name | json }},
 {{ line_item.product.type | json }},
 {{ line_item.variant.title | json }},
 [
 {%- for discount in line_item.discounts -%}
 {
 code: {{ discount.code | json }},
 title: {{ discount.title | json }},
 amount: {{ discount.amount | divided_by: 100 }}
 },
 {%- endfor -%}
 ],
 {%- if line_item.variant.compare_at_price != blank -%}
 {{ line_item.variant.compare_at_price | divided_by: 100 }},
 {%- else -%}
 null,
 {%- endif -%}
 {{ line_item.variant.inventory_quantity }},
 ""
 ),
 {%- endfor -%}
 ];
 {% if cart %}
 // Trigger cart_load event after cart items are initialized
 pushEcomEvent('cart_load', {
 ecommerce: {
 currency: window.page.currencyCode,
 items: window.page.cartItems.slice()
 }
 });
 {% endif %}
 }

 /**
 * Helper function to update cart state
 */
 function updateCartState() {
 fetch('{{ routes.root_url }}cart?section_id=cart-json')
 .then(res => res.text())
 .then(html => {
 // Parse the cart JSON from the response
 const newDom = new DOMParser().parseFromString(html, 'text/html');
 const cartJson = newDom.querySelector('script[type="application/json"]');
 const cart = JSON.parse(cartJson.textContent || '{}');
 window.page.cartItems = cart.items?.map(function(li) {
 // Create discount objects array from line item properties if available
 var discountObjects = [];
 if (li.discounts && li.discounts.length) {
 discountObjects = li.discounts.map(function(discount) {
 return {
 code: discount.code || "",
 title: discount.title || "",
 amount: discount.amount ? (discount.amount / 100) : 0
 };
 });
 }

 return formatItem(
 li.product_id,
 li.variant_id,
 li.title,
 li.price / 100,
 li.quantity,
 li.sku,
 li.vendor || "{{ shop.name }}",
 li.product_type,
 li.variant_title,
 discountObjects,
 li.compare_at_price ? li.compare_at_price/100 : null,
 li.inventory_quantity,
 ""
 );
 });
 pushEcomEvent('cart_update', {
 ecommerce: {
 currency: window.page.currencyCode,
 items: window.page.cartItems.slice()
 }
 });
 })
 .catch(function(error) {
 console.error('Error updating cart:', error);
 });
 }

 // =========================================================
 // PRODUCT VARIANT TRACKING
 // =========================================================
 /**
 * Track product variant changes and color swatch selections
 * Fires a view_item event with updated variant information
 */
 function trackVariantChange(variantId, colorOption) {
 {% if product %}
 var productData = {{ product | json }};

 // Find the selected variant
 var variant = productData.variants.find(function(v) {
 return v.id == variantId;
 });

 if (!variant) return;

 // Get color option if not provided
 if (!colorOption && variant.option1) {
 colorOption = variant.option1;
 }

 // Create discount objects array if applicable
 var discountObjects = [];
 if (variant.discounts && variant.discounts.length) {
 discountObjects = variant.discounts.map(function(discount) {
 return {
 code: discount.code || "",
 title: discount.title || "",
 amount: discount.amount ? (discount.amount / 100) : 0
 };
 });
 }

 var item = formatItem(
 productData.id,
 variant.id,
 productData.title,
 variant.price / 100,
 1,
 variant.sku,
 productData.vendor || "{{ shop.name }}",
 productData.type,
 variant.title,
 discountObjects,
 variant.compare_at_price ? variant.compare_at_price / 100 : null,
 variant.inventory_quantity || 0,
 ""
 );

 pushEcomEvent('view_item', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: item.price,
 items: [item]
 },
 color_selected: colorOption || (item.colorDescription || ""),
 variant_selected: variant.title || ""
 });

 if (CONFIG.debug) console.log('Variant changed:', item);
 {% endif %}
 }

 /**
 * Extracts product and variant information from a product family option
 * For cross-product color swatch selections
 */
 function handleProductFamilyChange(input) {
 try {
 // Find the closest product-family-swatch container
 var container = input.closest('[data-component="product-family-swatches"]') || input.hasAttribute('data-product') && input;
 if (!container) return;

 // Extract product data from the data-product attribute
 var productDataAttr = container.getAttribute('data-product');
 if (!productDataAttr) return;

 var productData = JSON.parse(productDataAttr);
 var colorOption = input.value;

 // Find the first available variant with this color option
 var variant = productData.variants.find(function(v) {
 return v.option1 === colorOption && v.available;
 });

 if (!variant) return;

 // Create discount objects array if applicable
 var discountObjects = [];
 if (variant.discounts && variant.discounts.length) {
 discountObjects = variant.discounts.map(function(discount) {
 return {
 code: discount.code || "",
 title: discount.title || "",
 amount: discount.amount ? (discount.amount / 100) : 0
 };
 });
 }

 var item = formatItem(
 productData.id,
 variant.id,
 productData.title,
 variant.price / 100,
 1,
 variant.sku,
 productData.vendor || "{{ shop.name }}",
 productData.type,
 variant.title,
 discountObjects,
 variant.compare_at_price ? variant.compare_at_price / 100 : null,
 variant.inventory_quantity || 0,
 ""
 );

 pushEcomEvent('view_item', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: item.price,
 items: [item]
 },
 color_selected: colorOption,
 variant_selected: variant.title,
 product_family_change: true
 });

 if (CONFIG.debug) console.log('Product family variant changed:', item);
 } catch (error) {
 console.error('Error handling product family change:', error);
 }
 }

 // =========================================================
 // FORM TRACKING
 // =========================================================
 /**
 * Form submission tracking
 * Excludes sensitive fields (passwords, payment info)
 */
 function trackFormSubmission(form, formName) {
 var formData = {};
 var inputs = form.querySelectorAll('input, select, textarea');
 inputs.forEach(function(input) {
 if (input.name && !input.name.match(/password|credit_card|cvv/i)) {
 formData[input.name] = input.value;
 }
 });
 window.dataLayer.push({
 event: 'form_submission',
 form_name: formName || form.getAttribute('name') || form.getAttribute('id') || 'unknown_form',
 form_data: formData
 });
 if (CONFIG.debug) console.log('Form submitted:', formName, formData);
 }

 // =========================================================
 // VARIANT CHANGE TRACKING
 // =========================================================
 /**
 * Initialize variant change tracking
 * Sets up event listeners for color swatches and variant changes
 */
 function initVariantChangeTracking() {
 // Variable to track the last event timestamp to prevent duplicates
 var lastEventTime = 0;
 var eventProcessingFlag = false;
 var lastTrackedVariantId = null;

 // Function to safely track variant changes without duplicates
 function safeTrackVariantChange(variantId, colorOption) {
 // Prevent duplicate events within 500ms and for the same variant
 var now = Date.now();
 if (eventProcessingFlag || (now - lastEventTime < CONFIG.eventThrottleDelay && variantId === lastTrackedVariantId)) {
 return false;
 }

 // Set the flag to prevent other handlers from triggering
 eventProcessingFlag = true;
 lastEventTime = now;
 lastTrackedVariantId = variantId;

 // Perform the tracking
 trackVariantChange(variantId, colorOption);

 // Reset the flag after a short delay
 setTimeout(function() {
 eventProcessingFlag = false;
 }, CONFIG.eventThrottleDelay);

 return true;
 }

 // Only use the change event for color swatch inputs
 document.addEventListener('change', function(e) {
 // Handle color swatch changes in main product
 if (e.target.matches(SELECTORS.colorSwatchInputs) && !e.target.hasAttribute('data-product-family-option')) {
 var form = e.target.closest('form') || e.target.closest('[data-component="main-product-standard"]')?.querySelector('form');
 if (form) {
 var variantInput = form.querySelector('[name="id"]');
 if (variantInput) {
 var variantId = parseInt(variantInput.value, 10);
 safeTrackVariantChange(variantId, e.target.value);
 }
 }
 }

 // Handle product family options separately
 if (e.target.hasAttribute('data-product-family-option')) {
 if (!eventProcessingFlag) {
 eventProcessingFlag = true;
 handleProductFamilyChange(e.target);
 setTimeout(function() {
 eventProcessingFlag = false;
 }, CONFIG.eventThrottleDelay);
 }
 }

 // Handle direct variant selector changes
 if (e.target.matches('[name="id"]')) {
 var variantId = parseInt(e.target.value, 10);
 var form = e.target.closest('form');
 if (form) {
 var colorInput = form.querySelector(SELECTORS.colorSwatchInputs + ':checked');
 var colorOption = colorInput ? colorInput.value : null;
 safeTrackVariantChange(variantId, colorOption);
 }
 }
 });

 // Create a MutationObserver to detect variant changes from system events
 var productForms = document.querySelectorAll('form[action*="/cart/add"]');
 if (productForms.length) {
 var variantObserver = new MutationObserver(function(mutations) {
 mutations.forEach(function(mutation) {
 if (mutation.type === 'attributes' && mutation.attributeName === 'value' &&
 mutation.target.name === 'id') {
 var variantId = parseInt(mutation.target.value, 10);
 var form = mutation.target.closest('form');
 if (form) {
 var colorInput = form.querySelector(SELECTORS.colorSwatchInputs + ':checked');
 var colorOption = colorInput ? colorInput.value : null;
 safeTrackVariantChange(variantId, colorOption);
 }
 }
 });
 });

 // Observe all variant selectors for attribute changes
 productForms.forEach(function(form) {
 var variantSelector = form.querySelector('[name="id"]');
 if (variantSelector) {
 variantObserver.observe(variantSelector, { attributes: true });
 }
 });
 }
 }

 // =========================================================
 // EVENT HANDLERS - UPDATED FOR MINI CART
 // =========================================================
 document.addEventListener('click', function(e) {
 var btn = e.target.closest(SELECTORS.cartQuantityButtons);
 if (!btn) return;

 // Handle mini cart specifically
 var isMiniCart = btn.closest('.minicart__item');
 var container = btn.closest(SELECTORS.cartItemContainer);
 if (!container && isMiniCart) {
 container = btn.closest(SELECTORS.miniCartItem);
 }
 if (!container) return;

 // Get quantity input
 var input = container.querySelector(SELECTORS.quantityInputField) ||
 container.querySelector(SELECTORS.miniCartQuantityInput);

 // Get current and new quantities
 var currentQty = input ? parseInt(input.value) : 1;
 var newQty = currentQty;

 // Determine quantity change
 if (btn.hasAttribute('data-quantity-increment')) {
 currentQty--;
 } else if (btn.hasAttribute('data-quantity-decrement')) {
 currentQty++;
 }

 // Get variant ID from line item key
 var variantId = null;
 var lineItemKey = container.getAttribute('data-line-item-key');
 if (lineItemKey) {
 variantId = parseInt(lineItemKey.split(':')[0]);
 }

 // Fallback to other data attributes if needed
 if (!variantId) {
 for (var i = 0; i < DATA_ATTRIBUTES.variantId.length; i++) {
 var attrValue = container.getAttribute(DATA_ATTRIBUTES.variantId[i]);
 if (attrValue) {
 variantId = parseInt(attrValue, 10);
 break;
 }
 }
 }

 if (!variantId || isNaN(variantId)) return;

 // Find matching cart item
 var item = (window.page.cartItems || []).find(it => it.variant_id === variantId);
 if (!item) return;

 // Get product details from mini cart
 var titleEl = container.querySelector('.minicart__item-title a');
 var itemName = titleEl ? titleEl.textContent.trim() : item.item_name;

 var priceEl = container.querySelector('[data-price]');
 var price = priceEl ? parseFloat(priceEl.textContent.replace(/[^0-9.-]/g, '')) : item.price;
 price = price / currentQty;
 // Get variant options
 var options = {};
 container.querySelectorAll('.minicart__item-option').forEach(function(opt) {
 var parts = opt.textContent.split(':');
 if (parts.length > 1) {
 options[parts[0].trim()] = parts[1].trim();
 }
 });

 // Get original price element if available (for discount calculations)
 var originalPriceEl = container.querySelector('[data-original-price], [data-compare-price], [data-compare-at-price]');
 var originalPrice = originalPriceEl ?
 parseFloat(originalPriceEl.textContent.replace(/[^0-9.-]/g, '')) :
 (item.originalPrice || item.price);
 originalPrice = originalPrice / currentQty;
 // Check for discount flags in the cart item container
 var hasDiscount = container.hasAttribute('data-has-discount') ||
 container.classList.contains('has-discount') ||
 container.querySelector('.discount, .discount-tag, .sale-tag');

 // Attempt to gather discount data from cart item DOM
 var discountObjects = [];
 var discountEl = container.querySelector('[data-discount-amount], [data-discount-code]');
 if (discountEl) {
 var discountAmount = discountEl.getAttribute('data-discount-amount');
 var discountCode = discountEl.getAttribute('data-discount-code') ||
 discountEl.getAttribute('data-discount-title') ||
 'Automatic Discount';

 if (discountAmount) {
 discountObjects.push({
 code: discountCode,
 title: discountCode,
 amount: parseFloat(discountAmount)
 });
 }
 }

 // Build updated item data
 var updatedItem = formatItem(
 item.product_id,
 variantId,
 itemName,
 price,
 newQty,
 item.sku,
 item.item_brand,
 item.item_category,
 options.Color || item.item_variant,
 discountObjects.length ? discountObjects : (item.discounts || []),
 originalPrice,
 0,
 ""
 );

 // Determine event type
 var isRemoveAction = btn.classList.contains('minicart__item-remove') ||
 btn.classList.contains('cart__item-remove') ||
 btn.hasAttribute('data-remove') ||
 (btn.hasAttribute('data-quantity-decrement') && newQty < 1) ||
 (btn.querySelector(SELECTORS.removeButtonIdentifiers) !== null);

 var isIncrement = btn.hasAttribute('data-quantity-increment');
 var isDecrement = btn.hasAttribute('data-quantity-decrement') && newQty >= 1;

 // Fire appropriate event
 if (isRemoveAction) {
 pushEcomEvent('remove_from_cart', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: item.price,
 items: [updatedItem]
 }
 });
 } else if (isIncrement) {
 pushEcomEvent('add_to_cart', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: item.price,
 items: [Object.assign({}, updatedItem, { quantity: 1 })]
 }
 });
 } else if (isDecrement) {
 pushEcomEvent('remove_from_cart', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: parseFloat((item.price * 1).toFixed(2)),
 items: [Object.assign({}, updatedItem, { quantity: 1 })]
 }
 });
 }

 // Update cart state after interaction
 setTimeout(updateCartState, 500);
 });

 // =========================================================
 // PAGE INITIALIZATION
 // =========================================================
 document.addEventListener('DOMContentLoaded', function() {

 // --- PAGE METADATA CONFIGURATION ---
 // Save in localStorage 'countryCode', 'countryLanguage', 'currencyCode'
 var shopCountryCode = Shopify.country;
 var shopLanguageCode = Shopify.locale;
 var shopCurrencyCode = Shopify.currency.active;

 localStorage.setItem('shopCountryCode',shopCountryCode);
 localStorage.setItem('shopLanguageCode',shopLanguageCode);
 localStorage.setItem('shopCurrencyCode',shopCurrencyCode);

 // Capture current page context and metadata
 window.page.pageType = "{{ template | split: '.' | first | capitalize }}";
 window.page.pageTitle = "{{ page_title | escape }}";
 window.page.url = "{{ shop.url }}{{ request.path }}";
 window.page.referrer = document.referrer || "";
 window.page.countryCode = window.localStorage.getItem('shopCountryCode') || 'undefined';
 window.page.brand = "{{ settings.brand | escape }}-" + window.page.countryCode;
 window.page.currencyCode = window.localStorage.getItem('shopCurrencyCode') || 'undefined';
 window.page.countryLanguage = window.localStorage.getItem('shopLanguageCode') || 'undefined';

 // Normalize page categories
 var pageType = window.page.pageType ? window.page.pageType.toLowerCase() : "";
 if (pageType === 'index') {
 window.page.pageCategory = 'homepage';
 } else if (pageType === 'product') {
 window.page.pageCategory = 'pdp';
 } else if (pageType === 'collection') {
 window.page.pageCategory = 'grid';
 } else if (pageType === 'search') {
 window.page.pageCategory = 'search';
 } else if (pageType === 'cart') {
 window.page.pageCategory = 'cart';
 } else if (pageType === 'checkout') {
 window.page.pageCategory = 'checkout';
 } else if (pageType === 'page') {
 window.page.pageCategory = 'page';
 } else if (pageType === 'article') {
 window.page.pageCategory = 'blog';
 } else {
 window.page.pageCategory = pageType || 'other';
 }

 window.page.pageName = window.page.pageCategory + ': ' + window.page.pageTitle;

 // Handle search-specific metadata
 window.page.searchTerm = "";
 window.page.searchResults = 0;
 {% if template contains 'search' %}
 window.page.searchTerm = {{ search.terms | json }} || "";
 {% if search.performed %}
 window.page.searchResults = {{ search.results_count | json }};
 {% endif %}
 {% endif %}

 // --- PUSH INITIAL DATA TO DATALAYER ---
 window.dataLayer.push({
 event: 'loadUserData',
 user: window.user
 });

 window.dataLayer.push({
 event: 'loadPageData',
 page: window.page
 });

 // Log debug information if enabled
 if (CONFIG.debug) {
 console.log("Data pushed to dataLayer:", { user: window.user, page: window.page });
 }

 // Initialize cart tracking
 initCartTracking();

 // Initialize event tracking for color swatches and variant changes
 initVariantChangeTracking();

 // Initialize quick view tracking
 initQuickViewTracking();

 // Track form submissions
 document.querySelectorAll('form').forEach(function(form) {
 form.addEventListener('submit', function(e) {
 var formName = form.getAttribute('name') ||
 form.getAttribute('id') ||
 form.getAttribute('action') ||
 'unknown_form';
 trackFormSubmission(this, formName);
 });
 });

 // --- SEARCH RESULTS TRACKING ---
 {% if template contains 'search' and search.performed %}
 (function() {
 var searchItems = [];
 {% for item in search.results %}
 {% if item.object_type == 'product' %}
 searchItems.push(formatItem(
 {{ item.id | json }},
 {{ item.selected_or_first_available_variant.id | json }},
 {{ item.title | json }},
 {{ item.price | divided_by: 100.0 }},
 1,
 {{ item.selected_or_first_available_variant.sku | json }},
 {{ item.vendor | json }},
 {{ item.type | json }},
 "Default Title",
 [],
 {{ item.selected_or_first_available_variant.compare_at_price | divided_by: 100.0 }},
 0,
 "Search Results"
 ));
 {% endif %}
 {% endfor %}
 pushEcomEvent('view_search_results', {
 search_term: {{ search.terms | json }},
 search_results: {{ search.results_count | json }},
 ecommerce: { items: searchItems }
 });
 {% if search.results_count > 0 %}
 // Track product selection from search results
 document.querySelectorAll(SELECTORS.searchResultItem).forEach(function(el) {
 el.addEventListener('click', function() {
 var productId = this.getAttribute('data-product-id');
 var matchedProduct = searchItems.find(function(it) { return String(it.product_id) === productId; });
 if (matchedProduct) {
 pushEcomEvent('select_item', {
 item_list_name: "Search Results",
 search_term: {{ search.terms | json }},
 ecommerce: { items: [matchedProduct] }
 });
 }
 });
 });
 {% endif %}
 })();
 {% endif %}

 // --- COLLECTION PAGE TRACKING ---
 {% if template contains 'collection' %}
 (function() {
 var items = [];
 {% for product in collection.products %}
 items.push(formatItem(
 {{ product.id | json }},
 {{ product.selected_or_first_available_variant.id | json }},
 {{ product.title | json }},
 {{ product.price | divided_by: 100.0 }},
 1,
 {{ product.selected_or_first_available_variant.sku | json }},
 {{ product.vendor | json }},
 {{ product.type | json }},
 "{{ product.selected_or_first_available_variant.title | escape }}",
 [],
 {{ product.compare_at_price_max | divided_by: 100.0 }},
 0,
 {{ collection.title | json }}
 ));
 {% endfor %}
 pushEcomEvent('view_item_list', {
 item_list_name: {{ collection.title | json }},
 item_list_id: {{ collection.id | json}},
 ecommerce: { items: items }
 });
 // Track product selection from collection
 document.querySelectorAll(SELECTORS.collectionProductItem).forEach(function(el) {
 el.addEventListener('click', function() {
 var productId = this.getAttribute('data-product-id');
 var matchedProduct = items.find(function(it) { return String(it.product_id) === productId; });
 if (matchedProduct) {
 pushEcomEvent('select_item', {
 item_list_name: {{ collection.title | json }},
 ecommerce: { items: [matchedProduct] }
 });
 }
 });
 });
 })();
 {% endif %}

 // --- PRODUCT DETAIL PAGE TRACKING ---
 {% if template contains 'product' %}
 (function() {
 // Check for discounts that might be applied at the product level
 var discountObjects = [];
 {% if product.discounts and product.discounts.size > 0 %}
 {% for discount in product.discounts %}
 discountObjects.push({
 code: {{ discount.code | json }} || "",
 title: {{ discount.title | json }} || "",
 amount: {{ discount.amount | divided_by: 100.0 | json }} || 0
 });
 {% endfor %}
 {% endif %}

 // Track initial product view
 var item = formatItem(
 {{ product.id | json }},
 {{ product.selected_or_first_available_variant.id | json }},
 {{ product.title | json }},
 {{ product.price | divided_by: 100.0 }},
 1,
 {{ product.selected_or_first_available_variant.sku | json }},
 {{ product.vendor | json }},
 {{ product.type | json }},
 "{{ product.selected_or_first_available_variant.title | escape }}",
 discountObjects,
 {{ product.selected_or_first_available_variant.compare_at_price | divided_by: 100.0 }},
 0,
 ""
 );
 pushEcomEvent('view_item', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: item.price,
 items: [item]
 }
 });
 })();
 {% endif %}

 // --- CART PAGE/DRAWER TRACKING ---
 {% if template contains 'cart' or template contains 'cart-template' %}
 (function() {
 var cartItems = window.page.cartItems || [];
 if (cartItems.length === 0) {
 // Fetch cart data if not already initialized
 fetch('/cart.js')
 .then(res => res.json())
 .then(cart => {
 cartItems = cart.items.map(function(item) {
 // Create discount objects array from line item properties if available
 var discountObjects = [];
 if (item.discounts && item.discounts.length) {
 discountObjects = item.discounts.map(function(discount) {
 return {
 code: discount.code || "",
 title: discount.title || "",
 amount: discount.amount ? (discount.amount / 100) : 0
 };
 });
 }

 return formatItem(
 item.product_id,
 item.variant_id,
 item.title,
 item.price / 100,
 item.quantity,
 item.sku,
 item.vendor || "{{ shop.name }}",
 item.product_type,
 item.variant_title,
 discountObjects,
 item.compare_at_price ? item.compare_at_price / 100 : null,
 item.inventory_quantity,
 ""
 );
 });
 pushEcomEvent('view_cart', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: cartItems.reduce(function(total, item) {
 return total + (item.price * item.quantity);
 }, 0),
 items: cartItems
 }
 });
 window.page.cartItems = cartItems;
 })
 .catch(function(error) {
 console.error('Error fetching cart for view_cart:', error);
 });
 } else {
 pushEcomEvent('view_cart', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: cartItems.reduce(function(total, item) {
 return total + (item.price * item.quantity);
 }, 0),
 items: cartItems
 }
 });
 }
 })();
 {% endif %}

 // --- ADD TO CART TRACKING ---
 document.addEventListener('submit', function(e) {
 var form = e.target.closest(SELECTORS.addToCartForm);
 if (form && form.hasAttribute('data-variant-editor')) return;
 if (!form) return;

 e.preventDefault();

 // Build FormData to capture everything (variant id, quantity, etc.)
 var formData = new FormData(form);

 // Get variant ID and quantity for tracking
 var variantId = formData.get('id');
 var quantity = parseInt(formData.get('quantity') || 1, 10);

 // Get relevant product info for tracking
 var productId = form.getAttribute('data-product-id') || '';
 var productName = form.getAttribute('data-product-name') || '';
 var productBrand = form.getAttribute('data-product-brand') || "{{ shop.name }}";
 var productCategory = form.getAttribute('data-product-category') || form.getAttribute('data-product-type') || '';
 var variantName = form.getAttribute('data-variant-name') || '';
 var sku = form.getAttribute('data-product-sku') || '';
 var price = parseFloat(form.getAttribute('data-product-price') || 0);
 price = price > 1000 ? price / 100 : price;
 var comparePrice = parseFloat(form.getAttribute('data-product-compare-price') || 0);
 comparePrice = comparePrice > 0 ? (comparePrice > 1000 ? comparePrice / 100 : comparePrice) : null;

 // Check for active discounts on the form
 var discountObjects = [];
 var discountEl = form.querySelector('[data-discount-amount], [data-discount-code]');
 if (discountEl) {
 var discountAmount = discountEl.getAttribute('data-discount-amount');
 var discountCode = discountEl.getAttribute('data-discount-code') ||
 discountEl.getAttribute('data-discount-title') ||
 'Automatic Discount';

 if (discountAmount) {
 discountObjects.push({
 code: discountCode,
 title: discountCode,
 amount: parseFloat(discountAmount)
 });
 }
 }

 // Perform AJAX add-to-cart
 fetch('/cart/add.js', {
 method: 'POST',
 body: formData
 })
 .then(function(res) {
 if (!res.ok) throw new Error('Network response not ok');
 return res.json();
 })
 .then(function(item) {
 // If we don't have product details from the form, use the returned item data
 if (!productId) productId = item.product_id;
 if (!productName) productName = item.product_title;
 if (!sku) sku = item.sku;
 if (!price) price = item.price / 100;
 if (!variantName) variantName = item.variant_title;

 // Check if the added item has discounts
 if (item.discounts && item.discounts.length && discountObjects.length === 0) {
 discountObjects = item.discounts.map(function(discount) {
 return {
 code: discount.code || "",
 title: discount.title || "",
 amount: discount.amount ? (discount.amount / 100) : 0
 };
 });
 }

 // Format the item data
 var addItem = formatItem(
 productId,
 variantId,
 productName,
 price,
 quantity,
 sku,
 productBrand,
 productCategory,
 variantName,
 discountObjects,
 comparePrice,
 0,
 form.closest(SELECTORS.quickViewContainer) ? "Quick View" : "Product Page"
 );

 // Push add_to_cart event
 pushEcomEvent('add_to_cart', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: parseFloat((price * quantity).toFixed(2)),
 items: [addItem]
 }
 });

 // Refresh cart state
 updateCartState();

 // Open mini-cart/drawer
 document.dispatchEvent(new CustomEvent('cart:open', { bubbles: true }));

 if (CONFIG.debug) console.log('AJAX add-to-cart success:', item);
 })
 .catch(function(err) {
 console.error('AJAX add-to-cart failed, falling back to normal submit:', err);
 // Fallback to full-page submit
 form.submit();
 });
 });

 // --- CHECKOUT TRACKING ---
 document.addEventListener('click', function(e) {
 var checkoutEl = e.target.closest(SELECTORS.checkoutSelectors);
 if (checkoutEl) {
 var items = window.page.cartItems || [];
 var proceedCheckout = function(items) {
 pushEcomEvent('begin_checkout', {
 ecommerce: {
 currency: window.page.currencyCode,
 value: parseFloat(items.reduce(function(sum, it) { return sum + (it.price * (it.quantity || 1)); }, 0).toFixed(2)),
 step: 1,
 items: items
 }
 });
 if (CONFIG.debug) console.log('Checkout started with items:', items);
 };

 // Fetch cart data if not already available
 if (items.length === 0) {
 fetch('/cart.js')
 .then(res => res.json())
 .then(cart => {
 items = cart.items.map(function(item) {
 // Create discount objects array from line item properties if available
 var discountObjects = [];
 if (item.discounts && item.discounts.length) {
 discountObjects = item.discounts.map(function(discount) {
 return {
 code: discount.code || "",
 title: discount.title || "",
 amount: discount.amount ? (discount.amount / 100) : 0
 };
 });
 }

 return formatItem(
 item.product_id,
 item.variant_id,
 item.title,
 item.price / 100,
 item.quantity,
 item.sku,
 item.vendor || "{{ shop.name }}",
 item.product_type,
 item.variant_title,
 discountObjects,
 item.compare_at_price ? item.compare_at_price / 100 : null,
 item.inventory_quantity,
 ""
 );
 });
 proceedCheckout(items);
 })
 .catch(function(error) {
 console.error('Error fetching cart for checkout event:', error);
 });
 } else {
 proceedCheckout(items);
 }
 }
 });


 // --- NOTIFY ME FORM TRACKING ---
 document.addEventListener('NOTIFY_ME_SUCCESS', function({ detail: { variant } }) {
 const event = {
 event: "loadEventData",
 page_location: pageType,
 page_title: document.title,
 page_referrer: document.referrer,
 eventCategory: pageType,
 eventAction: "Notify Me",
 eventLabel: `${variant.sku} - ${variant.option1}`,
 nonInteractive: 0,
 customMetrics: {},
 customVariables: {
 item_sku: variant.sku
 }
 };
 pushEcomEvent('loadEventData', event);
 });
 });

 // --- STICKY BAR ADD TO CART TRACKING ---
 document.addEventListener('DOMContentLoaded', function() {
 var stickyBar = document.querySelector(SELECTORS.stickyBarContainer);
 if (stickyBar) {
 var stickyButton = stickyBar.querySelector(SELECTORS.stickyBarButton);
 var stickyForm = stickyBar.querySelector('form');
 if (stickyButton && stickyForm) {
 stickyButton.addEventListener('click', function(e) {
 e.preventDefault();
 // Dispatch submit on sticky form to trigger global add_to_cart handler
 stickyForm.dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));
 });
 }
 }
 });

 /**
 * Initialize variant change tracking
 * Sets up event listeners for color swatches and variant changes
 */
 function initVariantChangeTracking() {
 // Variable to track the last event timestamp to prevent duplicates
 var lastEventTime = 0;
 var eventProcessingFlag = false;
 var lastTrackedVariantId = null;

 // Function to safely track variant changes without duplicates
 function safeTrackVariantChange(variantId, colorOption) {
 // Prevent duplicate events within 500ms and for the same variant
 var now = Date.now();
 if (eventProcessingFlag || (now - lastEventTime < 500 && variantId === lastTrackedVariantId)) {
 return false;
 }

 // Set the flag to prevent other handlers from triggering
 eventProcessingFlag = true;
 lastEventTime = now;
 lastTrackedVariantId = variantId;

 // Perform the tracking
 trackVariantChange(variantId, colorOption);

 // Reset the flag after a short delay
 setTimeout(function() {
 eventProcessingFlag = false;
 }, 500);

 return true;
 }

 // Only use the change event for color swatch inputs
 // This is the most reliable method for most implementations
 document.addEventListener('change', function(e) {
 // Handle color swatch changes in main product
 if (e.target.matches(SELECTORS.colorSwatchInputs) && !e.target.hasAttribute('data-product-family-option')) {
 var form = e.target.closest('form') || e.target.closest('[data-component="main-product-standard"]')?.querySelector('form');
 if (form) {
 var variantInput = form.querySelector('[name="id"]');
 if (variantInput) {
 var variantId = parseInt(variantInput.value, 10);
 safeTrackVariantChange(variantId, e.target.value);
 }
 }
 }

 // Handle product family options separately
 if (e.target.hasAttribute('data-product-family-option')) {
 // Only process if another event isn't already being processed
 if (!eventProcessingFlag) {
 eventProcessingFlag = true;
 handleProductFamilyChange(e.target);
 setTimeout(function() {
 eventProcessingFlag = false;
 }, 500);
 }
 }

 // Handle direct variant selector changes
 if (e.target.matches('[name="id"]')) {
 var variantId = parseInt(e.target.value, 10);
 var form = e.target.closest('form');
 if (form) {
 var colorInput = form.querySelector(SELECTORS.colorSwatchInputs + ':checked');
 var colorOption = colorInput ? colorInput.value : null;
 safeTrackVariantChange(variantId, colorOption);
 }
 }
 });

 // Create a MutationObserver to detect variant changes from system events
 // This is especially important for implementations that update variants through JS
 var productForms = document.querySelectorAll('form[action*="/cart/add"]');
 if (productForms.length) {
 var variantObserver = new MutationObserver(function(mutations) {
 mutations.forEach(function(mutation) {
 if (mutation.type === 'attributes' && mutation.attributeName === 'value' &&
 mutation.target.name === 'id') {
 var variantId = parseInt(mutation.target.value, 10);
 var form = mutation.target.closest('form');
 if (form) {
 var colorInput = form.querySelector(SELECTORS.colorSwatchInputs + ':checked');
 var colorOption = colorInput ? colorInput.value : null;
 safeTrackVariantChange(variantId, colorOption);
 }
 }
 });
 });

 // Observe all variant selectors for attribute changes
 productForms.forEach(function(form) {
 var variantSelector = form.querySelector('[name="id"]');
 if (variantSelector) {
 variantObserver.observe(variantSelector, { attributes: true });
 }
 });
 }
 }
 })();
</script>
```
 

### Checkout Custom Pixel - ES5
 

##### customPixel Checkout
 
```
/* Shopify Checkout GA4 Tracking Implementation */
var GTM_CONTAINER_ID = 'GTM-00000000';
var GTM_CONTAINER_URL = 'https://www.googletagmanager.com';

// SHA-256 hashing helper
function sha256Hash(value) {
 return crypto.subtle.digest('SHA-256', new TextEncoder().encode(value))
 .then(function(buf) {
 var bytes = Array.prototype.slice.call(new Uint8Array(buf));
 return bytes.map(function(b) {
 var hex = b.toString(16);
 return hex.length === 1 ? '0' + hex : hex;
 }).join('');
 });
}

// Global config
var storeCountryCode = localStorage.getItem('shopCountryCode') || 'nan';
var storeLanguageCode = localStorage.getItem('shopLanguageCode') || 'nan';
var storeCurrencyCode = localStorage.getItem('shopCurrencyCode') || 'nan';
var formattedItemId = true;

/**
 * Formats a checkout line item for GA4, including accurate discount & sale fields.
 */
function formatItem(item) {
 var variant = item.variant || {};
 var product = variant.product || {};
 var quantity = item.quantity || 1;

 // List price per unit (pre-discount)
 var rawPrice = (variant.price && variant.price.amount) || item.price || 0;
 var listPrice = parseFloat(parseFloat(rawPrice) || 0).toFixed(2);
 listPrice = parseFloat(listPrice);

 // Total discount applied to line
 var totalLineDiscount = (item.discountAllocations || []).reduce(function(sum, da) {
 var amt = (da.amount && da.amount.amount) || da.amount || 0;
 return sum + parseFloat(amt) || 0;
 }, 0);
 totalLineDiscount = parseFloat(totalLineDiscount.toFixed(2));

 // Per-item discount
 var perItemDiscount = quantity ? totalLineDiscount / quantity : 0;
 perItemDiscount = parseFloat(perItemDiscount.toFixed(2));

 // Final unit price after per-item discount
 var discountedUnitPrice = parseFloat((listPrice - perItemDiscount).toFixed(2));

 // onSale flag
 var onSale = perItemDiscount > 0;

 // Item discount amount
 var itemDiscountAmount = onSale ? parseFloat((listPrice - discountedUnitPrice).toFixed(2))
 : 0;

 // Build GA4 item object
 var obj = {
 sh_item_id: formattedItemId ? [storeCountryCode, product.id, variant.id].filter(Boolean).join('_')
 : (product.id || ''),
 item_id: variant.sku ? variant.sku.split(':').slice(0, 2).join('')
 : '',
 item_name: item.title || product.title || '',
 item_brand: product.vendor || '{{ shop.name }}',
 item_category: product.productType || product.type || '',
 item_variant: variant.title || '',
 price: discountedUnitPrice,
 originalPrice: listPrice,
 saleDiscountAmount: itemDiscountAmount,
 onSale: onSale,
 quantity: quantity,
 sku: variant.sku || '',
 styleCode: '',
 colorCode: '',
 sizeCode: '',
 colorDescription: '',
 product_id: product.id || '',
 variant_id: variant.id || ''
 };

 if (variant.sku) {
 var parts = variant.sku.split(':');
 obj.styleCode = parts[1] || '';
 obj.colorCode = parts[2] || '';
 obj.sizeCode = parts[3] || '';
 obj.colorDescription = variant.title ? variant.title.split(' / ')[0]
 : '';
 }

 return obj;
}

/**
 * Extracts discount codes string from applications
 */
function getDiscountCodes(apps) {
 return (apps || [])
 .map(function(d) { return d.code || d.title; })
 .filter(function(c) { return !!c; })
 .join(',');
}

/**
 * Pushes customer & page data, hashing PII
 */
function pushCustomerPageData(checkoutData, hashes) {
 window.user = {
 loggedIn: !!(checkoutData.customer && checkoutData.customer.id),
 customer_id: (checkoutData.customer && checkoutData.customer.id) || null,
 totalSpent: (checkoutData.customer && checkoutData.customer.total_spent) || 0,
 orderCount: (checkoutData.customer && checkoutData.customer.orders_count) || 0,
 Email: checkoutData.customer.email || '',
 encodedEmail: checkoutData.customer.email ? btoa(checkoutData.customer.email) : '',
 encodedEmailSha: hashes.email || '',
 vfEmployee:
 checkoutData.customer.email &&
 checkoutData.customer.email.toLowerCase().indexOf(
 '@vfc.com',
 checkoutData.customer.email.length - '@vfc.com'.length
 ) !== -1,
 guest_id: (function() {
 try { return localStorage.getItem('guestId'); }
 catch (e) { return ''; }
 })()
 };

 window.page = {
 pageType: 'Checkout',
 brand: '(UPDATE BRAND HERE)-' + storeCountryCode,
 countryCode: storeCountryCode,
 currencyCode: storeCurrencyCode,
 url: window.location.href,
 referrer: document.referrer || '',
 countryLanguage: storeLanguageCode,
 pageCategory: 'checkout',
 pageName: 'checkout: ' + (document.title || 'Checkout')
 };

 window.dataLayer.push({ event: 'loadPageData', page: window.page });
 window.dataLayer.push({ event: 'loadUserData', user: window.user });
}

/**
 * Pushes GA4 ecommerce event with accurate discounts
 */
function pushEcommerceEvent(eventName, checkout) {
 if (!checkout) { return; }

 var apps = checkout.discountApplications || [];
 var codes = getDiscountCodes(apps);
 var items = (checkout.lineItems || []).map(formatItem);

 var totalValue = parseFloat(
 ((checkout.totalPrice && checkout.totalPrice.amount) || 0).toFixed(2)
 );
 var taxValue = parseFloat(
 ((checkout.totalTax && checkout.totalTax.amount) || 0).toFixed(2)
 );
 var shippingValue = parseFloat(
 ((checkout.shippingLine &&
 checkout.shippingLine.price &&
 checkout.shippingLine.price.amount) ||
 0
 ).toFixed(2)
 );
 var shippingTier = (checkout && checkout.delivery && 
 checkout.delivery.selectedDeliveryOptions && 
 checkout.delivery.selectedDeliveryOptions[0] && 
 checkout.delivery.selectedDeliveryOptions[0].title || undefined
 );

 var actionField = {
 transaction_id: (checkout.order && checkout.order.id) || null,
 value: totalValue,
 tax: taxValue,
 shipping: shippingValue,
 shipping_tier: shippingTier,
 coupon: codes,
 discount_applications: apps
 };

 var tx = (checkout.transactions && checkout.transactions[0]) || {};
 actionField.paymentType = tx.gateway || '';
 actionField.paymentMethod = tx.paymentMethod || '';
 actionField.affiliation = '(UPDATE BRAND HERE)-' + storeCountryCode;
 actionField.order_name = (checkout.order && checkout.order.name) || '';

 window.dataLayer.push({ ecommerce: null });
 window.dataLayer.push({
 event: eventName,
 ecommerce: {
 actionField: actionField,
 items: items
 }
 });
}

// Initialize only on Shopify checkout pages
if (/\/checkouts?\//.test(location.pathname)) {
 window.dataLayer = window.dataLayer || [];
 // Page view event
 window.dataLayer.push({ event: 'page_view', window: 'checkout'});
 // Load Google Tag Manager
 (function(w, d, s, l, i) {
 w[l] = w[l] || [];
 w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
 var f = d.getElementsByTagName(s)[0];
 var j = d.createElement(s);
 var dl = l !== 'dataLayer' ? '&l=' + l : '';
 j.async = true;
 j.src = GTM_CONTAINER_URL + '/gtm.js?id=' + i + dl;
 f.parentNode.insertBefore(j, f);
 })(window, document, 'script', 'dataLayer', GTM_CONTAINER_ID);

 analytics.subscribe('page_viewed', function(e) {
 var raw = (init && init.data) || {};
 var cust = raw.customer ? raw.customer : raw;
    Promise.all([
      cust.email ? sha256Hash(cust.email) : Promise.resolve(''),
      cust.phone ? sha256Hash(cust.phone) : Promise.resolve('')
    ]).then(function(hashes) {
      pushCustomerPageData({ customer: cust }, {
        email: hashes[0],
        phone: hashes[1]
      });
    });
  });

 analytics.subscribe('checkout_contact_info_submitted', function(e) {
 pushEcommerceEvent('add_contact_info', e.data.checkout);
 });

 analytics.subscribe('checkout_shipping_info_submitted', function(e) {
 pushEcommerceEvent('add_shipping_info', e.data.checkout);
 });

 analytics.subscribe('payment_info_submitted', function(e) {
 pushEcommerceEvent('add_payment_info', e.data.checkout);
 });

 analytics.subscribe('checkout_completed', function(e) {
 pushEcommerceEvent('purchase', e.data.checkout);
 });
}
```
 

### GTM CONTAINER IMPORT START - JSON
 

##### GTM Starter Container
 
```
{
 "exportFormatVersion": 2,
 "exportTime": "2024-07-07 01:50:13",
 "containerVersion": {
 "path": "accounts/6061284649/containers/96000106/versions/0",
 "accountId": "6061284649",
 "containerId": "96000106",
 "containerVersionId": "0",
 "container": {
 "path": "accounts/6061284649/containers/96000106",
 "accountId": "6061284649",
 "containerId": "96000106",
 "name": "416.is",
 "publicId": "GTM-WLFLL5Q",
 "usageContext": [
 "WEB"
 ],
 "fingerprint": "1667061701449",
 "tagManagerUrl": "https://tagmanager.google.com/#/container/accounts/6061284649/containers/96000106/workspaces?apiLink=container",
 "features": {
 "supportUserPermissions": true,
 "supportEnvironments": true,
 "supportWorkspaces": true,
 "supportGtagConfigs": false,
 "supportBuiltInVariables": true,
 "supportClients": false,
 "supportFolders": true,
 "supportTags": true,
 "supportTemplates": true,
 "supportTriggers": true,
 "supportVariables": true,
 "supportVersions": true,
 "supportZones": true,
 "supportTransformations": false
 },
 "tagIds": [
 "GTM-WLFLL5Q"
 ]
 },
 "tag": [
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "9",
 "name": "GA4 - Begin Checkout",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "currency"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.currency}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "value"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.value}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "items"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.items}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "begin_checkout"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678788",
 "firingTriggerId": [
 "8"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "13",
 "name": "GA4 - Remove Form Cart",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "currency"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.currency}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "value"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.value}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "items"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.items}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "remove_from_cart"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678789",
 "firingTriggerId": [
 "12"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "17",
 "name": "GA4 - Contact Form Submit",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "form_id"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - form_id}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "contact_form_submit"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678790",
 "firingTriggerId": [
 "16"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "20",
 "name": "GA4 - Add Shipping Info",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "currency"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.currency}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "value"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.value}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "coupon"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dle - ecommerce.coupon}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "items"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.items}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "page_location"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - page_location}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "add_shipping_info"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678791",
 "firingTriggerId": [
 "19"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "23",
 "name": "GA4 - View Cart",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "currency"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.currency}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "value"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.value}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "items"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.items}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "view_cart"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678791",
 "firingTriggerId": [
 "22"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "32",
 "name": "GA4 - View Item List",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "currency"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.currency}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "value"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.value}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "items"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.items}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "item_list_id"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.item_list_id}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "item_list_name"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.item_list_name}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "view_item_list"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678792",
 "firingTriggerId": [
 "31"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "34",
 "name": "GA4 - Checkout Page View",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "page_location"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - page_location}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "page_view"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678792",
 "firingTriggerId": [
 "33"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "35",
 "name": "GA4 - View Item",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "currency"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.currency}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "value"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.value}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "items"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.items}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "view_item"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678793",
 "firingTriggerId": [
 "21"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "36",
 "name": "G-Tag Config",
 "type": "googtag",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "tagId",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 },
 {
 "type": "LIST",
 "key": "configSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "send_page_view"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{js - sent_page_view}}"
 }
 ]
 }
 ]
 }
 ],
 "fingerprint": "1720312678794",
 "firingTriggerId": [
 "2147479573"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "39",
 "name": "GA4 - Purchase",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "currency"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.currency}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "value"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.value}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "coupon"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dle - ecommerce.coupon}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "transaction_id"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.transaction_id}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "shipping"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.shipping}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "tax"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.tax}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "items"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.items}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "page_location"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - page_location}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "purchase"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678794",
 "firingTriggerId": [
 "38"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "41",
 "name": "GA4 - Email Click",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "email_click"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678795",
 "firingTriggerId": [
 "28"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "45",
 "name": "GA4 - Search",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "search_term"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - search_term}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "search"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678796",
 "firingTriggerId": [
 "14"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "46",
 "name": "GA4 - Add Payment Info",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "LIST",
 "key": "eventSettingsTable",
 "list": [
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "currency"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.currency}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "value"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.value}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "coupon"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dle - ecommerce.coupon}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "items"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - ecommerce.items}}"
 }
 ]
 },
 {
 "type": "MAP",
 "map": [
 {
 "type": "TEMPLATE",
 "key": "parameter",
 "value": "page_location"
 },
 {
 "type": "TEMPLATE",
 "key": "parameterValue",
 "value": "{{dlv - page_location}}"
 }
 ]
 }
 ]
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "add_payment_info"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678796",
 "firingTriggerId": [
 "40"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "48",
 "name": "GA4 - Phone Click",
 "type": "gaawe",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "sendEcommerceData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enhancedUserId",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "phone_number_click"
 },
 {
 "type": "TEMPLATE",
 "key": "measurementIdOverride",
 "value": "{{[UPDATE THIS] ga4 - measurement id}}"
 }
 ],
 "fingerprint": "1720312678797",
 "firingTriggerId": [
 "25"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "178",
 "name": "Google Ads - dynamic remarketing",
 "type": "sp",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "eventItems",
 "value": "{{js - ads-remarketing-items}}"
 },
 {
 "type": "BOOLEAN",
 "key": "enableConversionLinker",
 "value": "true"
 },
 {
 "type": "TEMPLATE",
 "key": "eventValue",
 "value": "{{value}}"
 },
 {
 "type": "BOOLEAN",
 "key": "enableDynamicRemarketing",
 "value": "true"
 },
 {
 "type": "TEMPLATE",
 "key": "eventName",
 "value": "{{Event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "conversionCookiePrefix",
 "value": "_gcl"
 },
 {
 "type": "TEMPLATE",
 "key": "conversionId",
 "value": "{{[UPDATE THIS] conversion id}}"
 },
 {
 "type": "TEMPLATE",
 "key": "customParamsFormat",
 "value": "NONE"
 },
 {
 "type": "BOOLEAN",
 "key": "rdp",
 "value": "false"
 }
 ],
 "fingerprint": "1720313162493",
 "firingTriggerId": [
 "177",
 "2147479553"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "paused": true,
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "198",
 "name": "Conversion Linker",
 "type": "gclidw",
 "parameter": [
 {
 "type": "BOOLEAN",
 "key": "enableCrossDomain",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enableUrlPassthrough",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enableCookieOverrides",
 "value": "false"
 }
 ],
 "fingerprint": "1720312556115",
 "firingTriggerId": [
 "2147479553"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "tagId": "205",
 "name": "[Purchase] Google Ads - conversion tracking",
 "type": "awct",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "orderId",
 "value": "{{transaction id}}"
 },
 {
 "type": "BOOLEAN",
 "key": "enableProductReporting",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "cssProvidedEnhancedConversionValue",
 "value": "{{UPD}}"
 },
 {
 "type": "BOOLEAN",
 "key": "enableShippingData",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enableNewCustomerReporting",
 "value": "false"
 },
 {
 "type": "BOOLEAN",
 "key": "enableConversionLinker",
 "value": "true"
 },
 {
 "type": "TEMPLATE",
 "key": "conversionValue",
 "value": "{{value}}"
 },
 {
 "type": "BOOLEAN",
 "key": "enableEnhancedConversion",
 "value": "true"
 },
 {
 "type": "TEMPLATE",
 "key": "conversionCookiePrefix",
 "value": "_gcl"
 },
 {
 "type": "TEMPLATE",
 "key": "conversionId",
 "value": "{{[UPDATE THIS] conversion id}}"
 },
 {
 "type": "TEMPLATE",
 "key": "currencyCode",
 "value": "{{currency}}"
 },
 {
 "type": "TEMPLATE",
 "key": "conversionLabel",
 "value": "{{[UPDATE THIS] conversion label}}"
 },
 {
 "type": "BOOLEAN",
 "key": "rdp",
 "value": "false"
 }
 ],
 "fingerprint": "1720312556119",
 "firingTriggerId": [
 "192"
 ],
 "parentFolderId": "170",
 "tagFiringOption": "ONCE_PER_EVENT",
 "monitoringMetadata": {
 "type": "MAP"
 },
 "consentSettings": {
 "consentStatus": "NOT_SET"
 }
 }
 ],
 "trigger": [
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "8",
 "name": "dle - begin_checkout",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "begin_checkout"
 }
 ]
 }
 ],
 "fingerprint": "1720312678798",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "12",
 "name": "dle - remove_from_cart",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "remove_from_cart"
 }
 ]
 }
 ],
 "fingerprint": "1720312876692",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "14",
 "name": "dle - search",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "search"
 }
 ]
 }
 ],
 "fingerprint": "1720312865853",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "16",
 "name": "dle - contact_form_submit",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "contact_form_submit"
 }
 ]
 }
 ],
 "fingerprint": "1720312928087",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "19",
 "name": "dle - add_shipping_info",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "add_shipping_info"
 }
 ]
 }
 ],
 "fingerprint": "1720312821901",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "21",
 "name": "dle - view_item",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "view_item"
 }
 ]
 }
 ],
 "fingerprint": "1720312843240",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "22",
 "name": "dle - view_cart",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "view_cart"
 }
 ]
 }
 ],
 "fingerprint": "1720312853429",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "25",
 "name": "dle - phone_number_click",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "phone_number_click"
 }
 ]
 }
 ],
 "fingerprint": "1720312899019",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "28",
 "name": "dle - email_click",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "email_click"
 }
 ]
 }
 ],
 "fingerprint": "1720312910419",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "31",
 "name": "dle - view_item_list",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "view_item_list"
 }
 ]
 }
 ],
 "fingerprint": "1720312830602",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "33",
 "name": "dle - page_view",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "page_view"
 }
 ]
 }
 ],
 "fingerprint": "1720312990001",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "38",
 "name": "dle - purchase",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "purchase"
 }
 ]
 }
 ],
 "fingerprint": "1720312888351",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "40",
 "name": "dle - add_payment_info",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "add_payment_info"
 }
 ]
 }
 ],
 "fingerprint": "1720312810396",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "42",
 "name": "dle - add_to_cart",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "add_to_cart"
 }
 ]
 }
 ],
 "fingerprint": "1720312678939",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "44",
 "name": "dle - newsletter_signup",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "newsletter_signup"
 }
 ]
 }
 ],
 "fingerprint": "1720312678940",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "171",
 "name": "add_shipping_info",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "add_shipping_info"
 }
 ]
 }
 ],
 "fingerprint": "1720312556105",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "172",
 "name": "remove_from_cart",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "remove_from_cart"
 }
 ]
 }
 ],
 "fingerprint": "1720312556105",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "173",
 "name": "add_to_cart",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "add_to_cart"
 }
 ]
 }
 ],
 "fingerprint": "1720312556106",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "177",
 "name": "all rmkt events",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "MATCH_REGEX",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "view_item|view_item_list|add_to_cart|remove_from_cart|view_cart|begin_checkout|add_payment_info|add_shipping_info|purchase"
 }
 ]
 }
 ],
 "fingerprint": "1720312556107",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "179",
 "name": "view_item_list",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "view_item_list"
 }
 ]
 }
 ],
 "fingerprint": "1720312556108",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "180",
 "name": "form - contact form",
 "type": "FORM_SUBMISSION",
 "filter": [
 {
 "type": "MATCH_REGEX",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click ID}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "ContactForm"
 }
 ]
 },
 {
 "type": "CONTAINS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click URL}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "#ContactForm"
 }
 ]
 }
 ],
 "waitForTags": {
 "type": "TEMPLATE"
 },
 "checkValidation": {
 "type": "TEMPLATE"
 },
 "waitForTagsTimeout": {
 "type": "TEMPLATE",
 "value": "2000"
 },
 "uniqueTriggerId": {
 "type": "TEMPLATE"
 },
 "fingerprint": "1720312556108",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "181",
 "name": "add_payment_info",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "add_payment_info"
 }
 ]
 }
 ],
 "fingerprint": "1720312556109",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "185",
 "name": "begin_checkout",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "begin_checkout"
 }
 ]
 }
 ],
 "fingerprint": "1720312556110",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "188",
 "name": "view_item",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "view_item"
 }
 ]
 }
 ],
 "fingerprint": "1720312556111",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "191",
 "name": "form - user register",
 "type": "FORM_SUBMISSION",
 "filter": [
 {
 "type": "CONTAINS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click URL}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "account"
 }
 ]
 },
 {
 "type": "MATCH_REGEX",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click ID}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "register-customer|create_customer"
 }
 ]
 }
 ],
 "waitForTags": {
 "type": "TEMPLATE"
 },
 "checkValidation": {
 "type": "TEMPLATE"
 },
 "waitForTagsTimeout": {
 "type": "TEMPLATE",
 "value": "2000"
 },
 "uniqueTriggerId": {
 "type": "TEMPLATE"
 },
 "fingerprint": "1720312556112",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "192",
 "name": "purchase",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "purchase"
 }
 ]
 }
 ],
 "fingerprint": "1720312774960",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "196",
 "name": "view_cart",
 "type": "CUSTOM_EVENT",
 "customEventFilter": [
 {
 "type": "EQUALS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{_event}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "view_cart"
 }
 ]
 }
 ],
 "fingerprint": "1720312556114",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "201",
 "name": "form - user login",
 "type": "FORM_SUBMISSION",
 "filter": [
 {
 "type": "MATCH_REGEX",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click ID}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "customer_login"
 }
 ]
 },
 {
 "type": "CONTAINS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click URL}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "account"
 }
 ]
 }
 ],
 "waitForTags": {
 "type": "TEMPLATE"
 },
 "checkValidation": {
 "type": "TEMPLATE"
 },
 "waitForTagsTimeout": {
 "type": "TEMPLATE",
 "value": "2000"
 },
 "uniqueTriggerId": {
 "type": "TEMPLATE"
 },
 "fingerprint": "1720312556118",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "202",
 "name": "form - newsletter subscription",
 "type": "FORM_SUBMISSION",
 "filter": [
 {
 "type": "MATCH_REGEX",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click ID}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "newsletter|ContactFooter"
 },
 {
 "type": "BOOLEAN",
 "key": "ignore_case",
 "value": "true"
 }
 ]
 },
 {
 "type": "MATCH_REGEX",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click URL}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "newsletter|ContactFooter"
 },
 {
 "type": "BOOLEAN",
 "key": "ignore_case",
 "value": "true"
 }
 ]
 },
 {
 "type": "MATCH_REGEX",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click Classes}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "newsletter"
 },
 {
 "type": "BOOLEAN",
 "key": "ignore_case",
 "value": "true"
 }
 ]
 }
 ],
 "waitForTags": {
 "type": "TEMPLATE"
 },
 "checkValidation": {
 "type": "TEMPLATE"
 },
 "waitForTagsTimeout": {
 "type": "TEMPLATE",
 "value": "2000"
 },
 "uniqueTriggerId": {
 "type": "TEMPLATE"
 },
 "fingerprint": "1720312556118",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "206",
 "name": "email_click",
 "type": "LINK_CLICK",
 "filter": [
 {
 "type": "CONTAINS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click URL}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "mailto:"
 }
 ]
 }
 ],
 "waitForTags": {
 "type": "BOOLEAN",
 "value": "false"
 },
 "checkValidation": {
 "type": "BOOLEAN",
 "value": "false"
 },
 "waitForTagsTimeout": {
 "type": "TEMPLATE",
 "value": "2000"
 },
 "uniqueTriggerId": {
 "type": "TEMPLATE"
 },
 "fingerprint": "1720312556120",
 "parentFolderId": "170"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "triggerId": "209",
 "name": "phone_number_click",
 "type": "LINK_CLICK",
 "filter": [
 {
 "type": "CONTAINS",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "arg0",
 "value": "{{Click URL}}"
 },
 {
 "type": "TEMPLATE",
 "key": "arg1",
 "value": "tel:"
 }
 ]
 }
 ],
 "waitForTags": {
 "type": "BOOLEAN",
 "value": "false"
 },
 "checkValidation": {
 "type": "BOOLEAN",
 "value": "false"
 },
 "waitForTagsTimeout": {
 "type": "TEMPLATE",
 "value": "2000"
 },
 "uniqueTriggerId": {
 "type": "TEMPLATE"
 },
 "fingerprint": "1720312556121",
 "parentFolderId": "170"
 }
 ],
 "variable": [
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "4",
 "name": "dlv - ecommerce.value",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.value"
 }
 ],
 "fingerprint": "1720312678940",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "5",
 "name": "[UPDATE THIS] ga4 - measurement id",
 "type": "c",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "value",
 "value": "G-REPLACE"
 }
 ],
 "fingerprint": "1720312739950",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "6",
 "name": "dlv - ecommerce.items",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.items"
 }
 ],
 "fingerprint": "1720312678941",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "7",
 "name": "dlv - ecommerce.currency",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.currency"
 }
 ],
 "fingerprint": "1720312678942",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "10",
 "name": "dle - ecommerce.coupon",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.coupon"
 }
 ],
 "fingerprint": "1720312678942",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "11",
 "name": "dlv - page_location",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "page_location"
 }
 ],
 "fingerprint": "1720312678943",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "15",
 "name": "dlv - form_id",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "form_id"
 }
 ],
 "fingerprint": "1720312678943",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "18",
 "name": "dlv - ecommerce.shipping",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.currency"
 }
 ],
 "fingerprint": "1720312678943",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "24",
 "name": "js - sent_page_view",
 "type": "jsm",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "javascript",
 "value": "function() {\n return !{{Page URL}}.includes('/sandbox/modern/');\n}"
 }
 ],
 "fingerprint": "1720312678944",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "26",
 "name": "dlv - ecommerce.transaction_id",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.transaction_id"
 }
 ],
 "fingerprint": "1720312678944",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "27",
 "name": "dlv - search_term",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "search_term"
 }
 ],
 "fingerprint": "1720312678945",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "29",
 "name": "dlv - ecommerce.item_list_id",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.item_list_id"
 }
 ],
 "fingerprint": "1720312678945",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "30",
 "name": "dlv - ecommerce.item_list_name",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.item_list_name"
 }
 ],
 "fingerprint": "1720312678946",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "37",
 "name": "dlv - ecommerce.tax",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.tax"
 }
 ],
 "fingerprint": "1720312678946",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "47",
 "name": "js - ads-remarketing-items",
 "type": "jsm",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "javascript",
 "value": "function() {\n return {{dlv - ecommerce.items}}.map(function(item) {\n return {id: item.item_id, google_business_vertical: 'retail' }\n });\n}"
 }
 ],
 "fingerprint": "1720312678947",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "174",
 "name": "value",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.value"
 }
 ],
 "fingerprint": "1720312556106",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "175",
 "name": "items",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.items"
 }
 ],
 "fingerprint": "1720312556106",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "176",
 "name": "[UPDATE THIS] conversion id",
 "type": "c",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "value",
 "value": "REPLACE"
 }
 ],
 "fingerprint": "1720312556107",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "190",
 "name": "currency",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "ecommerce.currency"
 }
 ],
 "fingerprint": "1720312556112",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "193",
 "name": "customer",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "customer"
 }
 ],
 "fingerprint": "1720312556113",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "194",
 "name": "UPD",
 "type": "awec",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "mode",
 "value": "CODE"
 },
 {
 "type": "TEMPLATE",
 "key": "dataSource",
 "value": "{{customer}}"
 }
 ],
 "fingerprint": "1720312556114",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "203",
 "name": "[UPDATE THIS] conversion label",
 "type": "c",
 "parameter": [
 {
 "type": "TEMPLATE",
 "key": "value",
 "value": "REPLACE"
 }
 ],
 "fingerprint": "1720312556118",
 "parentFolderId": "170",
 "formatValue": {}
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "variableId": "204",
 "name": "transaction id",
 "type": "v",
 "parameter": [
 {
 "type": "INTEGER",
 "key": "dataLayerVersion",
 "value": "2"
 },
 {
 "type": "BOOLEAN",
 "key": "setDefaultValue",
 "value": "false"
 },
 {
 "type": "TEMPLATE",
 "key": "name",
 "value": "transaction_id"
 }
 ],
 "fingerprint": "1720312556119",
 "parentFolderId": "170",
 "formatValue": {}
 }
 ],
 "folder": [
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "folderId": "170",
 "name": "DACT",
 "fingerprint": "1720312556104"
 }
 ],
 "builtInVariable": [
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "PAGE_URL",
 "name": "Page URL"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "PAGE_HOSTNAME",
 "name": "Page Hostname"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "PAGE_PATH",
 "name": "Page Path"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "REFERRER",
 "name": "Referrer"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "EVENT",
 "name": "Event"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "CLICK_ELEMENT",
 "name": "Click Element"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "CLICK_CLASSES",
 "name": "Click Classes"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "CLICK_ID",
 "name": "Click ID"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "CLICK_TARGET",
 "name": "Click Target"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "CLICK_URL",
 "name": "Click URL"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "CLICK_TEXT",
 "name": "Click Text"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "FORM_ELEMENT",
 "name": "Form Element"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "FORM_CLASSES",
 "name": "Form Classes"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "FORM_ID",
 "name": "Form ID"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "FORM_TARGET",
 "name": "Form Target"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "FORM_URL",
 "name": "Form URL"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "FORM_TEXT",
 "name": "Form Text"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "ERROR_MESSAGE",
 "name": "Error Message"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "ERROR_URL",
 "name": "Error URL"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "ERROR_LINE",
 "name": "Error Line"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "NEW_HISTORY_FRAGMENT",
 "name": "New History Fragment"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "OLD_HISTORY_FRAGMENT",
 "name": "Old History Fragment"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "NEW_HISTORY_STATE",
 "name": "New History State"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "OLD_HISTORY_STATE",
 "name": "Old History State"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "HISTORY_SOURCE",
 "name": "History Source"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "CONTAINER_VERSION",
 "name": "Container Version"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "DEBUG_MODE",
 "name": "Debug Mode"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "RANDOM_NUMBER",
 "name": "Random Number"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "CONTAINER_ID",
 "name": "Container ID"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "HTML_ID",
 "name": "HTML ID"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "ENVIRONMENT_NAME",
 "name": "Environment Name"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "VIDEO_PROVIDER",
 "name": "Video Provider"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "VIDEO_URL",
 "name": "Video URL"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "VIDEO_TITLE",
 "name": "Video Title"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "VIDEO_DURATION",
 "name": "Video Duration"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "VIDEO_PERCENT",
 "name": "Video Percent"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "VIDEO_VISIBLE",
 "name": "Video Visible"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "VIDEO_STATUS",
 "name": "Video Status"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "VIDEO_CURRENT_TIME",
 "name": "Video Current Time"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "SCROLL_DEPTH_THRESHOLD",
 "name": "Scroll Depth Threshold"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "SCROLL_DEPTH_UNITS",
 "name": "Scroll Depth Units"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "SCROLL_DEPTH_DIRECTION",
 "name": "Scroll Direction"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "ELEMENT_VISIBILITY_RATIO",
 "name": "Percent Visible"
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "type": "ELEMENT_VISIBILITY_TIME",
 "name": "On-Screen Duration"
 }
 ],
 "fingerprint": "1720317013825",
 "tagManagerUrl": "https://tagmanager.google.com/#/versions/accounts/6061284649/containers/96000106/versions/0?apiLink=version",
 "customTemplate": [
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "templateId": "199",
 "name": "Twitter Event Pixel",
 "fingerprint": "1720312556116",
 "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n \"type\": \"TAG\",\n \"id\": \"cvt_temp_public_id\",\n \"version\": 1,\n \"securityGroups\": [],\n \"displayName\": \"Twitter Event Pixel\",\n \"categories\": [\n \"ADVERTISING\",\n \"ANALYTICS\",\n \"ATTRIBUTION\",\n \"CONVERSIONS\",\n \"MARKETING\"\n ],\n \"brand\": {\n \"id\": \"github.com_twitter\",\n \"displayName\": \"twitter\",\n \"thumbnail\": \"data:image/png;base64,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\"\n },\n \"description\": \"A Twitter Website Event Code is used to track conversion events and related parameters using code. Prior to installing, ensure that the Twitter Base Code is installed an all pages of the website.\",\n \"containerContexts\": [\n \"WEB\"\n ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n {\n \"type\": \"GROUP\",\n \"name\": \"eventIdGroup\",\n \"displayName\": \"Event ID\",\n \"groupStyle\": \"NO_ZIPPY\",\n \"subParams\": [\n {\n \"type\": \"TEXT\",\n \"name\": \"event_id\",\n \"displayName\": \"\",\n \"simpleValueType\": true,\n \"valueValidators\": [\n {\n \"type\": \"REGEX\",\n \"args\": [\n \"(tw|TW)-[a-zA-Z0-9]{5}-[a-zA-Z0-9]{5}\"\n ]\n }\n ],\n \"notSetText\": \"Event ID is not set yet.\",\n \"alwaysInSummary\": true\n }\n ],\n \"help\": \"(Required) Event ID is a unique identifier of each Twitter Pixel - Event Code snippet.\"\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"eventParams\",\n \"displayName\": \"Event Parameters\",\n \"groupStyle\": \"ZIPPY_OPEN\",\n \"subParams\": [\n {\n \"type\": \"TEXT\",\n \"name\": \"value\",\n \"displayName\": \"Value\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) The total value is associated with the conversion event. Such as the dollar amount of the purchase, or the lifetime value (LTV) of a lead, etc.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"currency\",\n \"displayName\": \"Currency\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) ISO 4217 code. Example: USD, JPY, EUR\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"conversion_id\",\n \"displayName\": \"Conversion ID\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) A unique identifier of a purchase or an order. Example: t137597221\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"description\",\n \"displayName\": \"Description\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) A piece of text description for the event.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"search_string\",\n \"displayName\": \"Search String\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) Keywords of a search event in text format. Example: \\\"best coffee shop\\\".\"\n },\n {\n \"type\": \"PARAM_TABLE\",\n \"name\": \"contents\",\n \"displayName\": \"Contents\",\n \"paramTableColumns\": [\n {\n \"param\": {\n \"type\": \"SELECT\",\n \"name\": \"key\",\n \"displayName\": \"Name\",\n \"macrosInSelect\": false,\n \"selectItems\": [\n {\n \"value\": \"content_type\",\n \"displayValue\": \"Content Type\"\n },\n {\n \"value\": \"content_id\",\n \"displayValue\": \"Content ID\"\n },\n {\n \"value\": \"content_name\",\n \"displayValue\": \"Content Name\"\n },\n {\n \"value\": \"content_price\",\n \"displayValue\": \"Content Price\"\n },\n {\n \"value\": \"num_items\",\n \"displayValue\": \"Number Of Items\"\n },\n {\n \"value\": \"content_group_id\",\n \"displayValue\": \"Content Group ID\"\n }\n ],\n \"simpleValueType\": true,\n \"help\": \"(Optional) If you have more than one content to track, you can define the same content parameter multiple times. Example: content_type\\u003dCoffee and content_type\\u003dTea.\"\n },\n \"isUnique\": false\n },\n {\n \"param\": {\n \"type\": \"TEXT\",\n \"name\": \"value\",\n \"displayName\": \"Value\",\n \"simpleValueType\": true\n },\n \"isUnique\": false\n }\n ],\n \"help\": \"(Optional) The products or contents are relevant to the conversion event. If you have more than one content to track, you can define the same content parameter multiple times. Example: content_type\\u003dCoffee and content_type\\u003dTea.\"\n }\n ],\n \"help\": \"(Optional) Event parameters are optional metadata that can be passed along with each conversion event.\"\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"userParams\",\n \"displayName\": \"User Parameters\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"subParams\": [\n {\n \"type\": \"TEXT\",\n \"name\": \"twclid\",\n \"displayName\": \"Twitter Click ID\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) The Twitter Click Id passed in as the click-through URL parameter twclid, or stored as as the _twclid browser cookie in your domain.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"email_address\",\n \"displayName\": \"Email Address\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) Users\\u0027 email address. You can pass it in plaintext, and Twitter Pixel will hash the value with SHA-256 algorithm before sending it to Twitter.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"phone_number\",\n \"displayName\": \"Phone Number\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) User\\u0027s phone number. Pass in as plaintext in the format: country code plus continuous number, such as +11234567890. The Twitter Pixel will hash the value with SHA-256 algorithm before sending it to Twitter.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"external_id\",\n \"displayName\": \"External Id\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) A unique id from the advertiser, such as user id or external cookie id.\"\n }\n ]\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"configs\",\n \"displayName\": \"Configurations\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"subParams\": [\n {\n \"type\": \"SELECT\",\n \"name\": \"page_location_op\",\n \"displayName\": \"Page Location\",\n \"macrosInSelect\": false,\n \"selectItems\": [\n {\n \"value\": 1,\n \"displayValue\": \"Hide\"\n },\n {\n \"value\": 2,\n \"displayValue\": \"Overwrite\"\n }\n ],\n \"simpleValueType\": true,\n \"help\": \"(Optional) If you don\\u0027t want to share the webpage URL with Twitter, you can hide or overwrite the page location.\",\n \"notSetText\": \"Default URL\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"page_location\",\n \"displayName\": \"Overwrite Page Location With\",\n \"simpleValueType\": true,\n \"enablingConditions\": [\n {\n \"paramName\": \"page_location_op\",\n \"paramValue\": 2,\n \"type\": \"EQUALS\"\n }\n ],\n \"help\": \"(Optional) Provided a URL here to overwrite the webpage URL in the conversion event.\",\n \"defaultValue\": \"\",\n \"canBeEmptyString\": false\n }\n ]\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"additionalParamsGroup\",\n \"displayName\": \"Additional Parameters\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"subParams\": [\n {\n \"type\": \"SIMPLE_TABLE\",\n \"name\": \"additionalParams\",\n \"displayName\": \"\",\n \"simpleTableColumns\": [\n {\n \"defaultValue\": \"\",\n \"displayName\": \"Name\",\n \"name\": \"name\",\n \"type\": \"TEXT\"\n },\n {\n \"defaultValue\": \"\",\n \"displayName\": \"Value\",\n \"name\": \"value\",\n \"type\": \"TEXT\"\n }\n ]\n }\n ]\n }\n]\n\n\n___SANDBOXED_JS_FOR_WEB_TEMPLATE___\n\n/******************************************************\n * Imports\n ******************************************************/\n\nconst callInWindow = require('callInWindow');\nconst copyFromWindow = require('copyFromWindow');\nconst injectScript = require('injectScript');\nconst JSON = require('JSON');\nconst log = require('logToConsole');\nconst Object = require('Object');\nconst makeTableMap = require('makeTableMap');\nconst setInWindow = require('setInWindow');\n\n/******************************************************\n * Main\n ******************************************************/\nlog(\"data: \" + JSON.stringify(data));\n\n/**\n * Create a stub API object which queues all calls. When uwt.js loads later\n * it will process this queue and replace the stub with the actual API.\n *\n * \"createArgumentsQueue\" is not the prefect substitute of our code because:\n * - our uwt.js only overwrites twq.exe but not twq itself\n * - change the existing pattern is impossible.\n */\nconst twq = function () {\n if (copyFromWindow('twq.exe')) {\n callInWindow('twq.exe.apply', null, arguments);\n } else {\n callInWindow('twq.queue.push', arguments);\n }\n};\n\ntwq.integration = 'gtm';\ntwq.queue = [];\n// Function signiture: setInWindow(key, value, overrideExisting)\nsetInWindow('twq', twq, false);\n\nconst params = {};\ncopyParams(data, params, [\n 'value',\n 'currency',\n 'conversion_id',\n 'description',\n 'search_string',\n 'twclid',\n 'email_address',\n 'phone_number',\n 'external_id',\n]);\ncopyContentParams(data, params);\nsetPageLocation(data, params);\ncopyAdditionalParams(data, params);\n\ncallInWindow('twq', 'event', data.event_id, params);\n\n// Inject a script tag to load uwt.js.\nconst url = \"https://static.ads-twitter.com/uwt.js\";\ninjectScript(url, data.gtmOnSuccess, data.gtmOnFailure, url);\n\nreturn twq;\n/******************************************************\n * Helper Methods\n ******************************************************/\n\n/**\n * Copy a selective list of data properties into params\n */\nfunction copyParams (data, params, keys) {\n keys.forEach(function(key) {\n if (data[key]) {\n params[key] = data[key];\n }\n });\n}\n\n/**\n * We allow user to provide multiple content value with the same key.\n * E.g. content_type=coffee,content_type=tea.\n * This will become\n * {\n *. ...\n * \"contents\": [\n *. { \"key\":\"content_type\", \"value\":\"Coffee\" },\n * { \"key\":\"content_value\", \"value\":1 },\n * { \"key\":\"num_items\", \"value\":3 },\n * ...\n * { \"key\":\"content_type\", \"value\":\"Tea\" },\n * ]\n *. ...\n * }\n * in data object.\n *\n * But twq(\"event\") cmd expects\n * {\n *. ...\n * \"contents\": [\n *. {\n * \"content_type\": \"Coffee\",\n * \"content_value\": 1,\n * \"num_items\": 3,\n * },\n * {\n * \"content_type\": \"Tea\",\n * ...\n *. },\n * ]\n *. ...\n * }\n * This function put each content into the right content object.\n * The grouping logic is that if a key is appeared in the last content object,\n * we create a new object and put all the non-duplicate keys into the new object,\n * until a duplicate key apprear. In other words, we use the duplicate key as the\n * delimiters.\n */\nfunction copyContentParams (data, params) { \n if (!data.contents) {\n return;\n }\n const regroupedContents = [{}];\n data.contents.forEach(function (content) {\n const lastObj = regroupedContents[regroupedContents.length - 1];\n if (lastObj.hasOwnProperty(content.key)) {\n const newObj = {};\n newObj[content.key] = content.value;\n regroupedContents.push(newObj);\n } else {\n lastObj[content.key] = content.value;\n }\n });\n params.contents = regroupedContents;\n}\n\n/**\n * Populate hide_page_location or page_location based on the value of\n * data.page_location_op and data.page_location\n *\n * The value ofdata.page_location_op could be:\n * 0: Do nothing.\n * 1: Hide Page Location. So we set hide_page_location to true.\n * 2: Overwrite Page Location. So we set page_location to the given value.\n */\nfunction setPageLocation (data, params) {\n switch (data.page_location_op) {\n case 1:\n params.hide_page_location = true;\n break;\n case 2:\n params.page_location = data.page_location;\n break;\n default:\n }\n}\n\n/**\n * Copy data.additionalParams into params\n */\nfunction copyAdditionalParams (data, params) {\n if (!data.additionalParams) {\n return;\n }\n \n const additionalParams = makeTableMap(data.additionalParams, 'name', 'value');\n Object.keys(additionalParams).forEach(function(key) {\n params[key] = additionalParams[key];\n }); \n}\n\n\n___WEB_PERMISSIONS___\n\n[\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"access_globals\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"keys\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.integration\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.queue\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.queue.push\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.exe\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.exe.apply\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"inject_script\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"urls\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 1,\n \"string\": \"https://static.ads-twitter.com/uwt.js\"\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"logging\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"environments\",\n \"value\": {\n \"type\": 1,\n \"string\": \"debug\"\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n }\n]\n\n\n___TESTS___\n\nscenarios: []\n\n\n___NOTES___\n\nCreated on 7/8/2022, 9:48:08 PM\n\n\n",
 "galleryReference": {
 "host": "github.com",
 "owner": "twitter",
 "repository": "google-tag-manager-event-tag",
 "version": "58549bbd3257b84ea9bb1037bd938c45da05d6e9",
 "signature": "317b6cb28fdaa4fdb80328fa375c12fbbbabe43519b2cad9362933a39f20e854"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "templateId": "200",
 "name": "Twitter Base Pixel",
 "fingerprint": "1720312556117",
 "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n \"type\": \"TAG\",\n \"id\": \"cvt_temp_public_id\",\n \"version\": 1,\n \"securityGroups\": [],\n \"displayName\": \"Twitter Base Pixel\",\n \"categories\": [\n \"ADVERTISING\",\n \"ANALYTICS\",\n \"ATTRIBUTION\",\n \"CONVERSIONS\",\n \"MARKETING\"\n ],\n \"brand\": {\n \"id\": \"github.com_twitter\",\n \"displayName\": \"twitter\",\n \"thumbnail\": \"data:image/png;base64,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\"\n },\n \"description\": \"A Twitter Website Base Code is required for tracking any conversion event. This tag must be triggered on all page views.\",\n \"containerContexts\": [\n \"WEB\"\n ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n {\n \"type\": \"GROUP\",\n \"name\": \"pixelIdGroup\",\n \"displayName\": \"Pixel ID\",\n \"groupStyle\": \"NO_ZIPPY\",\n \"subParams\": [\n {\n \"type\": \"TEXT\",\n \"name\": \"pixel_id\",\n \"displayName\": \"\",\n \"simpleValueType\": true,\n \"valueValidators\": [\n {\n \"type\": \"REGEX\",\n \"args\": [\n \"[a-zA-Z0-9]{5}\"\n ]\n }\n ],\n \"alwaysInSummary\": true,\n \"notSetText\": \"Pixel ID is not set yet.\"\n }\n ],\n \"help\": \"(Required) Pixel ID is a unique identifier of each Twitter Pixel - Base Code snippet.\"\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"userParams\",\n \"displayName\": \"User Parameters\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"subParams\": [\n {\n \"type\": \"TEXT\",\n \"name\": \"email_address\",\n \"displayName\": \"Email Address\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) User\\u0027s email address. You can pass it in plaintext, and Twitter Pixel will hash the value with SHA-256 algorithm before sending it to Twitter.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"phone_number\",\n \"displayName\": \"Phone Number\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) User\\u0027s phone number. Pass in as plaintext in the format: country code plus continuous number, such as +11234567890. The Twitter Pixel will hash the value with SHA-256 algorithm before sending it to Twitter.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"external_id\",\n \"displayName\": \"External Id\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) A unique id from the advertiser, such as user id or external cookie id.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"twclid\",\n \"displayName\": \"Twitter Click Id\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) The Twitter Click Id passed in as the click-through URL parameter twclid, or stored as as the _twclid browser cookie in your domain.\"\n }\n ]\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"configs\",\n \"displayName\": \"Configurations\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"subParams\": [\n {\n \"type\": \"SELECT\",\n \"name\": \"page_location_op\",\n \"displayName\": \"Page Location\",\n \"macrosInSelect\": false,\n \"selectItems\": [\n {\n \"value\": 1,\n \"displayValue\": \"Hide\"\n },\n {\n \"value\": 2,\n \"displayValue\": \"Overwrite\"\n }\n ],\n \"simpleValueType\": true,\n \"notSetText\": \"Default URL\",\n \"help\": \"(Optional) You can hide or overwrite the page location if you don\\u0027t want to share it with Twitter.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"page_location\",\n \"displayName\": \"Overwrite Page Location With\",\n \"simpleValueType\": true,\n \"help\": \"(Optional) Provided a URL here to overwrite the webpage URL.\",\n \"enablingConditions\": [\n {\n \"paramName\": \"page_location_op\",\n \"paramValue\": 2,\n \"type\": \"EQUALS\"\n }\n ],\n \"canBeEmptyString\": false,\n \"defaultValue\": \"\"\n }\n ]\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"additionalParamsGroup\",\n \"displayName\": \"Additional Parameters\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"subParams\": [\n {\n \"type\": \"SIMPLE_TABLE\",\n \"name\": \"additionalParams\",\n \"displayName\": \"\",\n \"simpleTableColumns\": [\n {\n \"defaultValue\": \"\",\n \"displayName\": \"Name\",\n \"name\": \"name\",\n \"type\": \"TEXT\"\n },\n {\n \"defaultValue\": \"\",\n \"displayName\": \"Value\",\n \"name\": \"value\",\n \"type\": \"TEXT\"\n }\n ]\n }\n ]\n }\n]\n\n\n___SANDBOXED_JS_FOR_WEB_TEMPLATE___\n\n/******************************************************\n * Imports\n ******************************************************/\n\nconst callInWindow = require('callInWindow');\nconst copyFromWindow = require('copyFromWindow');\nconst injectScript = require('injectScript');\nconst JSON = require('JSON');\nconst log = require('logToConsole');\nconst Object = require('Object');\nconst makeTableMap = require('makeTableMap');\nconst setInWindow = require('setInWindow');\n\n/******************************************************\n * Main\n ******************************************************/\nlog(\"data: \" + JSON.stringify(data));\n\n/**\n * Create a stub API object which queues all calls. When uwt.js loads later\n * it will process this queue and replace the stub with the actual API.\n *\n * \"createArgumentsQueue\" is not the prefect substitute of our code because:\n * - our uwt.js only overwrites twq.exe but not twq itself\n * - change the existing pattern is impossible.\n */\n\nconst twq = function () {\n if (copyFromWindow('twq.exe')) {\n callInWindow('twq.exe.apply', null, arguments);\n } else {\n callInWindow('twq.queue.push', arguments);\n }\n};\n\ntwq.integration = 'gtm';\ntwq.queue = [];\n// Function signiture: setInWindow(key, value, overrideExisting)\nsetInWindow('twq', twq, false);\n\nconst params = {};\ncopyParams(data, params, [\n \"email_address\",\n \"phone_number\",\n \"external_id\",\n \"twclid\",\n]);\n\nsetPageLocation(data, params);\ncopyAdditionalParams(data, params);\ncallInWindow('twq', 'config', data.pixel_id, params);\n\n// Inject a script tag to load uwt.js.\nconst url = \"https://static.ads-twitter.com/uwt.js\";\ninjectScript(url, data.gtmOnSuccess, data.gtmOnFailure, url);\n\nreturn twq;\n/******************************************************\n * Helper Methods\n ******************************************************/\n\n/**\n * Copy a selective list of data properties into params\n */\nfunction copyParams (data, params, keys) {\n keys.forEach(function(key) {\n if (data[key]) {\n params[key] = data[key];\n }\n });\n}\n\n/**\n * Populate hide_page_location or page_location based on the value of\n * data.page_location_op and data.page_location\n *\n * The value ofdata.page_location_op could be:\n * 0: Do nothing.\n * 1: Hide Page Location. So we set hide_page_location to true.\n * 2: Overwrite Page Location. So we set page_location to the given value.\n */\nfunction setPageLocation (data, params) {\n switch (data.page_location_op) {\n case 1:\n params.hide_page_location = true;\n break;\n case 2:\n params.page_location = data.page_location;\n break;\n default:\n }\n}\n\n/**\n * Copy data.additionalParams into params\n */\nfunction copyAdditionalParams (data, params) {\n if (!data.additionalParams) {\n return;\n }\n \n const additionalParams = makeTableMap(data.additionalParams, 'name', 'value');\n Object.keys(additionalParams).forEach(function(key) {\n params[key] = additionalParams[key];\n }); \n}\n\n\n___WEB_PERMISSIONS___\n\n[\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"access_globals\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"keys\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.queue\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.integration\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.exe\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.queue.push\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"twq.exe.apply\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"inject_script\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"urls\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 1,\n \"string\": \"https://static.ads-twitter.com/uwt.js\"\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"logging\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"environments\",\n \"value\": {\n \"type\": 1,\n \"string\": \"debug\"\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n }\n]\n\n\n___TESTS___\n\nscenarios: []\nsetup: |-\n const mockData = {\n pixelId: 'abcde'\n };\n\n\n___NOTES___\n\nCreated on 7/8/2022, 9:47:55 PM\n\n\n",
 "galleryReference": {
 "host": "github.com",
 "owner": "twitter",
 "repository": "google-tag-manager-base-tag",
 "version": "6685cbdbefbaa512be22c4e55b0a3dfd4703ac9b",
 "signature": "b21f99380b3fcf9cafaa871d2fd054ca406de8e0443b2dd1422c09ff5537511d"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "templateId": "210",
 "name": "Snap Pixel",
 "fingerprint": "1720312556121",
 "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n \"categories\": [\n \"ADVERTISING\",\n \"ANALYTICS\",\n \"ATTRIBUTION\",\n \"CONVERSIONS\",\n \"MARKETING\"\n ],\n \"displayName\": \"Snap Pixel\",\n \"description\": \"The Snap Pixel helps advertisers measure the cross-device impact of campaigns. Advertisers will be able to see how many Snapchatters take action on their website(s).\",\n \"securityGroups\": [\n \"NON_GOOGLE_SCRIPTS\"\n ],\n \"id\": \"snppx\",\n \"type\": \"TAG\",\n \"version\": 1,\n \"brand\": {\n \"thumbnail\": \"data:image/png;base64,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\\u003d\\u003d\",\n \"displayName\": \"Snapchat\",\n \"id\": \"github.com_Snapchat\"\n },\n \"containerContexts\": [\n \"WEB\"\n ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n {\n \"hiddenParamValue\": {\n \"type\": \"URL\"\n },\n \"name\": \"page_url\",\n \"type\": \"HIDDEN\"\n },\n {\n \"valueValidators\": [\n {\n \"type\": \"NON_EMPTY\"\n },\n {\n \"args\": [\n \"[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}\"\n ],\n \"type\": \"REGEX\"\n }\n ],\n \"displayName\": \"Pixel ID\",\n \"name\": \"pixel_id\",\n \"type\": \"TEXT\"\n },\n {\n \"macrosInSelect\": true,\n \"selectItems\": [\n {\n \"displayValue\": \"Page View\",\n \"value\": \"PAGE_VIEW\"\n },\n {\n \"displayValue\": \"Add Cart\",\n \"value\": \"ADD_CART\"\n },\n {\n \"displayValue\": \"Save\",\n \"value\": \"SAVE\"\n },\n {\n \"displayValue\": \"Purchase\",\n \"value\": \"PURCHASE\"\n },\n {\n \"displayValue\": \"Level Complete\",\n \"value\": \"LEVEL_COMPLETE\"\n },\n {\n \"displayValue\": \"Start Checkout\",\n \"value\": \"START_CHECKOUT\"\n },\n {\n \"displayValue\": \"Sign Up\",\n \"value\": \"SIGN_UP\"\n },\n {\n \"displayValue\": \"App Install\",\n \"value\": \"APP_INSTALL\"\n },\n {\n \"displayValue\": \"App Open\",\n \"value\": \"APP_OPEN\"\n },\n {\n \"displayValue\": \"Add Billing\",\n \"value\": \"ADD_BILLING\"\n },\n {\n \"displayValue\": \"Search\",\n \"value\": \"SEARCH\"\n },\n {\n \"value\": \"VIEW_CONTENT\",\n \"displayValue\": \"View Content\"\n },\n {\n \"value\": \"SUBSCRIBE\",\n \"displayValue\": \"Subscribe\"\n },\n {\n \"value\": \"AD_CLICK\",\n \"displayValue\": \"Ad Click\"\n },\n {\n \"value\": \"AD_VIEW\",\n \"displayValue\": \"Ad View\"\n },\n {\n \"value\": \"COMPLETE_TUTORIAL\",\n \"displayValue\": \"Complete Tutorial\"\n },\n {\n \"value\": \"INVITE\",\n \"displayValue\": \"Invite\"\n },\n {\n \"value\": \"LOGIN\",\n \"displayValue\": \"Login\"\n },\n {\n \"value\": \"SHARE\",\n \"displayValue\": \"Share\"\n },\n {\n \"value\": \"RESERVE\",\n \"displayValue\": \"Reserve\"\n },\n {\n \"value\": \"ACHIEVEMENT_UNLOCKED\",\n \"displayValue\": \"Achievement Unlocked\"\n },\n {\n \"value\": \"ADD_TO_WISHLIST\",\n \"displayValue\": \"Add To Wishlist\"\n },\n {\n \"value\": \"SPENT_CREDITS\",\n \"displayValue\": \"Spent Credits\"\n },\n {\n \"value\": \"RATE\",\n \"displayValue\": \"Rate\"\n },\n {\n \"value\": \"START_TRIAL\",\n \"displayValue\": \"Start Trial\"\n },\n {\n \"value\": \"LIST_VIEW\",\n \"displayValue\": \"List View\"\n },\n {\n \"value\": \"CUSTOM_EVENT_1\",\n \"displayValue\": \"Custom Event 1\"\n },\n {\n \"value\": \"CUSTOM_EVENT_2\",\n \"displayValue\": \"Custom Event 2\"\n },\n {\n \"value\": \"CUSTOM_EVENT_3\",\n \"displayValue\": \"Custom Event 3\"\n },\n {\n \"value\": \"CUSTOM_EVENT_4\",\n \"displayValue\": \"Custom Event 4\"\n },\n {\n \"value\": \"CUSTOM_EVENT_5\",\n \"displayValue\": \"Custom Event 5\"\n }\n ],\n \"displayName\": \"Event Type\",\n \"name\": \"event_type\",\n \"type\": \"SELECT\"\n },\n {\n \"displayName\": \"User Email\",\n \"name\": \"user_email\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"User Hashed Email (SHA-256)\",\n \"name\": \"user_hashed_email\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"User Phone Number\",\n \"name\": \"user_phone_number\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"User Hashed Phone Number (SHA-256)\",\n \"name\": \"user_hashed_phone_number\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"User Mobile Ad ID\",\n \"name\": \"user_mobile_ad_id\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"User Hashed Mobile Ad ID (SHA-256)\",\n \"name\": \"user_hashed_mobile_ad_id\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Price\",\n \"name\": \"price\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Item Category\",\n \"name\": \"item_category\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Item IDs\",\n \"name\": \"item_ids\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Currency\",\n \"name\": \"currency\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Number of Items\",\n \"name\": \"number_items\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Transaction ID\",\n \"name\": \"transaction_id\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Description\",\n \"name\": \"description\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Level\",\n \"name\": \"level\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Search String\",\n \"name\": \"search_string\",\n \"type\": \"TEXT\"\n },\n {\n \"displayName\": \"Sign Up Method\",\n \"name\": \"sign_up_method\",\n \"type\": \"TEXT\"\n },\n {\n \"notSetText\": \"Not Applicable\",\n \"macrosInSelect\": true,\n \"selectItems\": [\n {\n \"displayValue\": \"true\",\n \"value\": 1\n },\n {\n \"displayValue\": \"false\",\n \"value\": 0\n }\n ],\n \"displayName\": \"Success\",\n \"simpleValueType\": true,\n \"name\": \"success\",\n \"type\": \"SELECT\",\n \"help\": \"A variable, if provided, should evaluate to \\\"1\\\" for true and \\\"0\\\" for false\"\n },\n {\n \"notSetText\": \"Not Applicable\",\n \"macrosInSelect\": true,\n \"selectItems\": [\n {\n \"displayValue\": \"true\",\n \"value\": 1\n },\n {\n \"displayValue\": \"false\",\n \"value\": 0\n }\n ],\n \"displayName\": \"Payment Info Available\",\n \"simpleValueType\": true,\n \"name\": \"payment_info_available\",\n \"type\": \"SELECT\",\n \"help\": \"A variable, if provided, should evaluate to \\\"1\\\" for true and \\\"0\\\" for false\"\n },\n {\n \"type\": \"PARAM_TABLE\",\n \"name\": \"additional_init_data\",\n \"displayName\": \"Additional Initialization Data\",\n \"paramTableColumns\": [\n {\n \"param\": {\n \"type\": \"TEXT\",\n \"name\": \"key\",\n \"displayName\": \"Key\",\n \"simpleValueType\": true\n },\n \"isUnique\": true\n },\n {\n \"param\": {\n \"type\": \"TEXT\",\n \"name\": \"value\",\n \"displayName\": \"Value\",\n \"simpleValueType\": true,\n \"defaultValue\": \"\"\n },\n \"isUnique\": false\n }\n ],\n \"help\": \"Enter in custom initialization data\"\n }\n]\n\n\n___SANDBOXED_JS_FOR_WEB_TEMPLATE___\n\nvar log = require('logToConsole');\nvar callInWindow = require('callInWindow');\nvar callLater = require('callLater');\nvar copyFromWindow = require('copyFromWindow');\nvar createQueue = require('createQueue');\nvar injectScript = require('injectScript');\nvar makeTableMap = require('makeTableMap');\nvar sendPixel = require('sendPixel');\nvar setInWindow = require('setInWindow');\n\nfunction mergeObjects() {\n var res = {};\n for(var i = 0; i < arguments.length; ++i) {\n for(var x in arguments[i]) {\n res[x] = arguments[i][x];\n }\n }\n return res;\n}\n\nfunction bootstrapFn() {\n var snaptr = copyFromWindow('snaptr');\n if (snaptr) {\n return snaptr;\n }\n \n setInWindow('snaptr', function() {\n var handler = copyFromWindow('snaptr.handleRequest');\n if (handler) {\n callInWindow('snaptr.handleRequest.apply', null, arguments);\n } else {\n callInWindow('snaptr.queue.push', arguments);\n }\n });\n return copyFromWindow('snaptr');\n}\n\nfunction bootstrap() {\n var snaptr = bootstrapFn();\n createQueue('snaptr.queue');\n setInWindow('snaptr.sendPixelByGTM', sendPixel, true);\n\n data.integration = \"gtm\";\n log(\"data = \", data);\n var additionalInitData = (data.additional_init_data) ? makeTableMap(data.additional_init_data, 'key', 'value') : {};\n var initData = mergeObjects(data, additionalInitData);\n\n log(\"initData = \", initData);\n snaptr('init', initData.pixel_id, initData);\n snaptr('track', initData.pixel_id, initData.event_type, data);\n\n var url = 'https://sc-static.net/scevent.min.js';\n injectScript(url, data.gtmOnSuccess, data.gtmOnFailure, url);\n}\n\nbootstrap();\n\n\n___WEB_PERMISSIONS___\n\n[\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"inject_script\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"urls\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 1,\n \"string\": \"https://sc-static.net/*\"\n },\n {\n \"type\": 1,\n \"string\": \"https://tr.snapchat.com/*\"\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"logging\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"environments\",\n \"value\": {\n \"type\": 1,\n \"string\": \"debug\"\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"access_globals\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"keys\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"snaptr\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"snaptr.handleRequest\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"snaptr.handleRequest.apply\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"snaptr.queue\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"snaptr.queue.push\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"snaptr.sendPixelByGTM\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"send_pixel\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"urls\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 1,\n \"string\": \"https://tr.snapchat.com/*\"\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n }\n]\n\n\n___TESTS___\n\nscenarios: []\n\n\n___NOTES___\n\nCreated on 1/31/2019, 2:56:12 PM\n\n\n",
 "galleryReference": {
 "host": "github.com",
 "owner": "Snapchat",
 "repository": "snapchat-google-tag-manager",
 "version": "b458827632eea2068be1aa0d2c74f24c6d0a45b4",
 "signature": "c411191a852a9c377d27456ab6a607b9ea955b36d20dd0995b2ee3b7500fd098"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "templateId": "211",
 "name": "LinkedIn InsightTag 2.0",
 "fingerprint": "1720312556122",
 "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n \"type\": \"TAG\",\n \"id\": \"cvt_temp_public_id\",\n \"version\": 1,\n \"securityGroups\": [],\n \"displayName\": \"LinkedIn InsightTag 2.0\",\n \"brand\": {\n \"id\": \"github.com_linkedin\",\n \"displayName\": \"linkedin\",\n \"thumbnail\": \"data:image/png;base64,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\\u003d\\u003d\"\n },\n \"description\": \"LinkedIn’s official updated tag template allows for both page-level and event-level tracking via easily configurable options.\",\n \"containerContexts\": [\n \"WEB\"\n ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n {\n \"type\": \"TEXT\",\n \"name\": \"partnerId\",\n \"displayName\": \"Partner ID / Insight Tag ID\",\n \"simpleValueType\": true,\n \"notSetText\": \"Enter one or more Partner IDs separated by comma\",\n \"valueValidators\": [\n {\n \"type\": \"REGEX\",\n \"args\": [\n \"^\\\\d+(,\\\\s?\\\\d+)*$\"\n ]\n }\n ]\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"conversionId\",\n \"displayName\": \"Conversion IDs (max. 3)\",\n \"simpleValueType\": true,\n \"help\": \"Enter 1-3 conversion ids separated by comma. Only first 3 conversion ids will be sent. This field is optional\",\n \"canBeEmptyString\": true,\n \"valueValidators\": [\n {\n \"type\": \"REGEX\",\n \"args\": [\n \"^\\\\s*|\\\\d+(,\\\\s?\\\\d+)*$\"\n ]\n }\n ]\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"customUrl\",\n \"displayName\": \"Custom URL override\",\n \"simpleValueType\": true,\n \"help\": \"(Override) This is different than Match rules. Enter a URL only if you were specifically provided one by LinkedIn team to override.\",\n \"canBeEmptyString\": true\n }\n]\n\n\n___SANDBOXED_JS_FOR_WEB_TEMPLATE___\n\nconst getUrl = require('getUrl');\nconst log = require('logToConsole');\nconst sendPixel = require('sendPixel');\nconst assertThat = require('assertThat');\nconst setInWindow = require('setInWindow');\nconst getTimestamp = require('getTimestamp');\nconst injectScript = require('injectScript');\nconst copyFromWindow = require('copyFromWindow');\nconst encodeUriComponent = require('encodeUriComponent');\n\n/**\n * Globals\n */\nconst conversionIds = data.conversionId ?\n data.conversionId.split(',').slice(0,3).map(id => id.trim())\n : '';\nconst allPids = [];\nconst pageUrl = data.customUrl ? data.customUrl : getUrl();\n\n/**\n * Checks presence of LinkedIn Insight tag code.\n */\nconst isInsightTagAPIAvailable = () => typeof copyFromWindow('lintrk') === 'function';\n\n/**\n * Reads and Sets in global namespace all applicable PIDs on the page\n */\nconst setAllPids = (function() {\n const partnerIds = {};\n const bizoId = copyFromWindow('_bizo_data_partner_id');\n const bizoIds = copyFromWindow('_bizo_data_partner_ids') || [];\n const linkedInPartnerId = copyFromWindow('_linkedin_data_partner_id');\n const linkedInPartnerIds = copyFromWindow('_linkedin_data_partner_ids') || [];\n\n const addPid = pid => {\n if (pid && !partnerIds[pid]) {\n partnerIds[pid] = true;\n allPids.push(pid);\n }\n };\n\n // add the partner ids set via this GTM installation\n const inputPids = data.partnerId.split(',');\n inputPids.forEach(id => addPid(id.trim()));\n\n // Add all PIDs that may have updated the global, helps skipping following adds.\n addPid(linkedInPartnerId);\n linkedInPartnerIds.forEach(id => addPid(id));\n\n // add other PIDs from page\n addPid(bizoId);\n bizoIds.forEach(id => addPid(id));\n\n // Update the main namespace for future tracking by InsightTag to include the partner IDs\n setInWindow('_linkedin_data_partner_ids', allPids, true);\n}());\n\n/**\n * Generate query params only for GTM based tracking\n */\nfunction generateQueryParamsForGTM(cid) {\n const encodedPIDs = encodeUriComponent(allPids.join(','));\n\n let result = 'pid=' + encodedPIDs;\n result += '&tm=gtmv2';\n result += cid ? '&conversionId=' + encodeUriComponent(cid) : '';\n result += '&url=' + encodeUriComponent(pageUrl);\n result += '&v=2&fmt=js&time=' + getTimestamp();\n return result;\n}\n\n// Success call back to InsightTag injection\nfunction didInjectInsightTag() {\n trackByInsightTag();\n data.gtmOnSuccess();\n}\n\n// Callback to plain GTM when InsightTag code failed to inject\nfunction didFailInsightTag() {\n trackByPlainGTM();\n data.gtmOnFailure();\n}\n\nfunction trackByPlainGTM() {\n if (conversionIds.length && conversionIds.length <= 3) {\n conversionIds.forEach(id => {\n const trackingUrl = 'https://px.ads.linkedin.com/collect?' + generateQueryParamsForGTM(id);\n sendPixel(trackingUrl, data.gtmOnSuccess, data.gtmOnFailure);\n });\n } else {\n sendPixel('https://px.ads.linkedin.com/collect?' + generateQueryParamsForGTM(), data.gtmOnSuccess, data.gtmOnFailure);\n }\n}\n\n/**\n * Download LinkedIn Insight tag core code if `window.lintrk` is not available\n * Also ensure it doesn’t default fire.\n */\nfunction trackByInsightTag() {\n if (isInsightTagAPIAvailable()) {\n const lintrk = copyFromWindow('lintrk');\n const options = { tmsource: 'gtmv2' };\n options.conversion_url = pageUrl;\n\n if (conversionIds.length && conversionIds.length <= 3) {\n conversionIds.forEach(id => {\n options.conversion_id = id;\n lintrk('track', options);\n });\n } else {\n lintrk('track', options);\n }\n } else {\n setInWindow('_already_called_lintrk', true, true);\n injectScript('https://snap.licdn.com/li.lms-analytics/insight.min.js', didInjectInsightTag, didFailInsightTag);\n }\n}\n\n/**\n * Enable `trackByPlainGTM` for test purposes, and disable `trackByInsightTag`.\n * trackByPlainGTM();\n */\ntrackByInsightTag();\n\n\n___WEB_PERMISSIONS___\n\n[\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"logging\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"environments\",\n \"value\": {\n \"type\": 1,\n \"string\": \"debug\"\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"send_pixel\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"allowedUrls\",\n \"value\": {\n \"type\": 1,\n \"string\": \"specific\"\n }\n },\n {\n \"key\": \"urls\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 1,\n \"string\": \"https://*.linkedin.com/*\"\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"access_globals\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"keys\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"_bizo_data_partner_id\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"_bizo_data_partner_ids\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"_linkedin_data_partner_id\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"_linkedin_data_partner_ids\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"lintrk\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"_already_called_lintrk\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"get_url\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"urlParts\",\n \"value\": {\n \"type\": 1,\n \"string\": \"any\"\n }\n },\n {\n \"key\": \"queriesAllowed\",\n \"value\": {\n \"type\": 1,\n \"string\": \"any\"\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"inject_script\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"urls\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 1,\n \"string\": \"https://snap.licdn.com/*\"\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n }\n]\n\n\n___TESTS___\n\nscenarios:\n- name: No API - Test sendPixel with custom URL and single conversionId\n code: |-\n const mockData = {\n partnerId: '123',\n customUrl: 'google.com',\n conversionId: '12576358'\n };\n\n mock('sendPixel', (url, onSuccess, onFailure) => {\n assertThat(url).contains('https://px.ads.linkedin.com/collect?pid=123&tm=gtmv2&conversionId=12576358&url=google.com&v=2&fmt=js&time=');\n onSuccess();\n });\n\n runCode(mockData);\n assertApi('gtmOnSuccess').wasCalled();\n- name: No API - Test sendPixel with page URL and no conversionId\n code: |-\n const encodeUriComponent = require('encodeUriComponent');\n const getUrl = require('getUrl');\n const mockData = { partnerId: '123' };\n\n mock('sendPixel', (url, onSuccess, onFailure) => {\n assertThat(url).contains('https://px.ads.linkedin.com/collect?pid=123&tm=gtmv2&url=' + encodeUriComponent(getUrl()) + '&v=2&fmt=js&time=');\n onSuccess();\n });\n\n runCode(mockData);\n assertApi('gtmOnSuccess').wasCalled();\n- name: With API - test script injection\n code: |-\n const getUrl = require('getUrl');\n const mockData = { partnerId: '123' };\n const copyFromWindow = require('copyFromWindow');\n\n mock('injectScript', (url) => {\n assertThat(url, 'correct script download URL is called').isEqualTo('https://snap.licdn.com/li.lms-analytics/insight.min.js');\n });\n\n runCode(mockData);\n- name: No API - Multiple partnerIds and conversion ids\n code: \"const mockData = {\\n partnerId: '123,456, 789, 299',\\n customUrl: 'google.com',\\n\\\n \\ conversionId: '1, 2, 3, 4, 5'\\n};\\nconst callStack = [];\\nmock('sendPixel',\\\n \\ (url, onSuccess, onFailure) => {\\n callStack.push(url);\\n \\n // Call success\\\n \\ only once when stack is full\\n if (callStack.length === 3) {\\n onSuccess();\\n\\\n \\ }\\n});\\n\\nrunCode(mockData);\\n\\nassertThat(callStack.length).isEqualTo(3);\\n\\\n \\nassertThat(callStack[0]).contains('https://px.ads.linkedin.com/collect?pid=123%2C456%2C789%2C299&tm=gtmv2&conversionId=1&url=google.com&v=2&fmt=js&time=');\\n\\\n \\nassertThat(callStack[1]).contains('https://px.ads.linkedin.com/collect?pid=123%2C456%2C789%2C299&tm=gtmv2&conversionId=2&url=google.com&v=2&fmt=js&time=');\\n\\\n \\nassertThat(callStack[2]).contains('https://px.ads.linkedin.com/collect?pid=123%2C456%2C789%2C299&tm=gtmv2&conversionId=3&url=google.com&v=2&fmt=js&time=');\\n\\\n \\nassertApi('gtmOnSuccess').wasCalled();\"\n\n\n___NOTES___\n\nCreated on 11/17/2021, 11:34:21 AM\n\n\n",
 "galleryReference": {
 "host": "github.com",
 "owner": "linkedin",
 "repository": "linkedin-gtm-community-template",
 "version": "61d7d7cf207c62b05d8e3595288c4bccf8517dab",
 "signature": "0fe43a81ecc2a69b3b57dbf1a2315c8422d366aa083164628b26e3680ae7ccb1"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "templateId": "212",
 "name": "Facebook Pixel",
 "fingerprint": "1720312556123",
 "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n \"displayName\": \"Facebook Pixel\",\n \"__wm\": \"VGVtcGxhdGUtQXV0aG9yX0ZhY2Vib29rLVNpbW8tQWhhdmE\\u003d\",\n \"description\": \"This is an unofficial Google Tag Manager template for the Facebook Pixel.\",\n \"securityGroups\": [],\n \"categories\": [\n \"ADVERTISING\",\n \"ANALYTICS\"\n ],\n \"id\": \"cvt_temp_public_id\",\n \"type\": \"TAG\",\n \"version\": 1,\n \"brand\": {\n \"displayName\": \"facebookarchive\",\n \"id\": \"github.com_facebookarchive\",\n \"thumbnail\": \"data:image/png;base64,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\"\n },\n \"containerContexts\": [\n \"WEB\"\n ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n {\n \"alwaysInSummary\": true,\n \"valueValidators\": [\n {\n \"errorMessage\": \"You must provide a Pixel ID\",\n \"type\": \"NON_EMPTY\"\n },\n {\n \"args\": [\n \"^[0-9,]+$\"\n ],\n \"errorMessage\": \"Invalid Pixel ID format\",\n \"type\": \"REGEX\"\n }\n ],\n \"displayName\": \"Facebook Pixel ID(s)\",\n \"simpleValueType\": true,\n \"name\": \"pixelId\",\n \"type\": \"TEXT\",\n \"valueHint\": \"e.g. 12345678910\"\n },\n {\n \"type\": \"CHECKBOX\",\n \"name\": \"enhancedEcommerce\",\n \"checkboxText\": \"Enhanced Ecommerce dataLayer Integration\",\n \"simpleValueType\": true,\n \"help\": \"If you check this, then the Facebook pixel will populate \\u003cstrong\\u003eEvent Name\\u003c/strong\\u003e and \\u003cstrong\\u003eObject Properties\\u003c/strong\\u003e automatically from the last \\u003ca href\\u003d\\\"https://developers.google.com/tag-manager/enhanced-ecommerce\\\"\\u003eecommerce\\u003c/a\\u003e object pushed into the dataLayer array.\"\n },\n {\n \"type\": \"RADIO\",\n \"name\": \"eventName\",\n \"displayName\": \"Event Name\",\n \"radioItems\": [\n {\n \"value\": \"standard\",\n \"displayValue\": \"Standard\",\n \"subParams\": [\n {\n \"type\": \"SELECT\",\n \"name\": \"standardEventName\",\n \"macrosInSelect\": false,\n \"selectItems\": [\n {\n \"displayValue\": \"PageView\",\n \"value\": \"PageView\"\n },\n {\n \"displayValue\": \"AddPaymentInfo\",\n \"value\": \"AddPaymentInfo\"\n },\n {\n \"displayValue\": \"AddToCart\",\n \"value\": \"AddToCart\"\n },\n {\n \"displayValue\": \"AddToWishlist\",\n \"value\": \"AddToWishlist\"\n },\n {\n \"displayValue\": \"CompleteRegistration\",\n \"value\": \"CompleteRegistration\"\n },\n {\n \"displayValue\": \"Contact\",\n \"value\": \"Contact\"\n },\n {\n \"displayValue\": \"CustomizeProduct\",\n \"value\": \"CustomizeProduct\"\n },\n {\n \"displayValue\": \"Donate\",\n \"value\": \"Donate\"\n },\n {\n \"displayValue\": \"FindLocation\",\n \"value\": \"FindLocation\"\n },\n {\n \"displayValue\": \"InitiateCheckout\",\n \"value\": \"InitiateCheckout\"\n },\n {\n \"displayValue\": \"Lead\",\n \"value\": \"Lead\"\n },\n {\n \"displayValue\": \"Purchase\",\n \"value\": \"Purchase\"\n },\n {\n \"displayValue\": \"Schedule\",\n \"value\": \"Schedule\"\n },\n {\n \"displayValue\": \"Search\",\n \"value\": \"Search\"\n },\n {\n \"displayValue\": \"StartTrial\",\n \"value\": \"StartTrial\"\n },\n {\n \"displayValue\": \"SubmitApplication\",\n \"value\": \"SubmitApplication\"\n },\n {\n \"displayValue\": \"Subscribe\",\n \"value\": \"Subscribe\"\n },\n {\n \"displayValue\": \"ViewContent\",\n \"value\": \"ViewContent\"\n }\n ],\n \"simpleValueType\": true,\n \"defaultValue\": \"PageView\"\n }\n ]\n },\n {\n \"value\": \"custom\",\n \"displayValue\": \"Custom\",\n \"subParams\": [\n {\n \"type\": \"TEXT\",\n \"name\": \"customEventName\",\n \"displayName\": \"\",\n \"simpleValueType\": true\n }\n ]\n },\n {\n \"value\": \"variable\",\n \"displayValue\": \"Variable\",\n \"subParams\": [\n {\n \"type\": \"SELECT\",\n \"name\": \"variableEventName\",\n \"macrosInSelect\": true,\n \"selectItems\": [],\n \"simpleValueType\": true\n }\n ]\n }\n ],\n \"simpleValueType\": true,\n \"enablingConditions\": [\n {\n \"paramName\": \"enhancedEcommerce\",\n \"paramValue\": true,\n \"type\": \"NOT_EQUALS\"\n }\n ]\n },\n {\n \"type\": \"RADIO\",\n \"name\": \"eecEventName\",\n \"displayName\": \"Event Name\",\n \"radioItems\": [\n {\n \"value\": \"eec\",\n \"displayValue\": \"Set automatically from dataLayer\"\n }\n ],\n \"simpleValueType\": true,\n \"help\": \"The Enhanced Ecommerce integration populates the Event Name automatically depending on what type of \\u003cstrong\\u003eecommerce\\u003c/strong\\u003e object was last pushed into dataLayer (\\\"detail\\\" -\\u003e \\\"ViewContent\\\", \\\"add\\\" -\\u003e \\\"AddToCart\\\", \\\"checkout\\\" -\\u003e \\\"InitiateCheckout\\\", \\\"purchase\\\" -\\u003e \\\"Purchase\\\").\",\n \"enablingConditions\": [\n {\n \"paramName\": \"enhancedEcommerce\",\n \"paramValue\": true,\n \"type\": \"EQUALS\"\n }\n ]\n },\n {\n \"type\": \"SELECT\",\n \"name\": \"consent\",\n \"displayName\": \"Consent Granted (GDPR)\",\n \"macrosInSelect\": true,\n \"selectItems\": [\n {\n \"value\": true,\n \"displayValue\": \"True\"\n },\n {\n \"value\": false,\n \"displayValue\": \"False\"\n }\n ],\n \"simpleValueType\": true,\n \"help\": \"If you set Consent Granted to \\u003cstrong\\u003efalse\\u003c/strong\\u003e, the pixel will not send any hits until a tag is fired where Consent Granted is set to \\u003cstrong\\u003etrue\\u003c/strong\\u003e. See \\u003ca href\\u003d\\\"https://developers.facebook.com/docs/facebook-pixel/implementation/gdpr/\\\"\\u003ethis article\\u003c/a\\u003e for more information.\"\n },\n {\n \"simpleValueType\": true,\n \"name\": \"advancedMatching\",\n \"checkboxText\": \"Enable Advanced Matching\",\n \"type\": \"CHECKBOX\"\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"dataProcessingOptionsGroup\",\n \"displayName\": \"Data Processing Options\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"subParams\": [\n {\n \"type\": \"LABEL\",\n \"name\": \"dpoInfo\",\n \"displayName\": \"Data Processing Options force this Facebook event to comply to regional regulations with regard to the processing and selling of user data. Read \\u003ca href\\u003d\\\"https://developers.facebook.com/docs/marketing-apis/data-processing-options\\\"\\u003ethis\\u003c/a\\u003e for more information about how to configure this section.\"\n },\n {\n \"type\": \"CHECKBOX\",\n \"name\": \"dpoLDU\",\n \"checkboxText\": \"Limited Data Use (LDU)\",\n \"simpleValueType\": true\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"dpoCountry\",\n \"displayName\": \"Country\",\n \"simpleValueType\": true,\n \"defaultValue\": 0,\n \"enablingConditions\": [\n {\n \"paramName\": \"dpoLDU\",\n \"paramValue\": true,\n \"type\": \"EQUALS\"\n }\n ],\n \"valueValidators\": [\n {\n \"type\": \"NUMBER\"\n }\n ]\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"dpoState\",\n \"displayName\": \"State\",\n \"simpleValueType\": true,\n \"defaultValue\": 0,\n \"enablingConditions\": [\n {\n \"paramName\": \"dpoLDU\",\n \"paramValue\": true,\n \"type\": \"EQUALS\"\n }\n ],\n \"valueValidators\": [\n {\n \"type\": \"NUMBER\"\n }\n ]\n }\n ]\n },\n {\n \"enablingConditions\": [\n {\n \"paramName\": \"advancedMatching\",\n \"type\": \"EQUALS\",\n \"paramValue\": true\n }\n ],\n \"displayName\": \"Customer Information Data Parameters\",\n \"name\": \"advancedMatchingGroup\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"type\": \"GROUP\",\n \"subParams\": [\n {\n \"displayName\": \"\",\n \"name\": \"advancedMatchingList\",\n \"simpleTableColumns\": [\n {\n \"selectItems\": [\n {\n \"displayValue\": \"City\",\n \"value\": \"ct\"\n },\n {\n \"displayValue\": \"Country\",\n \"value\": \"cn\"\n },\n {\n \"displayValue\": \"Date of Birth\",\n \"value\": \"db\"\n },\n {\n \"displayValue\": \"Email\",\n \"value\": \"em\"\n },\n {\n \"displayValue\": \"External ID\",\n \"value\": \"external_id\"\n },\n {\n \"displayValue\": \"First Name\",\n \"value\": \"fn\"\n },\n {\n \"displayValue\": \"Gender\",\n \"value\": \"ge\"\n },\n {\n \"displayValue\": \"Last Name\",\n \"value\": \"ln\"\n },\n {\n \"displayValue\": \"Phone\",\n \"value\": \"ph\"\n },\n {\n \"displayValue\": \"State\",\n \"value\": \"st\"\n },\n {\n \"displayValue\": \"Zip Code\",\n \"value\": \"zp\"\n }\n ],\n \"defaultValue\": \"\",\n \"displayName\": \"Parameter name\",\n \"name\": \"name\",\n \"isUnique\": true,\n \"type\": \"SELECT\"\n },\n {\n \"defaultValue\": \"\",\n \"displayName\": \"Parameter value\",\n \"name\": \"value\",\n \"type\": \"TEXT\"\n }\n ],\n \"type\": \"SIMPLE_TABLE\",\n \"newRowButtonText\": \"Add parameter\",\n \"valueValidators\": [\n {\n \"type\": \"NON_EMPTY\"\n }\n ]\n }\n ]\n },\n {\n \"displayName\": \"Object Properties\",\n \"name\": \"objectPropertiesGroup\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"type\": \"GROUP\",\n \"subParams\": [\n {\n \"type\": \"LABEL\",\n \"name\": \"enhancedEcommerceObject\",\n \"displayName\": \"\\u003cstrong\\u003eWarning!\\u003c/strong\\u003e Object properties are populated automatically based on the most recent \\u003cstrong\\u003eecommerce\\u003c/strong\\u003e object pushed into dataLayer. If you add properties here that are already set by the integration (content_type, contents, num_items, value, currency), then the properties you add here will override those set automatically by the integration!\",\n \"enablingConditions\": [\n {\n \"paramName\": \"enhancedEcommerce\",\n \"paramValue\": true,\n \"type\": \"EQUALS\"\n }\n ]\n },\n {\n \"type\": \"SELECT\",\n \"name\": \"objectPropertiesFromVariable\",\n \"displayName\": \"Load Properties From Variable\",\n \"macrosInSelect\": true,\n \"selectItems\": [\n {\n \"value\": false,\n \"displayValue\": \"False\"\n }\n ],\n \"simpleValueType\": true,\n \"help\": \"You can use a variable that returns a JavaScript object with the properties you want to use. This object will be merged with any additional properties you add via the table below. Any conflicts will be resolved in favor of the properties you add to the table.\"\n },\n {\n \"name\": \"objectPropertyList\",\n \"simpleTableColumns\": [\n {\n \"valueValidators\": [],\n \"defaultValue\": \"\",\n \"displayName\": \"Property Name\",\n \"name\": \"name\",\n \"isUnique\": true,\n \"type\": \"TEXT\"\n },\n {\n \"defaultValue\": \"\",\n \"displayName\": \"Property Value\",\n \"name\": \"value\",\n \"type\": \"TEXT\"\n }\n ],\n \"type\": \"SIMPLE_TABLE\",\n \"newRowButtonText\": \"Add property\"\n }\n ]\n },\n {\n \"displayName\": \"More Settings\",\n \"name\": \"moreSettingsGroup\",\n \"groupStyle\": \"ZIPPY_CLOSED\",\n \"type\": \"GROUP\",\n \"subParams\": [\n {\n \"help\": \"Facebook collects some metadata (e.g. structured data) and user interactions (e.g. clicks) automatically. Check this box to disable this automatic configuration of the pixel.\",\n \"simpleValueType\": true,\n \"name\": \"disableAutoConfig\",\n \"checkboxText\": \"Disable Automatic Configuration\",\n \"type\": \"CHECKBOX\"\n },\n {\n \"type\": \"CHECKBOX\",\n \"name\": \"disablePushState\",\n \"checkboxText\": \"Disable History Event Tracking\",\n \"simpleValueType\": true,\n \"help\": \"The Facebook Pixel tracks history events (pushState and replaceState) automatically as PageViews. Check this box to prevent the pixel from tracking such events automatically.\"\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"eventId\",\n \"displayName\": \"Event ID\",\n \"simpleValueType\": true,\n \"help\": \"Set the Event ID parameter in case you are tracking the same event server-side as well. The Event ID can be used to deduplicate the same event if sent from multiple sources. See more \\u003ca href\\u003d\\\"https://developers.facebook.com/docs/marketing-api/conversions-api/deduplicate-pixel-and-server-events/\\\"\\u003ehere\\u003c/a\\u003e.\"\n }\n ]\n }\n]\n\n\n___SANDBOXED_JS_FOR_WEB_TEMPLATE___\n\nconst createQueue = require('createQueue');\nconst callInWindow = require('callInWindow');\nconst aliasInWindow = require('aliasInWindow');\nconst copyFromWindow = require('copyFromWindow');\nconst setInWindow = require('setInWindow');\nconst injectScript = require('injectScript');\nconst makeTableMap = require('makeTableMap');\nconst makeNumber = require('makeNumber');\nconst getType = require('getType');\nconst copyFromDataLayer = require('copyFromDataLayer');\nconst math = require('Math');\nconst log = require('logToConsole');\n\nconst initIds = copyFromWindow('_fbq_gtm_ids') || [];\nconst pixelIds = data.pixelId;\nconst standardEventNames = ['AddPaymentInfo', 'AddToCart', 'AddToWishlist', 'CompleteRegistration', 'Contact', 'CustomizeProduct', 'Donate', 'FindLocation', 'InitiateCheckout', 'Lead', 'PageView', 'Purchase', 'Schedule', 'Search', 'StartTrial', 'SubmitApplication', 'Subscribe', 'ViewContent'];\nconst ecommerce = copyFromDataLayer('ecommerce', 1);\n\n// Helper methods\nconst fail = msg => {\n log(msg);\n data.gtmOnFailure();\n};\n\nconst mergeObj = (obj, obj2) => {\n for (let key in obj2) {\n if (obj2.hasOwnProperty(key)) {\n obj[key] = obj2[key];\n }\n }\n return obj;\n};\n\nconst parseEecObj = prod => {\n return {\n id: prod.id,\n quantity: prod.quantity\n };\n};\n\n// Initialize EEC integration\nlet eventName, action, eecObjectProps;\nif (data.enhancedEcommerce) {\n if (!ecommerce) return fail('Facebook Pixel: No valid \"ecommerce\" object found in dataLayer');\n if (ecommerce.detail) { eventName = 'ViewContent'; action = 'detail'; }\n else if (ecommerce.add) { eventName = 'AddToCart'; action = 'add'; }\n else if (ecommerce.checkout) { eventName = 'InitiateCheckout'; action = 'checkout'; }\n else if (ecommerce.purchase) { eventName = 'Purchase'; action = 'purchase'; }\n else return fail('Facebook Pixel: Most recently pushed \"ecommerce\" object must be one of types \"detail\", \"add\", \"checkout\" or \"purchase\".');\n \n if (!ecommerce[action].products || getType(ecommerce[action].products) !== 'array') return fail('Facebook pixel: Most recently pushed \"ecommerce\" object did not have a valid \"products\" array.');\n eecObjectProps = {\n content_type: 'product',\n contents: ecommerce[action].products.map(parseEecObj),\n value: ecommerce[action].products.reduce((acc, cur) => {\n const curVal = math.round(makeNumber(cur.price || 0) * (cur.quantity || 1) * 100) / 100;\n return acc + curVal;\n }, 0.0),\n currency: ecommerce.currencyCode || 'USD'\n };\n if (['InitiateCheckout', 'Purchase'].indexOf(eventName) > -1) eecObjectProps.num_items = ecommerce[action].products.reduce((acc,cur) => {\n return acc + makeNumber(cur.quantity || 1);\n }, 0);\n}\n\n// Build the fbq() command arguments\nconst cidParams = data.advancedMatchingList && data.advancedMatchingList.length ? makeTableMap(data.advancedMatchingList, 'name', 'value') : {};\nconst objectProps = data.objectPropertyList && data.objectPropertyList.length ? makeTableMap(data.objectPropertyList, 'name', 'value') : {};\nconst objectPropsFromVar = getType(data.objectPropertiesFromVariable) === 'object' ? data.objectPropertiesFromVariable : {};\nconst mergedObjectProps = mergeObj(objectPropsFromVar, objectProps);\nconst finalObjectProps = mergeObj(eecObjectProps || {}, mergedObjectProps);\neventName = eventName || (data.eventName === 'custom' ? data.customEventName : (data.eventName === 'variable' ? data.variableEventName : data.standardEventName));\n\nconst command = standardEventNames.indexOf(eventName) === -1 ? 'trackSingleCustom' : 'trackSingle';\nconst consent = data.consent === false ? 'revoke' : 'grant';\n\n// Utility function to use either fbq.queue[]\n// (if the FB SDK hasn't loaded yet), or fbq.callMethod()\n// if the SDK has loaded.\nconst getFbq = () => {\n // Return the existing 'fbq' global method if available\n let fbq = copyFromWindow('fbq');\n if (fbq) {\n return fbq;\n }\n \n // Initialize the 'fbq' global method to either use\n // fbq.callMethod or fbq.queue)\n setInWindow('fbq', function() { \n const callMethod = copyFromWindow('fbq.callMethod.apply');\n if (callMethod) { \n callInWindow('fbq.callMethod.apply', null, arguments); \n } else { \n callInWindow('fbq.queue.push', arguments);\n }\n });\n aliasInWindow('_fbq', 'fbq');\n \n // Create the fbq.queue\n createQueue('fbq.queue');\n \n // Return the global 'fbq' method, created above\n return copyFromWindow('fbq');\n};\n\n// Get reference to the global method\nconst fbq = getFbq();\n\nfbq('consent', consent);\n\n // Set Data Processing Options\nif (data.dpoLDU) {\n fbq('dataProcessingOptions', ['LDU'], makeNumber(data.dpoCountry), makeNumber(data.dpoState));\n}\n\n// Handle multiple, comma-separated pixel IDs,\n// and initialize each ID if not done already.\npixelIds.split(',').forEach(pixelId => {\n if (initIds.indexOf(pixelId) === -1) {\n \n // If the user has chosen to disable automatic configuration\n if (data.disableAutoConfig) {\n fbq('set', 'autoConfig', false, pixelId);\n }\n \n // If the user has chosen to disable pushState and replaceState tracking\n if (data.disablePushState) {\n setInWindow('fbq.disablePushState', true);\n }\n \t\n \n // Initialize pixel and store in global array\n fbq('init', pixelId, cidParams);\n\n // Monitoring agent string for Tag Setup\n fbq('set','agent','tmSimo-GTM-WebTemplate', pixelId);\n\n initIds.push(pixelId);\n setInWindow('_fbq_gtm_ids', initIds, true);\n \n }\n\n // Call the fbq() method with the parameters defined earlier\n if (data.eventId) {\n fbq(command, pixelId, eventName, finalObjectProps, {eventID: data.eventId});\n } else {\n fbq(command, pixelId, eventName, finalObjectProps);\n }\n});\n\ninjectScript('https://connect.facebook.net/en_US/fbevents.js', data.gtmOnSuccess, data.gtmOnFailure, 'fbPixel');\n\n\n___WEB_PERMISSIONS___\n\n[\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"access_globals\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"keys\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"fbq\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"_fbq_gtm\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"_fbq\"\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"_fbq_gtm_ids\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"fbq.callMethod.apply\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"fbq.queue.push\"\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": false\n },\n {\n \"type\": 8,\n \"boolean\": true\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"fbq.queue\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"fbq.disablePushState\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"inject_script\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"urls\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 1,\n \"string\": \"https://connect.facebook.net/en_US/fbevents.js\"\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"logging\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"environments\",\n \"value\": {\n \"type\": 1,\n \"string\": \"debug\"\n }\n }\n ]\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"read_data_layer\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"keyPatterns\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 1,\n \"string\": \"ecommerce\"\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n }\n]\n\n\n___TESTS___\n\nscenarios:\n- name: Library is injected\n code: |-\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('injectScript').wasCalledWith(scriptUrl, success, failure, 'fbPixel');\n assertApi('gtmOnSuccess').wasCalled();\n- name: fbq does not exist - method created\n code: |-\n let fbq;\n\n mock('copyFromWindow', key => {\n if (key === 'fbq') return fbq;\n });\n\n mock('createQueue', key => {});\n\n mock('setInWindow', (key, val) => {\n if (key === 'fbq') fbq = val;\n });\n\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('aliasInWindow').wasCalledWith('_fbq', 'fbq');\n assertApi('setInWindow').wasCalled();\n assertApi('gtmOnSuccess').wasCalled();\n- name: fbq exists - method copied\n code: |-\n mock('setInWindow', key => {\n if (key === 'fbq') fail('setInWindow called with fbq even though variable exists');\n });\n\n mock('createQueue', key => {});\n\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('gtmOnSuccess').wasCalled();\n- name: makeTableMap called\n code: |-\n mockData.advancedMatching = true;\n\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('makeTableMap').wasCalledWith(mockData.advancedMatchingList, 'name', 'value');\n assertApi('makeTableMap').wasCalledWith(mockData.objectPropertyList, 'name', 'value');\n assertApi('gtmOnSuccess').wasCalled();\n- name: Consent set\n code: |-\n mock('copyFromWindow', key => {\n if (key === 'fbq') return function() {\n if (arguments[0] === 'consent') {\n assertThat(arguments[1], 'Consent set incorrectly').isEqualTo('grant');\n }\n };\n });\n\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('gtmOnSuccess').wasCalled();\n- name: DPO LDU set\n code: |-\n mockData.dpoLDU = true;\n mockData.dpoCountry = '0';\n mockData.dpoState = '0';\n\n mock('copyFromWindow', key => {\n if (key === 'fbq') return function() {\n if (arguments[0] === 'consent') {\n assertThat(arguments[1], 'Consent set incorrectly').isEqualTo('grant');\n }\n if (arguments[0] === 'dataProcessingOptions') {\n assertThat(arguments[1], 'LDU array value not set').isEqualTo(['LDU']);\n assertThat(arguments[2], 'LDU country not set').isEqualTo(0);\n assertThat(arguments[3], 'LDU state not set').isEqualTo(0);\n }\n };\n });\n\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('gtmOnSuccess').wasCalled();\n- name: DPO LDU not set\n code: |-\n mock('copyFromWindow', key => {\n if (key === 'fbq') return function() {\n if (arguments[0] === 'consent') {\n assertThat(arguments[1], 'Consent set incorrectly').isEqualTo('grant');\n }\n if (arguments[0] === 'dataProcessingOptions') {\n fail('dataProcessingOptions called even though DPO was not set');\n }\n };\n });\n\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('gtmOnSuccess').wasCalled();\n- name: Pixel IDs set - do not initialize\n code: |-\n mock('copyFromWindow', key => {\n if (key === '_fbq_gtm_ids') return ['12345', '23456'];\n if (key === 'fbq') return function() {\n if (arguments[0] === 'init') fail('init called even though pixel IDs already initialized');\n };\n });\n\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('gtmOnSuccess').wasCalled();\n- name: Pixel IDs not set - run init process\n code: \"let index = 0;\\nlet count = 0;\\nlet _fbq_gtm_ids;\\n\\nmockData.advancedMatching\\\n \\ = true;\\nmockData.disableAutoConfig = true;\\nmockData.disablePushState = true;\\n\\\n \\nmock('setInWindow', (key, val) => {\\n if (key === 'fbq.disablePushState') count\\\n \\ += 1;\\n if (key === '_fbq_gtm_ids') _fbq_gtm_ids = val;\\n});\\n\\nconst initObj\\\n \\ = {\\n ct: 'Helsinki',\\n cn: 'Finland',\\n external_id: 'UserId'\\n};\\n\\nmock('copyFromWindow',\\\n \\ key => {\\n if (key === 'fbq') return function() {\\n if (arguments[0] ===\\\n \\ 'set' && arguments[1] === 'autoConfig' && arguments[2] === false) {\\n assertThat(arguments[3],\\\n \\ 'autoConfig called with incorrect pixelId').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ }\\n if (arguments[0] === 'set' && arguments[1] === 'agent') {\\n assertThat(arguments[2],\\\n \\ 'agent set with invalid value').isEqualTo('tmSimo-GTM-WebTemplate');\\n \\\n \\ assertThat(arguments[3], 'agent set with invalid pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ index += 1;\\n }\\n if (arguments[0] === 'init') {\\n assertThat(arguments[1],\\\n \\ 'init called with incorrect pixelId').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'init called with incorrect initObj').isEqualTo(initObj);\\n\\\n \\ } \\n };\\n});\\n\\n// Call runCode to run the template's code.\\nrunCode(mockData);\\n\\\n \\nassertThat(_fbq_gtm_ids, '_fbq_gtm_ids has incorrect contents').isEqualTo(mockData.pixelId.split(','));\\n\\\n assertThat(index, 'init called incorrect number of times: ' + index).isEqualTo(2);\\n\\\n assertThat(count, 'fbq.disablePushState called incorrect number of times: ' +\\\n \\ count).isEqualTo(2);\\n\\n// Verify that the tag finished successfully.\\nassertApi('gtmOnSuccess').wasCalled();\"\n- name: Send standard event\n code: \"const eventParams = {\\n prop1: 'val1',\\n prop2: 'val2'\\n};\\n\\nlet index\\\n \\ = 0;\\nmock('copyFromWindow', key => {\\n if (key === 'fbq') return function()\\\n \\ {\\n if (arguments[0] === 'trackSingle') {\\n assertThat(arguments[1],\\\n \\ 'trackSingle called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingle called with incorrect event name').isEqualTo(mockData.standardEventName);\\n\\\n \\ assertThat(arguments[3], 'trackSingle called with incorrect event parameters').isEqualTo(eventParams);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingle called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Send custom event\n code: \"mockData.eventName = 'custom';\\n\\nconst eventParams = {\\n prop1: 'val1',\\n\\\n \\ prop2: 'val2'\\n};\\n\\nlet index = 0;\\nmock('copyFromWindow', key => {\\n if\\\n \\ (key === 'fbq') return function() {\\n if (arguments[0] === 'trackSingleCustom')\\\n \\ {\\n assertThat(arguments[1], 'trackSingleCustom called with incorrect pixel\\\n \\ ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n assertThat(arguments[2],\\\n \\ 'trackSingleCustom called with incorrect event name').isEqualTo(mockData.customEventName);\\n\\\n \\ assertThat(arguments[3], 'trackSingleCustom called with incorrect event\\\n \\ parameters').isEqualTo(eventParams);\\n index += 1;\\n }\\n };\\n});\\n\\\n \\ \\n// Call runCode to run the template's code.\\nrunCode(mockData);\\n\\n//\\\n \\ Verify that the tag finished successfully.\\nassertThat(index, 'trackSingleCustom\\\n \\ called incorrect number of times').isEqualTo(2);\\nassertApi('gtmOnSuccess').wasCalled();\"\n- name: Send variable event with standard name\n code: \"mockData.eventName = 'variable';\\nmockData.variableEventName = 'PageView';\\n\\\n \\nconst eventParams = {\\n prop1: 'val1',\\n prop2: 'val2'\\n};\\n\\nlet index =\\\n \\ 0;\\nmock('copyFromWindow', key => {\\n if (key === 'fbq') return function()\\\n \\ {\\n if (arguments[0] === 'trackSingle') {\\n assertThat(arguments[1],\\\n \\ 'trackSingle called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingle called with incorrect event name').isEqualTo(mockData.variableEventName);\\n\\\n \\ assertThat(arguments[3], 'trackSingle called with incorrect event parameters').isEqualTo(eventParams);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingle called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Send variable event with custom name\n code: \"mockData.eventName = 'variable';\\nmockData.variableEventName = 'custom';\\n\\\n \\nconst eventParams = {\\n prop1: 'val1',\\n prop2: 'val2'\\n};\\n\\nlet index =\\\n \\ 0;\\nmock('copyFromWindow', key => {\\n if (key === 'fbq') return function()\\\n \\ {\\n if (arguments[0] === 'trackSingleCustom') {\\n assertThat(arguments[1],\\\n \\ 'trackSingleCustom called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingleCustom called with incorrect event\\\n \\ name').isEqualTo(mockData.variableEventName);\\n assertThat(arguments[3],\\\n \\ 'trackSingleCustom called with incorrect event parameters').isEqualTo(eventParams);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingleCustom called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Send event parameters from a variable\n code: \"mockData.objectPropertiesFromVariable = {\\n prop1: 'val1',\\n prop2: 'val2'\\n\\\n };\\n\\nlet index = 0;\\nmock('copyFromWindow', key => {\\n if (key === 'fbq') return\\\n \\ function() {\\n if (arguments[0] === 'trackSingle') {\\n assertThat(arguments[1],\\\n \\ 'trackSingle called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingle called with incorrect event name').isEqualTo(mockData.standardEventName);\\n\\\n \\ assertThat(arguments[3], 'trackSingle called with incorrect event parameters').isEqualTo(mockData.objectPropertiesFromVariable);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingle called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Enhanced Ecommerce integration fails with invalid object\n code: |-\n mockData.enhancedEcommerce = true;\n\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('logToConsole').wasCalledWith('Facebook Pixel: No valid \"ecommerce\" object found in dataLayer');\n assertApi('gtmOnFailure').wasCalled();\n assertApi('gtmOnSuccess').wasNotCalled();\n- name: Enhanced Ecommerce integration fails with invalid action\n code: |-\n mockData.enhancedEcommerce = true;\n\n mock('copyFromDataLayer', key => {\n if (key === 'ecommerce') return {\n invalid: true\n };\n });\n\n // Call runCode to run the template's code.\n runCode(mockData);\n\n // Verify that the tag finished successfully.\n assertApi('logToConsole').wasCalledWith('Facebook Pixel: Most recently pushed \"ecommerce\" object must be one of types \"detail\", \"add\", \"checkout\" or \"purchase\".');\n assertApi('gtmOnFailure').wasCalled();\n assertApi('gtmOnSuccess').wasNotCalled();\n- name: Enhanced Ecommerce ViewContent works\n code: \"mockData.enhancedEcommerce = true;\\nmockData.objectPropertyList = {};\\n\\n\\\n mock('copyFromDataLayer', key => {\\n if (key === 'ecommerce') return {\\n currencyCode:\\\n \\ 'EUR',\\n detail: {\\n products: mockEec.gtm.products\\n }\\n };\\n});\\n\\\n \\nlet index = 0;\\nmock('copyFromWindow', key => {\\n if (key === 'fbq') return\\\n \\ function() {\\n if (arguments[0] === 'trackSingle') {\\n assertThat(arguments[1],\\\n \\ 'trackSingle called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingle called with incorrect event name').isEqualTo('ViewContent');\\n\\\n \\ assertThat(arguments[3], 'trackSingle called with incorrect event parameters').isEqualTo(mockEec.fb);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingle called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Enhanced Ecommerce AddToCart works\n code: \"mockData.enhancedEcommerce = true;\\nmockData.objectPropertyList = {};\\n\\n\\\n mock('copyFromDataLayer', key => {\\n if (key === 'ecommerce') return {\\n currencyCode:\\\n \\ 'EUR',\\n add: {\\n products: mockEec.gtm.products\\n }\\n };\\n});\\n\\\n \\nlet index = 0;\\nmock('copyFromWindow', key => {\\n if (key === 'fbq') return\\\n \\ function() {\\n if (arguments[0] === 'trackSingle') {\\n assertThat(arguments[1],\\\n \\ 'trackSingle called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingle called with incorrect event name').isEqualTo('AddToCart');\\n\\\n \\ assertThat(arguments[3], 'trackSingle called with incorrect event parameters').isEqualTo(mockEec.fb);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingle called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Enhanced Ecommerce InitiateCheckout works\n code: \"mockData.enhancedEcommerce = true;\\nmockEec.fb.num_items = 3;\\nmockData.objectPropertyList\\\n \\ = {};\\n\\nmock('copyFromDataLayer', key => {\\n if (key === 'ecommerce') return\\\n \\ {\\n currencyCode: 'EUR',\\n checkout: {\\n products: mockEec.gtm.products\\n\\\n \\ }\\n };\\n});\\n\\nlet index = 0;\\nmock('copyFromWindow', key => {\\n if (key\\\n \\ === 'fbq') return function() {\\n if (arguments[0] === 'trackSingle') {\\n\\\n \\ assertThat(arguments[1], 'trackSingle called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingle called with incorrect event name').isEqualTo('InitiateCheckout');\\n\\\n \\ assertThat(arguments[3], 'trackSingle called with incorrect event parameters').isEqualTo(mockEec.fb);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingle called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Enhanced Ecommerce Purchase works\n code: \"mockData.enhancedEcommerce = true;\\nmockEec.fb.num_items = 3;\\nmockData.objectPropertyList\\\n \\ = {};\\n\\nmock('copyFromDataLayer', key => {\\n if (key === 'ecommerce') return\\\n \\ {\\n currencyCode: 'EUR',\\n purchase: {\\n products: mockEec.gtm.products\\n\\\n \\ }\\n };\\n});\\n\\nlet index = 0;\\nmock('copyFromWindow', key => {\\n if (key\\\n \\ === 'fbq') return function() {\\n if (arguments[0] === 'trackSingle') {\\n\\\n \\ assertThat(arguments[1], 'trackSingle called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingle called with incorrect event name').isEqualTo('Purchase');\\n\\\n \\ assertThat(arguments[3], 'trackSingle called with incorrect event parameters').isEqualTo(mockEec.fb);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingle called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Object merge with variable and list works\n code: \"mockData.objectPropertiesFromVariable = {\\n prop1: 'var1',\\n prop2: 'var2',\\n\\\n \\ prop3: 'var3'\\n};\\n\\nconst expected = {\\n prop1: 'val1',\\n prop2: 'val2',\\n\\\n \\ prop3: 'var3'\\n};\\n\\nlet index = 0;\\nmock('copyFromWindow', key => {\\n if\\\n \\ (key === 'fbq') return function() {\\n if (arguments[0] === 'trackSingle')\\\n \\ {\\n assertThat(arguments[1], 'trackSingle called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingle called with incorrect event name').isEqualTo('PageView');\\n\\\n \\ assertThat(arguments[3], 'trackSingle called with incorrect event parameters').isEqualTo(expected);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingle called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Object merge with variable, list and eec works\n code: \"mockData.enhancedEcommerce = true;\\nmockData.objectPropertiesFromVariable\\\n \\ = {\\n content_type: 'product_group'\\n};\\nmockData.objectPropertyList = [{\\n\\\n \\ name: 'currency',\\n value: 'USD'\\n}];\\nmockEec.fb.num_items = 3;\\nmockEec.fb.content_type\\\n \\ = 'product_group';\\nmockEec.fb.currency = 'USD';\\n\\nmock('copyFromDataLayer',\\\n \\ key => {\\n if (key === 'ecommerce') return {\\n currencyCode: 'EUR',\\n \\\n \\ purchase: {\\n products: mockEec.gtm.products\\n }\\n };\\n});\\n\\nlet\\\n \\ index = 0;\\nmock('copyFromWindow', key => {\\n if (key === 'fbq') return function()\\\n \\ {\\n if (arguments[0] === 'trackSingle') {\\n assertThat(arguments[1],\\\n \\ 'trackSingle called with incorrect pixel ID').isEqualTo(mockData.pixelId.split(',')[index]);\\n\\\n \\ assertThat(arguments[2], 'trackSingle called with incorrect event name').isEqualTo('Purchase');\\n\\\n \\ assertThat(arguments[3], 'trackSingle called with incorrect event parameters').isEqualTo(mockEec.fb);\\n\\\n \\ index += 1;\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertThat(index, 'trackSingle called incorrect number of times').isEqualTo(2);\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\n- name: Send event ID\n code: \"mockData.eventId = 'eventId';\\n\\nmock('copyFromWindow', key => {\\n if (key\\\n \\ === 'fbq') return function() {\\n if (arguments[0] === 'trackSingle') {\\n\\\n \\ assertThat(arguments[4], 'eventID not included in hit').isEqualTo({eventID:\\\n \\ mockData.eventId});\\n }\\n };\\n});\\n \\n// Call runCode to run the template's\\\n \\ code.\\nrunCode(mockData);\\n\\n// Verify that the tag finished successfully.\\n\\\n assertApi('gtmOnSuccess').wasCalled();\"\nsetup: \"const mockData = {\\n pixelId: '12345,23456',\\n eventName: 'standard',\\n\\\n \\ standardEventName: 'PageView',\\n customEventName: 'custom',\\n variableEventName:\\\n \\ 'standard',\\n consent: true,\\n advancedMatching: false,\\n advancedMatchingList:\\\n \\ [{name: 'ct', value: 'Helsinki'},{name: 'cn', value: 'Finland'},{name: 'external_id',\\\n \\ value: 'UserId'}],\\n objectPropertiesFromVariable: false,\\n objectPropertyList:\\\n \\ [{name: 'prop1', value: 'val1'},{name: 'prop2', value: 'val2'}],\\n disableAutoConfig:\\\n \\ false,\\n disablePushState: false,\\n enhancedEcommerce: false,\\n eventId: ''\\n\\\n };\\n\\nconst mockEec = {\\n gtm: { \\n products: [{\\n id: 'i1',\\n name:\\\n \\ 'n1',\\n category: 'c1',\\n price: '1.00',\\n quantity: 1\\n },{\\n\\\n \\ id: 'i2',\\n name: 'n2',\\n category: 'c2',\\n price: '2.00',\\n\\\n \\ quantity: 2\\n }]\\n },\\n fb: {\\n content_type: 'product',\\n contents:\\\n \\ [{\\n id: 'i1',\\n quantity: 1\\n },{\\n id: 'i2',\\n quantity:\\\n \\ 2\\n }],\\n currency: 'EUR',\\n value: 5.00\\n }\\n};\\n\\nconst scriptUrl\\\n \\ = 'https://connect.facebook.net/en_US/fbevents.js';\\n\\n// Create injectScript\\\n \\ mock\\nlet success, failure;\\nmock('injectScript', (url, onsuccess, onfailure)\\\n \\ => {\\n success = onsuccess;\\n failure = onfailure;\\n onsuccess();\\n});\\n\\n\\\n mock('copyFromWindow', key => {\\n if (key === 'fbq') return () => {};\\n});\"\n\n\n___NOTES___\n\nCreated on 18/05/2019, 21:57:16\n\n\n",
 "galleryReference": {
 "host": "github.com",
 "owner": "facebookarchive",
 "repository": "GoogleTagManager-WebTemplate-For-FacebookPixel",
 "version": "11c004614f6b8f7cc999caabef521086116ce302",
 "signature": "de30f66e675f24ef8640cea7175b615c94807fa8f027929f94c3d0b45a520d86"
 }
 },
 {
 "accountId": "6061284649",
 "containerId": "96000106",
 "templateId": "213",
 "name": "Persist Campaign Data",
 "fingerprint": "1720312556124",
 "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n \"type\": \"TAG\",\n \"id\": \"cvt_temp_public_id\",\n \"version\": 1,\n \"securityGroups\": [],\n \"displayName\": \"Persist Campaign Data\",\n \"categories\": [\n \"ANALYTICS\",\n \"UTILITY\"\n ],\n \"brand\": {\n \"id\": \"github.com_gtm-templates-simo-ahava\",\n \"displayName\": \"gtm-templates-simo-ahava\",\n \"thumbnail\": \"data:image/png;base64,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\\u003d\\u003d\"\n },\n \"description\": \"This template preserves the landing page URL and referrer string in a browser cookie, and pushes the original location into \\u003ccode\\u003edataLayer\\u003c/code\\u003e.\",\n \"containerContexts\": [\n \"WEB\"\n ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n {\n \"type\": \"CHECKBOX\",\n \"name\": \"storeInCookieOption\",\n \"checkboxText\": \"Store campaign data in a browser cookie\",\n \"simpleValueType\": true,\n \"help\": \"Select this option to save the page URL in a browser cookie \\u003cstrong\\u003eif\\u003c/strong\\u003e it has campaign defining parameters (utm_*, gclid). The referrer string is also saved in a cookie \\u003cstrong\\u003eif\\u003c/strong\\u003e its hostname differs from the current one.\"\n },\n {\n \"type\": \"CHECKBOX\",\n \"name\": \"originalLocationOption\",\n \"checkboxText\": \"Push original location in dataLayer\",\n \"simpleValueType\": true,\n \"help\": \"Select this option to push the current URL into \\u003ccode\\u003edataLayer\\u003c/code\\u003e. This is useful on single-page apps with \\u003ca href\\u003d\\\"https://www.simoahava.com/gtm-tips/fix-rogue-referral-problem-single-page-sites/\\\"\\u003erogue referral\\u003c/a\\u003e issues. To be effective, this tag should only fire on the initial page load and not on subsequent SPA page events.\"\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"storeInCookie\",\n \"displayName\": \"Store campaign data in a cookie\",\n \"groupStyle\": \"ZIPPY_OPEN\",\n \"subParams\": [\n {\n \"type\": \"TEXT\",\n \"name\": \"triggerParameters\",\n \"displayName\": \"URL parameters that trigger the storage\",\n \"simpleValueType\": true,\n \"help\": \"Comma-separated list of parameters that trigger storage. If the URL has any one of these, then the browser cookie will be updated with the current URL.\",\n \"defaultValue\": \"utm_source,utm_medium,utm_campaign,utm_term,utm_content,utm_id,gclid\",\n \"valueValidators\": [\n {\n \"type\": \"NON_EMPTY\"\n }\n ]\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"urlCookieName\",\n \"displayName\": \"Campaign URL cookie name\",\n \"simpleValueType\": true,\n \"help\": \"Cookie name where to save the URL with the campaign parameters. The cookie will be a \\u003cstrong\\u003esession cookie\\u003c/strong\\u003e written on the parent domain and root path. \\u003cstrong\\u003eIf you change the cookie name, remember to update the template permissions!\\u003c/strong\\u003e\",\n \"defaultValue\": \"__gtm_campaign_url\",\n \"valueValidators\": [\n {\n \"type\": \"NON_EMPTY\"\n }\n ]\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"referrerCookieName\",\n \"displayName\": \"Referrer cookie name\",\n \"simpleValueType\": true,\n \"help\": \"Cookie name where to save the referrer string when the referrer hostname differs from the current hostname. The cookie will be a \\u003cstrong\\u003esession cookie\\u003c/strong\\u003e written on the parent domain and root path. \\u003cstrong\\u003eIf you change the cookie name, remember to update the template permissions!\\u003c/strong\\u003e\",\n \"defaultValue\": \"__gtm_referrer\",\n \"valueValidators\": [\n {\n \"type\": \"NON_EMPTY\"\n }\n ]\n }\n ],\n \"enablingConditions\": [\n {\n \"paramName\": \"storeInCookieOption\",\n \"paramValue\": true,\n \"type\": \"EQUALS\"\n }\n ]\n },\n {\n \"type\": \"GROUP\",\n \"name\": \"pushToDataLayer\",\n \"displayName\": \"Data Layer options for original location\",\n \"groupStyle\": \"ZIPPY_OPEN\",\n \"subParams\": [\n {\n \"type\": \"TEXT\",\n \"name\": \"dataLayerName\",\n \"displayName\": \"Name of the dataLayer array\",\n \"simpleValueType\": true,\n \"defaultValue\": \"dataLayer\",\n \"valueValidators\": [\n {\n \"type\": \"NON_EMPTY\"\n }\n ]\n },\n {\n \"type\": \"TEXT\",\n \"name\": \"dataLayerKey\",\n \"displayName\": \"Key name in dataLayer for the original location\",\n \"simpleValueType\": true,\n \"defaultValue\": \"originalLocation\",\n \"valueValidators\": [\n {\n \"type\": \"NON_EMPTY\"\n }\n ]\n }\n ],\n \"enablingConditions\": [\n {\n \"paramName\": \"originalLocationOption\",\n \"paramValue\": true,\n \"type\": \"EQUALS\"\n }\n ]\n }\n]\n\n\n___SANDBOXED_JS_FOR_WEB_TEMPLATE___\n\nconst getUrl = require('getUrl');\nconst getReferrerUrl = require('getReferrerUrl');\nconst createQueue = require('createQueue');\nconst setCookie = require('setCookie');\nconst queryPermission = require('queryPermission');\nconst log = require('logToConsole');\n\nlet fail = false;\n\nif (data.storeInCookieOption) {\n // Check if URL has any of the params listed\n const paramsToFind = data.triggerParameters.split(',');\n const queryString = getUrl('query');\n const queryParams = queryString.length ? queryString.split('&') : [];\n if (queryParams.filter(pair => paramsToFind.indexOf(pair.split('=')[0]) > -1).length) {\n if (queryPermission('set_cookies', data.urlCookieName)) {\n setCookie(data.urlCookieName, getUrl(), {\n domain: 'auto',\n path: '/'\n });\n } else {\n log('Invalid permissions for writing ' + data.urlCookieName + ' cookie!');\n fail = true;\n }\n }\n \n // Check if referrer host does not contain current hostname\n const referrerHost = getReferrerUrl('host');\n if (referrerHost.indexOf(getUrl('host')) === -1 && referrerHost !== '') {\n if (queryPermission('set_cookies', data.referrerCookieName)) {\n setCookie(data.referrerCookieName, getReferrerUrl(), {\n domain: 'auto',\n path: '/'\n });\n } else {\n log('Invalid permissions for writing ' + data.referrerCookieName + ' cookie!');\n fail = true;\n }\n }\n}\n\nif (data.originalLocationOption) {\n // Push the current URL into dataLayer with the given key\n if (queryPermission('access_globals', 'readwrite', data.dataLayerName)) {\n const dataLayerPush = createQueue(data.dataLayerName);\n const obj = {event: 'originalLocation'};\n obj[data.dataLayerKey] = getUrl();\n dataLayerPush(obj);\n } else {\n log('Invalid permissions for creating ' + data.dataLayerName + ' queue!');\n fail = true;\n }\n}\n\nif (fail) { data.gtmOnFailure(); } else { data.gtmOnSuccess(); }\n\n\n___WEB_PERMISSIONS___\n\n[\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"access_globals\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"keys\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"key\"\n },\n {\n \"type\": 1,\n \"string\": \"read\"\n },\n {\n \"type\": 1,\n \"string\": \"write\"\n },\n {\n \"type\": 1,\n \"string\": \"execute\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"dataLayer\"\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": true\n },\n {\n \"type\": 8,\n \"boolean\": false\n }\n ]\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"get_referrer\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"urlParts\",\n \"value\": {\n \"type\": 1,\n \"string\": \"any\"\n }\n },\n {\n \"key\": \"queriesAllowed\",\n \"value\": {\n \"type\": 1,\n \"string\": \"any\"\n }\n }\n ]\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"set_cookies\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"allowedCookies\",\n \"value\": {\n \"type\": 2,\n \"listItem\": [\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"name\"\n },\n {\n \"type\": 1,\n \"string\": \"domain\"\n },\n {\n \"type\": 1,\n \"string\": \"path\"\n },\n {\n \"type\": 1,\n \"string\": \"secure\"\n },\n {\n \"type\": 1,\n \"string\": \"session\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"__gtm_campaign_url\"\n },\n {\n \"type\": 1,\n \"string\": \"*\"\n },\n {\n \"type\": 1,\n \"string\": \"*\"\n },\n {\n \"type\": 1,\n \"string\": \"any\"\n },\n {\n \"type\": 1,\n \"string\": \"any\"\n }\n ]\n },\n {\n \"type\": 3,\n \"mapKey\": [\n {\n \"type\": 1,\n \"string\": \"name\"\n },\n {\n \"type\": 1,\n \"string\": \"domain\"\n },\n {\n \"type\": 1,\n \"string\": \"path\"\n },\n {\n \"type\": 1,\n \"string\": \"secure\"\n },\n {\n \"type\": 1,\n \"string\": \"session\"\n }\n ],\n \"mapValue\": [\n {\n \"type\": 1,\n \"string\": \"__gtm_referrer\"\n },\n {\n \"type\": 1,\n \"string\": \"*\"\n },\n {\n \"type\": 1,\n \"string\": \"*\"\n },\n {\n \"type\": 1,\n \"string\": \"any\"\n },\n {\n \"type\": 1,\n \"string\": \"any\"\n }\n ]\n }\n ]\n }\n }\n ]\n },\n \"clientAnnotations\": {\n \"isEditedByUser\": true\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"get_url\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"urlParts\",\n \"value\": {\n \"type\": 1,\n \"string\": \"any\"\n }\n },\n {\n \"key\": \"queriesAllowed\",\n \"value\": {\n \"type\": 1,\n \"string\": \"any\"\n }\n }\n ]\n },\n \"isRequired\": true\n },\n {\n \"instance\": {\n \"key\": {\n \"publicId\": \"logging\",\n \"versionId\": \"1\"\n },\n \"param\": [\n {\n \"key\": \"environments\",\n \"value\": {\n \"type\": 1,\n \"string\": \"debug\"\n }\n }\n ]\n },\n \"isRequired\": true\n }\n]\n\n\n___TESTS___\n\nscenarios:\n- name: Do not write cookies if no trigger parameters in URL and if referrer host\n contains current host\n code: |-\n mock('getUrl', component => {\n if (component === 'query') return '?invalidparam=true';\n if (component === 'host') return workingUrl.host;\n return workingUrl.full;\n });\n\n mock('getReferrerUrl', component => {\n return component === 'host' ? workingUrl.host : mockReferrer.full;\n });\n\n // Call runCode to run the template's code.\n runCode(mockStoreData);\n\n assertApi('getUrl').wasCalled();\n assertApi('getReferrerUrl').wasCalled();\n assertApi('queryPermission').wasNotCalled();\n assertApi('setCookie').wasNotCalled();\n assertApi('logToConsole').wasNotCalled();\n assertApi('createQueue').wasNotCalled();\n\n assertApi('gtmOnFailure').wasNotCalled();\n assertApi('gtmOnSuccess').wasCalled();\n- name: Write URL cookie if trigger parameters in URL\n code: |-\n mock('getUrl', component => {\n if (component === 'query') return workingUrl.params;\n if (component === 'host') return workingUrl.host;\n return workingUrl.full;\n });\n\n mock('getReferrerUrl', component => {\n return component === 'host' ? workingUrl.host : mockReferrer.full;\n });\n\n mock('setCookie', (name, value, options) => {\n if (name === mockStoreData.referrerCookieName) fail('Referrer cookie was set');\n if (name !== mockStoreData.urlCookieName) fail('Cookie name not set');\n if (value !== workingUrl.full) fail('Cookie set with wrong URL');\n });\n\n // Call runCode to run the template's code.\n runCode(mockStoreData);\n\n assertApi('getUrl').wasCalled();\n assertApi('getReferrerUrl').wasCalled();\n assertApi('queryPermission').wasCalled();\n assertApi('setCookie').wasCalled();\n assertApi('logToConsole').wasNotCalled();\n assertApi('createQueue').wasNotCalled();\n\n assertApi('gtmOnFailure').wasNotCalled();\n assertApi('gtmOnSuccess').wasCalled();\n- name: Fail if invalid permissions to write URL cookie\n code: |-\n mock('getUrl', component => {\n if (component === 'query') return workingUrl.params;\n if (component === 'host') return workingUrl.host;\n return workingUrl.full;\n });\n\n mock('getReferrerUrl', component => {\n return component === 'host' ? workingUrl.host : mockReferrer.full;\n });\n\n mock('queryPermission', (permission, cookieName) => {\n if (cookieName === mockStoreData.urlCookieName) return false;\n if (cookieName === mockStoreData.referrerCookieName) fail('Query permission called for referrer cookie');\n });\n\n mock('logToConsole', false);\n\n // Call runCode to run the template's code.\n runCode(mockStoreData);\n\n assertApi('getUrl').wasCalled();\n assertApi('getReferrerUrl').wasCalled();\n assertApi('queryPermission').wasCalled();\n assertApi('setCookie').wasNotCalled();\n assertApi('logToConsole').wasCalled();\n assertApi('createQueue').wasNotCalled();\n\n assertApi('gtmOnFailure').wasCalled();\n assertApi('gtmOnSuccess').wasNotCalled();\n- name: Write referrer cookie if referrer host does not contain current host\n code: |-\n mock('getUrl', component => {\n if (component === 'query') return '?invalidparam=true';\n if (component === 'host') return workingUrl.host;\n return workingUrl.full;\n });\n\n mock('getReferrerUrl', component => {\n return component === 'host' ? mockReferrer.host : mockReferrer.full;\n });\n\n mock('setCookie', (name, value, options) => {\n if (name !== mockStoreData.referrerCookieName) fail('Cookie name not set');\n if (name == mockStoreData.urlCookieName) fail('URL cookie set');\n if (value !== mockReferrer.full) fail('Cookie set with wrong URL');\n });\n\n // Call runCode to run the template's code.\n runCode(mockStoreData);\n\n assertApi('getUrl').wasCalled();\n assertApi('getReferrerUrl').wasCalled();\n assertApi('queryPermission').wasCalled();\n assertApi('setCookie').wasCalled();\n assertApi('logToConsole').wasNotCalled();\n assertApi('createQueue').wasNotCalled();\n\n assertApi('gtmOnFailure').wasNotCalled();\n assertApi('gtmOnSuccess').wasCalled();\n- name: Fail if invalid permissions to write referrer cookie\n code: |-\n mock('getUrl', component => {\n if (component === 'query') return '?invalidparams=true';\n if (component === 'host') return workingUrl.host;\n return workingUrl.full;\n });\n\n mock('getReferrerUrl', component => {\n return component === 'host' ? mockReferrer.host : mockReferrer.full;\n });\n\n mock('queryPermission', (permission, cookieName) => {\n if (cookieName === mockStoreData.urlCookieName) fail('Query permission called for URL cookie');\n if (cookieName === mockStoreData.referrerCookieName) return false;\n });\n\n mock('logToConsole', false);\n\n // Call runCode to run the template's code.\n runCode(mockStoreData);\n\n assertApi('getUrl').wasCalled();\n assertApi('getReferrerUrl').wasCalled();\n assertApi('queryPermission').wasCalled();\n assertApi('setCookie').wasNotCalled();\n assertApi('logToConsole').wasCalled();\n assertApi('createQueue').wasNotCalled();\n\n assertApi('gtmOnFailure').wasCalled();\n assertApi('gtmOnSuccess').wasNotCalled();\n- name: Push original location to dataLayer\n code: |-\n mock('getUrl', workingUrl.full);\n\n mock('createQueue', name => {\n if (name !== mockOriginalData.dataLayerName) fail('Tried to create queue with invalid name');\n return (obj) => {\n if (obj.event !== 'originalLocation') fail('Tried to push invalid event name');\n if (obj[mockOriginalData.dataLayerKey] !== workingUrl.full) fail('Tried to push invalid URL');\n };\n });\n\n // Call runCode to run the template's code.\n runCode(mockOriginalData);\n\n assertApi('getUrl').wasCalled();\n assertApi('getReferrerUrl').wasNotCalled();\n assertApi('queryPermission').wasCalled();\n assertApi('setCookie').wasNotCalled();\n assertApi('logToConsole').wasNotCalled();\n assertApi('createQueue').wasCalled();\n\n assertApi('gtmOnFailure').wasNotCalled();\n assertApi('gtmOnSuccess').wasCalled();\n- name: Fail if invalid permissions to write to dataLayer\n code: |-\n mock('queryPermission', (permission, cookieName) => {\n if (permission === 'set_cookies') fail('Permission call for set_cookies made');\n return false;\n });\n\n mock('logToConsole', false);\n\n // Call runCode to run the template's code.\n runCode(mockOriginalData);\n\n assertApi('getUrl').wasNotCalled();\n assertApi('getReferrerUrl').wasNotCalled();\n assertApi('queryPermission').wasCalled();\n assertApi('setCookie').wasNotCalled();\n assertApi('logToConsole').wasCalled();\n assertApi('createQueue').wasNotCalled();\n\n assertApi('gtmOnFailure').wasCalled();\n assertApi('gtmOnSuccess').wasNotCalled();\nsetup: \"const mockStoreData = {\\n storeInCookieOption: true,\\n triggerParameters:\\\n \\ 'utm_source,utm_medium,utm_campaign,utm_term,utm_content,utm_id,gclid',\\n urlCookieName:\\\n \\ '__gtm_campaign_url',\\n referrerCookieName: '__gtm_referrer'\\n};\\n\\nconst mockOriginalData\\\n \\ = {\\n originalLocationOption: true,\\n dataLayerName: 'dataLayer',\\n dataLayerKey:\\\n \\ 'originalLocation'\\n};\\n \\nconst workingUrl = {\\n params: '?utm_source=test&utm_medium=test',\\n\\\n \\ host: 'www.example.com',\\n full: 'https://www.example.com/path/?utm_source=test&utm_medium=test#home'\\n\\\n };\\n\\nconst mockReferrer = {\\n host: 'www.otherdomain.com',\\n full: 'https://www.otherdomain.com/path/'\\n\\\n };\"\n\n\n___NOTES___\n\nCreated on 30/11/2019, 11:26:05\n\n\n",
 "galleryReference": {
 "host": "github.com",
 "owner": "gtm-templates-simo-ahava",
 "repository": "persist-campaign-data",
 "version": "65d7ef3fae4bde0ad4d829506bb85e5771922925",
 "signature": "23dc5626da5910d43124815c0f6fb6907467673e697f80738b7727ce67bf3e4e"
 }
 }
 ]
 }
}
```
 

## ‘Custom Pixel’ script IMPLEMENTATION _ DO NOT USE
 
This code installs GTM, then listens to customer events and pushes their information to the dataLayer.
 
In the Customer Privacy section, select:
 
 - Not required (in the Permission section)
 - Data collection does not qualify as data sale (in the Data sale section)
 
 
CUSTOM PIXEL - ES5
 

##### Custom Pixel (w/ below Click Tracking Enabled) - ES5
 
```
/* *** GLOBAL SETTINGS *** */
var config = {
  /* *** EVENT TRACKING SETTINGS *** */
  conversionTracking: {
    // gtmContainerId: 'GTM-KMSG3C7', // Google Tag Manager container ID
    // change true or false to activate events:
    trackPageViews: true,
    trackClicks: true,
    trackSearch: true,
    trackFormSubmit: true,
    trackViewItemList: true,
    trackViewItem: true,
    trackAddToCart: true,
    trackViewCart: true,
    trackRemoveFromCart: true,
    trackBeginCheckout: true,
    trackAddShippingInfo: true,
    trackAddPaymentInfo: true,
    trackPurchase: true,
    trackScroll: false,
    trackVideo: false,
  },
  
  /* *** STORE SETTINGS *** */
  store: {
    affiliationName: init.data.shop.name,
  },
};

/* *** FUNCTION TO ENCODE EMAIL *** */
function encodeEmail(email) {
  return btoa(email); // Base64 encoding
}

/* *** SHA-256 HASH EMAIL *** */
async function generateSHA256(email) {
  const encoder = new TextEncoder();
  const data = encoder.encode(email);
  const hash = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
}
/* *** END OF GLOBAL SETTINGS *** */
  
var initContextData = init.context && init.context.document;
var initCustomerData = init.data && init.data.customer;
  
/* *** STORE CLEAN PAGE URLS & CONSTANT VALUES *** */
window.dataLayer = window.dataLayer || [];
(async function() {
  var encodedEmail = initCustomerData && initCustomerData.email ? encodeEmail(initCustomerData.email) : '';
  var encodedEmailSHA = initCustomerData && initCustomerData.email ? await generateSHA256(initCustomerData.email) : '';
  var loggedIn = initCustomerData && initCustomerData.id ? true : false;
  var vfEmployee = initCustomerData && initCustomerData.email && initCustomerData.email.endsWith('@vfc.com') ? true : false;

  dataLayer.push({
    page_location: initContextData && initContextData.location && initContextData.location.href,
    page_referrer: initContextData && initContextData.referrer,
    page_title: initContextData && initContextData.title,
    user: {
      customer_id: initCustomerData && initCustomerData.id,
      encoded_email: encodedEmail,
      encoded_email_sha: encodedEmailSHA,
      loggedIn: loggedIn,
      vfEmployee: vfEmployee,
      ordersCount: initCustomerData && initCustomerData.ordersCount,
    },
  });
})();
  
// GTM script
(function(w,d,s,l,i){
  w[l]=w[l]||[];
  w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
  var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
  j.async=true;
  j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
  f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KMSG3C7');

/* *** NON-ECOMMERCE EVENTS *** */

/* *** PAGE VIEW TRACKING *** */
if (config.conversionTracking.trackPageViews) {
  analytics.subscribe('page_viewed', function (event) {
    try {
      var eventContextData = event.context && event.context.document;

      window.dataLayer.push({
        event: 'page_view',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
      });
    } catch (error) {
      console.error('Error handling page_viewed event:', error);
    }
  });
}
/* *** END OF PAGE VIEW TRACKING *** */

/* *** CLICK TRACKING - storefront *** */
if (config.conversionTracking.trackClicks) {
  analytics.subscribe('custom_click', function (event) {
    try {
      var eventContextData = event.context && event.context.document;

      window.dataLayer.push({
        event: 'click_storefront',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        data: event.customData,
      });
    } catch (error) {
      console.error('Error handling custom_click event:', error);
    }
  });

  analytics.subscribe('custom_link_click', function (event) {
    try {
      var eventContextData = event.context && event.context.document;

      window.dataLayer.push({
        event: 'click_link_storefront',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        data: event.customData,
      });
    } catch (error) {
      console.error('Error handling custom_link_click event:', error);
    }
  });

  /* *** CLICK TRACKING - checkout *** */
  if (initContextData && initContextData.location && initContextData.location.href.includes('/checkouts/')) {
    analytics.subscribe('clicked', function (event) {
      try {
        var element = event.data && event.data.element;
        var eventContextData = event.context && event.context.document;

        var dataLayerObj = {
          event: 'click_checkout',
          timestamp: event.timestamp,
          id: event.id,
          client_id: event.clientId,
          page_location: eventContextData && eventContextData.location && eventContextData.location.href,
          page_referrer: eventContextData && eventContextData.referrer,
          page_title: eventContextData && eventContextData.title,
          data: {
            click_element: element && element.type || '',
            click_id: element && element.id || '',
            click_classes: '',
            click_text: element && element.value || '',
            click_target: '',
            click_url: element && element.href || '',
          },
        };

        window.dataLayer.push(dataLayerObj);
      } catch (error) {
        console.error('Error handling clicked event:', error);
      }
    });
  }
  /* *** END OF CLICK TRACKING - checkout *** */
}
/* *** END OF CLICK TRACKING - storefront *** */

/* *** SEARCH *** */
if (config.conversionTracking.trackSearch) {
  analytics.subscribe('search_submitted', function (event) {
    try {
      var eventContextData = event.context && event.context.document;

      window.dataLayer.push({
        event: 'view_search_results',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        search_term: event.data && event.data.searchResult && event.data.searchResult.query,
      });
    } catch (error) {
      console.error('Error handling search_submitted event:', error);
    }
  });
}
/* *** END OF SEARCH *** */

/* *** FORM SUBMIT *** */
if (config.conversionTracking.trackFormSubmit) {
  analytics.subscribe('form_submitted', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var decodedAction = decodeURIComponent(event.data && event.data.element && event.data.element.action || '');

      if (!decodedAction.includes('/cart/add')) {
        window.dataLayer.push({
          event: 'form_submit',
          timestamp: event.timestamp,
          id: event.id,
          client_id: event.clientId,
          page_location: eventContextData && eventContextData.location && eventContextData.location.href,
          page_referrer: eventContextData && eventContextData.referrer,
          page_title: eventContextData && eventContextData.title,
          form_action: event.data && event.data.element && event.data.element.action,
          form_id: event.data && event.data.element && event.data.element.id,
        });
      }
    } catch (error) {
      console.error('Error handling form_submitted event:', error);
    }
  });
}
/* *** END OF FORM SUBMIT *** */

/* *** ECOMMERCE EVENTS *** */

/* *** VIEW ITEM LIST *** */
if (config.conversionTracking.trackViewItemList) {
  analytics.subscribe('collection_viewed', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var collection = event.data && event.data.collection;

      var googleAnalyticsProducts = (collection && collection.productVariants || []).map(function (item, index) {
        return {
          item_id: item.product && item.product.id,
          item_name: item.product && item.product.title,
          affiliation: config.store.affiliationName,
          index: index,
          item_brand: item.product && item.product.vendor,
          item_category: item.product && item.product.type,
          item_list_id: collection && collection.id,
          item_list_name: collection && collection.title,
          price: item.price && item.price.amount,
          quantity: 1,
          item_variant: item.title,
          item_sku: item.sku
        };
      });

      var dataLayerObj = {
        event: 'view_item_list',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        ecommerce: {
          item_list_id: collection && collection.id,
          item_list_name: collection && collection.title,
          items: googleAnalyticsProducts,
        },
      };

      window.dataLayer.push({ ecommerce: null });
      window.dataLayer.push(dataLayerObj);
    } catch (error) {
      console.error('Error handling collection_viewed event:', error);
    }
  });
}
/* *** END OF VIEW ITEM LIST *** */

/* *** VIEW ITEM *** */
if (config.conversionTracking.trackViewItem) {
  analytics.subscribe('product_viewed', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var productVariant = event.data && event.data.productVariant;

      var googleAnalyticsProducts = (productVariant ? [productVariant] : []).map(function (item) {
        return {
          item_id: item.product && item.product.id,
          item_name: item.product && item.product.title,
          affiliation: config.store.affiliationName,
          item_brand: item.product && item.product.vendor,
          item_category: item.product && item.product.type,
          item_variant: item.title,
          item_sku: item.sku,
          price: item.price && item.price.amount,
          quantity: 1,
        };
      });

      var dataLayerObj = {
        event: 'view_item',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        ecommerce: {
          currency: productVariant && productVariant.price && productVariant.price.currencyCode,
          value: productVariant && productVariant.price && productVariant.price.amount,
          items: googleAnalyticsProducts,
        },
      };

      window.dataLayer.push({ ecommerce: null });
      window.dataLayer.push(dataLayerObj);
    } catch (error) {
      console.error('Error handling product_viewed event:', error);
    }
  });
}
/* *** END OF VIEW ITEM *** */

/* *** ADD TO CART *** */
if (config.conversionTracking.trackAddToCart) {
  analytics.subscribe('product_added_to_cart', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var cartLine = event.data && event.data.cartLine;

      var googleAnalyticsProducts = (cartLine ? [cartLine] : []).map(function (item) {
        return {
          item_id: item.merchandise && item.merchandise.product && item.merchandise.product.id,
          item_name: item.merchandise && item.merchandise.product && item.merchandise.product.title,
          affiliation: config.store.affiliationName,
          item_brand: item.merchandise && item.merchandise.product && item.merchandise.product.vendor,
          item_category: item.merchandise && item.merchandise.product && item.merchandise.product.type,
          item_variant: item.merchandise && item.merchandise.title,
          item_sku: item.merchandise && item.merchandise.sku,
          price: item.merchandise && item.merchandise.price && item.merchandise.price.amount,
          quantity: item.quantity,
        };
      });

      var dataLayerObj = {
        event: 'add_to_cart',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        ecommerce: {
          currency: cartLine && cartLine.cost && cartLine.cost.totalAmount && cartLine.cost.totalAmount.currencyCode,
          value: cartLine && cartLine.cost && cartLine.cost.totalAmount && cartLine.cost.totalAmount.amount,
          items: googleAnalyticsProducts,
        },
      };

      window.dataLayer.push({ ecommerce: null });
      window.dataLayer.push(dataLayerObj);
    } catch (error) {
      console.error('Error handling product_added_to_cart event:', error);
    }
  });
}
/* *** END OF ADD TO CART *** */

/* *** VIEW CART *** */
if (config.conversionTracking.trackViewCart) {
  analytics.subscribe('cart_viewed', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var cart = event.data && event.data.cart;

      var googleAnalyticsProducts = (cart && cart.lines || []).map(function (item, index) {
        return {
          item_id: item.merchandise && item.merchandise.product && item.merchandise.product.id,
          item_name: item.merchandise && item.merchandise.product && item.merchandise.product.title,
          affiliation: config.store.affiliationName,
          index: index,
          item_brand: item.merchandise && item.merchandise.product && item.merchandise.product.vendor,
          item_category: item.merchandise && item.merchandise.product && item.merchandise.product.type,
          item_variant: item.merchandise && item.merchandise.title,
          item_sku: item.merchandise && item.merchandise.sku,
          price: item.merchandise && item.merchandise.price && item.merchandise.price.amount,
          quantity: item.quantity,
        };
      });

      var dataLayerObj = {
        event: 'view_cart',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        ecommerce: {
          currency: cart && cart.cost && cart.cost.totalAmount && cart.cost.totalAmount.currencyCode,
          value: cart && cart.cost && cart.cost.totalAmount && cart.cost.totalAmount.amount,
          items: googleAnalyticsProducts,
        },
      };

      window.dataLayer.push({ ecommerce: null });
      window.dataLayer.push(dataLayerObj);
    } catch (error) {
      console.error('Error handling cart_viewed event:', error);
    }
  });
}
/* *** END OF VIEW CART *** */

/* *** REMOVE FROM CART *** */
if (config.conversionTracking.trackRemoveFromCart) {
  analytics.subscribe('product_removed_from_cart', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var cartLine = event.data && event.data.cartLine;

      var googleAnalyticsProducts = (cartLine ? [cartLine] : []).map(function (item) {
        return {
          item_id: item.merchandise && item.merchandise.product && item.merchandise.product.id,
          item_name: item.merchandise && item.merchandise.product && item.merchandise.product.title,
          affiliation: config.store.affiliationName,
          item_brand: item.merchandise && item.merchandise.product && item.merchandise.product.vendor,
          item_category: item.merchandise && item.merchandise.product && item.merchandise.product.type,
          item_variant: item.merchandise && item.merchandise.title,
          item_sku: item.merchandise && item.merchandise.sku,
          price: item.merchandise && item.merchandise.price && item.merchandise.price.amount,
          quantity: item.quantity,
        };
      });

      var dataLayerObj = {
        event: 'remove_from_cart',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        ecommerce: {
          currency: cartLine && cartLine.cost && cartLine.cost.totalAmount && cartLine.cost.totalAmount.currencyCode,
          value: cartLine && cartLine.cost && cartLine.cost.totalAmount && cartLine.cost.totalAmount.amount,
          items: googleAnalyticsProducts,
        },
      };

      window.dataLayer.push({ ecommerce: null });
      window.dataLayer.push(dataLayerObj);
    } catch (error) {
      console.error('Error handling product_removed_from_cart event:', error);
    }
  });
}
/* *** END OF REMOVE FROM CART *** */

/* *** PROCESS CHECKOUT PRODUCTS *** */
var processCheckoutProducts = function (items) {
  var orderCoupon = []; // to hold the discount titles

  var finalProductArray = (items || []).map(function (item, index) {
    var itemDiscountAmount = 0;
    var discountApplications = [];

    // discounts
    (item.discountAllocations || []).forEach(function (allocation) {
      var discount = allocation.discountApplication;

      // record discount application details
      discountApplications.push({
        title: discount.title,
        type: discount.type,
        targetType: discount.targetType,
        targetSelection: discount.targetSelection
      });

      // discount title for coupon array
      if (discount.title && !orderCoupon.includes(discount.title)) {
        orderCoupon.push(discount.title);
      }

      // discount amount
      var allocationAmount = allocation.amount && allocation.amount.amount || 0;
      itemDiscountAmount += allocationAmount;
    });

    // price after discount
    var itemPrice = item.variant && item.variant.price && item.variant.price.amount;
    var priceAfterDiscount = itemPrice - itemDiscountAmount / item.quantity;

    return {
      item_id: item.variant && item.variant.product && item.variant.product.id,
      item_name: item.variant && item.variant.product && item.variant.product.title,
      affiliation: config.store.affiliationName,
      coupon: orderCoupon.join(',') || undefined,
      discount: itemDiscountAmount / item.quantity,
      discount_applications: discountApplications.length ? discountApplications : undefined,
      index: index,
      item_brand: item.variant && item.variant.product && item.variant.product.vendor,
      item_category: item.variant && item.variant.product && item.variant.product.type,
      item_variant: item.variant && item.variant.title,
      item_sku: item.variant && item.variant.sku,
      price: priceAfterDiscount,
      quantity: item.quantity,
    };
  });

  return {
    items: finalProductArray,
    orderCouponString: orderCoupon.join(','),
  };
};
/* *** END PROCESS CHECKOUT PRODUCTS *** */

/* *** BEGIN CHECKOUT *** */
if (config.conversionTracking.trackBeginCheckout) {
  analytics.subscribe('checkout_started', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var checkout = event.data && event.data.checkout;
      var orderDiscountAmount = checkout && checkout.discountsAmount && checkout.discountsAmount.amount || 0;
      var totalOrderValue = (checkout && checkout.subtotalPrice && checkout.subtotalPrice.amount || 0) - orderDiscountAmount;

      var dataLayerObj = {
        event: 'begin_checkout',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        ecommerce: {
          currency: checkout && checkout.currencyCode,
          value: totalOrderValue,
          coupon: processCheckoutProducts(checkout && checkout.lineItems).orderCouponString || undefined,
          discount: orderDiscountAmount,
          items: processCheckoutProducts(checkout && checkout.lineItems).items,
        },
      };

      window.dataLayer.push({ ecommerce: null });
      window.dataLayer.push(dataLayerObj);
    } catch (error) {
      console.error('Error handling checkout_started event:', error);
    }
  });
}
/* *** END OF BEGIN CHECKOUT *** */

/* *** ADD SHIPPING INFO *** */
if (config.conversionTracking.trackAddShippingInfo) {
  analytics.subscribe('checkout_shipping_info_submitted', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var checkout = event.data && event.data.checkout;
      var orderDiscountAmount = checkout && checkout.discountsAmount && checkout.discountsAmount.amount || 0;
      var totalOrderValue = (checkout && checkout.subtotalPrice && checkout.subtotalPrice.amount || 0) - orderDiscountAmount;

      var dataLayerObj = {
        event: 'add_shipping_info',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        ecommerce: {
          currency: checkout && checkout.currencyCode,
          value: totalOrderValue,
          coupon: processCheckoutProducts(checkout && checkout.lineItems).orderCouponString || undefined,
          discount: orderDiscountAmount,
          shipping_tier: checkout && checkout.delivery && checkout.delivery.selectedDeliveryOptions && checkout.delivery.selectedDeliveryOptions[0] && checkout.delivery.selectedDeliveryOptions[0].title || undefined,
          items: processCheckoutProducts(checkout && checkout.lineItems).items,
        },
      };

      window.dataLayer.push({ ecommerce: null });
      window.dataLayer.push(dataLayerObj);
    } catch (error) {
      console.error('Error handling checkout_shipping_info_submitted event:', error);
    }
  });
}
/* *** END OF ADD SHIPPING INFO *** */

/* *** ADD PAYMENT INFO *** */
if (config.conversionTracking.trackAddPaymentInfo) {
  analytics.subscribe('payment_info_submitted', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var checkout = event.data && event.data.checkout;
      var orderDiscountAmount = checkout && checkout.discountsAmount && checkout.discountsAmount.amount || 0;
      var totalOrderValue = (checkout && checkout.subtotalPrice && checkout.subtotalPrice.amount || 0) - orderDiscountAmount;

      var paymentGateway = checkout && checkout.transactions && checkout.transactions[0] && checkout.transactions[0].gateway;
      var paymentMethod = checkout && checkout.paymentMethod; // placeholder—verify property name in your data

      var dataLayerObj = {
        event: 'add_payment_info',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        ecommerce: {
          currency: checkout && checkout.currencyCode,
          value: totalOrderValue,
          coupon: processCheckoutProducts(checkout && checkout.lineItems).orderCouponString || undefined,
          discount: orderDiscountAmount,
          payment_gateway: paymentGateway,
          payment_method: paymentMethod,
          items: processCheckoutProducts(checkout && checkout.lineItems).items,
        },
      };

      window.dataLayer.push({ ecommerce: null });
      window.dataLayer.push(dataLayerObj);
    } catch (error) {
      console.error('Error handling payment_info_submitted event:', error);
    }
  });
}
/* *** END OF ADD PAYMENT INFO *** */

/* *** PURCHASE *** */
if (config.conversionTracking.trackPurchase) {
  analytics.subscribe('checkout_completed', function (event) {
    try {
      var eventContextData = event.context && event.context.document;
      var checkout = event.data && event.data.checkout;
      var orderDiscountAmount = checkout && checkout.discountsAmount && checkout.discountsAmount.amount || 0;
      var totalOrderValue = (checkout && checkout.subtotalPrice && checkout.subtotalPrice.amount || 0) - orderDiscountAmount;

      // payment gateway & method
      var paymentGateway = checkout && checkout.transactions && checkout.transactions[0] && checkout.transactions[0].gateway;
      var paymentMethod = checkout && checkout.transactions && checkout.transactions[0] && checkout.transactions[0].paymentMethod;	

      var dataLayerObj = {
        event: 'purchase',
        timestamp: event.timestamp,
        id: event.id,
        client_id: event.clientId,
        page_location: eventContextData && eventContextData.location && eventContextData.location.href,
        page_referrer: eventContextData && eventContextData.referrer,
        page_title: eventContextData && eventContextData.title,
        user_email: checkout && checkout.email,
        user_data: checkout && checkout.shippingAddress,
        ecommerce: {
          transaction_id: checkout && checkout.order && checkout.order.id,
          currency: checkout && checkout.currencyCode,
          value: totalOrderValue,
          tax: checkout && checkout.totalTax && checkout.totalTax.amount || 0,
          shipping: checkout && checkout.shippingLine && checkout.shippingLine.price && checkout.shippingLine.price.amount || 0,
          shipping_tier: checkout && checkout.delivery && checkout.delivery.selectedDeliveryOptions && checkout.delivery.selectedDeliveryOptions[0] && checkout.delivery.selectedDeliveryOptions[0].title || undefined,
          coupon: processCheckoutProducts(checkout && checkout.lineItems).orderCouponString || undefined,
          discount: orderDiscountAmount,
          payment_gateway: paymentGateway,
          payment_method: paymentMethod,
          items: processCheckoutProducts(checkout && checkout.lineItems).items,
        },
      };

      window.dataLayer.push({ ecommerce: null });
      window.dataLayer.push(dataLayerObj);
    } catch (error) {
      console.error('Error handling checkout_completed event:', error);
    }
  });
}
/* *** END OF PURCHASE *** */

/* *** ONETRUST TRACKING *** */
// Subscribe to all three events
analytics.subscribe('OneTrustLoaded', function(event) {
  var newEvent = {};
  for (var key in event) {
    if (event.hasOwnProperty(key)) {
      newEvent[key] = event[key];
    }
  }
  newEvent.page_location = (event.context && event.context.document && event.context.document.location.href) || '';
  window.dataLayer.push(newEvent);
});

analytics.subscribe('OptanonLoaded', function(event) {
  var newEvent = {};
  for (var key in event) {
    if (event.hasOwnProperty(key)) {
      newEvent[key] = event[key];
    }
  }
  newEvent.page_location = (event.context && event.context.document && event.context.document.location.href) || '';
  window.dataLayer.push(newEvent);
});

analytics.subscribe('OneTrustGroupsUpdated', function(event) {
  var newEvent = {};
  for (var key in event) {
    if (event.hasOwnProperty(key)) {
      newEvent[key] = event[key];
    }
  }
  newEvent.page_location = (event.context && event.context.document && event.context.document.location.href) || '';
  window.dataLayer.push(newEvent);
});
/* *** END OF ONETRUST TRACKING *** */
```
 

### Advanced Click Tracking () - DEPREICATED
 
GTM Storefront Script
 
This script listens to click events on the storefront and sends them to the custom pixel - dataLayer push.
 
Navigate to theme code and find 'snippets'. Add the following 'snippet'.
 

##### Storefront Snippet
 
```
<!-- Click Tracking -->
<script>
 function click_element_path(element) {
 var el = element;
 if (el instanceof Node) {
 var elList = [];
 do {
 if (el instanceof Element) {
 var classString = el.classList ? [].slice.call(el.classList).join('.') : '';
 var elementName = (el.tagName ? el.tagName.toLowerCase() : '') +
 (classString ? '.' + classString : '') +
 (el.id ? '#' + el.id : '');
 if (elementName) elList.unshift(elementName);
 }
 el = el.parentNode
 } while (el != null);
 // element object name
 var objString = element.toString().match(/\[object (\w+)\]/);
 var elementType = objString ? objString[1] : element.toString();
 var cssString = elList.join(' > ');
 // return the CSS path
 return cssString ? elementType + ': ' + cssString : elementType;
 }
 }
 
 window.addEventListener("click", function(event){
 
 // track clicks on any element
 Shopify.analytics.publish("custom_click",{
 click_element : click_element_path(event.target) || '',
 click_id : event.target.id || '',
 click_classes : event.target.className || '',
 click_text : event.target.innerText || '',
 click_target : event.target.target || '',
 click_url : event.target.href || ''
 });
 
 // track link clicks
 var closestLink = event.target.closest('a')
 if (closestLink){
 Shopify.analytics.publish("custom_link_click",{
 click_element : click_element_path(closestLink.target) || '',
 click_id : closestLink.id || '',
 click_classes : closestLink.className || '',
 click_text : closestLink.innerText || '',
 click_target : closestLink.target || '',
 click_url : closestLink.href || ''
 })
 }
 });
</script>
<!-- End Click Tracking -->
```
 
theme.liquid Snippet
 
Next, add render snippet with file in 'theme' (labeled whatever it is called in the snippet file) (in <head>)
 
{% render 'gtm-storefront-snippet' %}
 

### OneTrust dataLayer Tracking () - DEPRICATED
 
GTM Storefront Script
 
This script listens to OneTrust events on the storefront and sends them to the custom pixel - dataLayer push.
 
Navigate to theme code and find 'snippets'. Add the following 'snippet'.
 

##### OneTrust dataLayer Tracking
 
```
<!-- OneTrust dataLayer Tracking -->
<script>
   window.dataLayer = window.dataLayer || [];
    
   var originalDataLayerPush = window.dataLayer.push;
    
   window.dataLayer.push = function(eventObj) {
     if (
        eventObj.event === 'OneTrustLoaded' ||
        eventObj.event === 'OptanonLoaded' ||
        eventObj.event === 'OneTrustGroupsUpdated'
      ) {
        Shopify.analytics.publish(eventObj.event, eventObj);
      }
      
     return originalDataLayerPush.apply(this, arguments);
    };
    
   if (window.dataLayer.length > 0) {
      window.dataLayer.forEach(function(eventObj) {
        if (
          eventObj.event === 'OneTrustLoaded' ||
          eventObj.event === 'OptanonLoaded' ||
          eventObj.event === 'OneTrustGroupsUpdated'
        ) {
          Shopify.analytics.publish(eventObj.event, eventObj);
        }
      });
    }
</script>
<!-- END OneTrust dataLayer Tracking --> 
```
 
theme.liquid Snippet
 
Next, add render snippet with file in 'theme' (labeled whatever it is called in the snippet file) (in <head>)
 
{% render 'onetrust-tracking-snippet' %}
 

### OneTrust Preference Center ()
 
GTM Storefront Script
 
This script enables the OneTrust preference center on the storefront.
 
Navigate to theme code and find 'snippets'. Add the following 'snippet'.
 

##### OneTrust Preference Center Link
 
```
<script>
document.addEventListener('DOMContentLoaded', function() {
 var links = document.querySelectorAll('a[href="#trustTool"]');
 links.forEach(function(link) {
 link.addEventListener('click', function(event) {
 event.preventDefault(); // Prevent the default link behavior
 OneTrust.ToggleInfoDisplay(); // Call the function
 });
 });
});
</script>
```
 
theme.liquid Snippet
 
Next, add render snippet with file in 'theme' (labeled whatever it is called in the snippet file) (in <head>)
 
{% render 'onetrust-preference_center-snippet' %}Also - add/update 'Your Privacy Choices' Footer Link
 
 - <a href="#trustTool">Your Privacy Choices</a>
 
 

## OneTrust // Data Privacy
 
 1. Data privacy and compliance (e.g., GDPR, CCPA) will be handled by OneTrust:

OneTrust Knowledge Article

Or directly on the site meaning library is in the head and GTM OneTrust/GTM will manage the logic - depending on if OneTrust Shopify App impacts Google Consent Mode - OneTrust IDs:

Brand

Region

Environment

ID

EastPak

AMER

PROD

0193b175-c45f-7788-a7f0-108f908043e4

EastPak

AMER

TEST

0193b175-c45f-7788-a7f0-108f908043e4-test

Jansport

AMER

PROD

79959057-4e8d-4a38-b852-99c9cf64bb1e

 

Jansport

AMER

TEST

79959057-4e8d-4a38-b852-99c9cf64bb1e-test

 

Napapijri

EMEA

PROD

be73c778-69e0-4ba7-bdc4-6ff47aec8179 

 

Napapijri

EMEA

TEST

be73c778-69e0-4ba7-bdc4-6ff47aec8179-test

 

Kipling

NORA

PROD

0196e8cb-9dff-73fc-a9f1-bfdd50cb546f

 

Kipling

NORA

TEST

0196e8cb-9dff-73fc-a9f1-bfdd50cb546f-test

 

Kipling

EMEA

PROD

019813e0-926c-7e6d-bdd2-8023cc7257d5

 

Kipling

EMEA

TEST

019813e0-926c-7e6d-bdd2-8023cc7257d5-test

 

Icebreaker

NORA

PROD

0197d23c-11dc-77c4-9cfc-98454241ee94

Icebreaker

NORA

TEST

0197d23c-11dc-77c4-9cfc-98454241ee94-test

Icebreaker

EMEA

PROD

70b881c6-b296-4a1f-b324-08c291430b72

Icebreaker

EMEA

TEST

70b881c6-b296-4a1f-b324-08c291430b72-test

Icebreaker

APAC

PROD

 TBD

Icebreaker

APAC

TEST

 TBD

 

Eastpak

EMEA

PROD

019994c4-94be-70cf-bb34-610556e2cbb7

 

Eastpak

EMEA

TEST

019994c4-94be-70cf-bb34-610556e2cbb7
-test

 

Dickies

NORA

PROD

0198576d-8f39-713c-a455-9a57be3441ac

Dickies

NORA

TEST

0198576d-8f39-713c-a455-9a57be3441ac-test

Dickies

EMEA

PROD

0199718c-06e9-700b-abcf-7b50ff85d6a2

Dickies

EMEA

TEST

0199718c-06e9-700b-abcf-7b50ff85d6a2
-test

OneTrust Scripts

EASTPAK

Eastpak OneTrust

<!-- OneTrust Cookies Consent Notice start for us.eastpak.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="0193b175-c45f-7788-a7f0-108f908043e4" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for us.eastpak.com -->

JANSPORT

JanSport OneTrust

<!-- OneTrust Cookies Consent Notice start for jansport.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="79959057-4e8d-4a38-b852-99c9cf64bb1e" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for jansport.com -->

NAPAPIJRI EMEA

Napa OneTrust

<!-- OneTrust Cookies Consent Notice start for napapijri.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="be73c778-69e0-4ba7-bdc4-6ff47aec8179" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for napapijri.com -->

KIPLING NORA

Kipling NORA OneTrust

<!-- OneTrust Cookies Consent Notice start for us.kipling.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="0196e8cb-9dff-73fc-a9f1-bfdd50cb546f" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for us.kipling.com -->

KIPLING EMEA

Kipling EMEA OneTrust

<!-- OneTrust Cookies Consent Notice start for kipling.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="019813e0-926c-7e6d-bdd2-8023cc7257d5" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for kipling.com -->

ICEBREAKER NORA

Icebreaker NORA OneTrust

<!-- OneTrust Cookies Consent Notice start for icebreaker.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="0197d23c-11dc-77c4-9cfc-98454241ee94" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for icebreaker.com -->

ICEBREAKER EMEA

Icebreaker EMEA OneTrust

<!-- OneTrust Cookies Consent Notice start for icebreaker.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="70b881c6-b296-4a1f-b324-08c291430b72" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for icebreaker.com -->

ICEBREAKER APAC

Icebreaker APAC OneTrust

<!-- OneTrust Cookies Consent Notice start for icebreaker.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="TBD" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for icebreaker.com -->

EASTPAK EMEA

Eastpak EMEA OneTrust

<!-- OneTrust Cookies Consent Notice start for eastpak.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="97391e35-c327-418f-8e42-36ccb9484e15" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for eastpak.com -->

DICKIES NORA

Dickies NORA OneTrust

<!-- OneTrust Cookies Consent Notice start for dickies.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="0198576d-8f39-713c-a455-9a57be3441ac" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for dickies.com -->

DICKIES EMEA

Dickies EMEA OneTrust

<!-- OneTrust Cookies Consent Notice start for dickies.com -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="c8f7a030-9f99-45af-9649-16b158ad8e24" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for dickies.com -->

Preview links (EXAMPLE):

https://eastpak-us.myshopify.com?preview_theme_id=168924905665

https://eastpak-dev.myshopify.com?preview_theme_id=147130679544

*To Preview: Append the following to the end of the URL - ?otgeo=us,ct&otpreview=true&otreset=true. (e.g. https://eastpak-us.myshopify.com?preview_theme_id=168924905665&otgeo=us,ct&otpreview=true&otreset=true)
 
 

## dataLayer Events detail and Solution Design ()
 
 - General implementation requirement
 - Data Layer Solution Design Document

Data Collection Mechanisms

Data Layer Architecture

Data Objects and Attributes

Events
 
 

## Testing
 

#### 1) Seeing the dataLayer in console.
 
You will notice that there are now sandboxes available. Choose the one that contains the word ‘CUSTOM-’ directly followed by some digits: e.g., web-pixel-sandbox-CUSTOM-123456789. Once you select the correct sandbox, type “dataLayer” (without quotes) in the console and hit enter. You should see populated values there.
 

##### 2) Seeing the dataLayer in browser extension.
 
Download the extension called DataLayer Checker Plus. After installation, open its Settings (click the cog icon) and enable ‘Shopify Custom Pixel DataLayer Checker’.
 

#### 3) Once GA4 events are configured in GTM - review network requests.
 
Troubleshoot the setup by using browser’s “Network tab”. Look at outgoing network requests, open dev tools, navigate to the Network tab, and filter the requests by collect?v=2 to display Google Analytics 4 requests.
 

#### 4) Google Analytics Debugger
 
Download Google Analytics Debugger extension, enable it, and visit Eastpak. Events will appear in GA4’s DebugView. You can access DebugView by going to GA4’s Admin > Property settings > Data display > DebugView.
 

## Helpful Shopify Links
 
 - List of Shopify Standard Events
 - Customer Privacy API
 - Shopify GTM Custom Pixel tutorial
 - GA Ecom Measurement
 
