<script type="text/javascript">
{{VFTag}}(dataLayer, "BloomReach - Page View", function() {
  window.br_data = {};
  if({{Page Hostname}} != "eu.eastpak.com") {
    window.br_data.test_data = true;
    window.br_data.debug = true;
  }

  window.br_data.acct_id = {{const - Bloomreach ID}};
  window.br_data.domain_key = {{lu - Bloomreach - Domain Key}};
  window.br_data.view_id = {{lu - Bloomreach - View ID}};
  window.br_data.tms = "gtm";
  window.br_data.orig_ref_url = location.href;

  if({{Event}} == "purchase") {
    window.br_data.ptype = "conversion";
  } else {
    window.br_data.ptype = {{lu - BloomReach - pageType}};
  }

  switch (window.br_data.ptype) {
    case 'product':
      window.br_data.prod_id = {{dL - ecommerce.items}}[0].item_id + {{dL - ecommerce.items}}[0].colorCode;
      window.br_data.prod_name = {{dL - ecommerce.items}}[0].item_name;
      window.br_data.sku = {{dL - ecommerce.items}}[0].sku;
      break;
    case 'category':
      window.br_data.cat_id = {{dL - item_list_id}};
      window.br_data.cat = {{dL - item_list_name}};
      break;
    case 'search':
      var searchTerm = {{dL - search_term}};
      var isSuggestClick = sessionStorage.getItem('br_suggest_click') === 'true';
      if(sessionStorage.getItem('br_suggest_click') === 'true') {
        sessionStorage.removeItem('br_suggest_click');
      }
      window.br_data.search_term = searchTerm;
      window.br_data.group = 'suggest';
      window.br_data.etype = isSuggestClick ? 'click' : 'submit';
      window.br_data.q = searchTerm;
      window.br_data.aq = searchTerm;
      break;
    case 'conversion':
      window.br_data.is_conversion = 1;
      window.br_data.basket_value = {{dL - AFO - value}};
      window.br_data.order_id = {{dL - AFO - transaction id}};
      window.br_data.basket = {{cjs - Bloomreach - Basket}};
      break;
  }

  if(typeof BrTrk === "undefined") {
    var brtrk = document.createElement('script');
    brtrk.type = 'text/javascript';
    brtrk.async = true;
    brtrk.src = 'https:' == document.location.protocol ? "https://cdns.brsrvr.com/v1/br-trk-{{const - Bloomreach ID}}.js" : "http://cdn.brcdn.com/v1/br-trk-{{const - Bloomreach ID}}.js";
    
    brtrk.onload = function() {
      if(window.br_data.ptype === "search") {
        var searchData = { "q": window.br_data.search_term };
        BrTrk.getTracker().logEvent("suggest", window.br_data.etype, searchData, {}, false);
      }
    };
    
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(brtrk, s);

  } else {
    BrTrk.getTracker().updateBrData(window.br_data);
    if(window.br_data.ptype === "search") {
      var searchData = { "q": window.br_data.search_term };
      BrTrk.getTracker().logEvent("suggest", window.br_data.etype, searchData, {}, false);
    }
    BrTrk.getTracker().logPageView();
  }
});
</script>